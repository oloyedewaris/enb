!function(g){function I(A){if(C[A])return C[A].exports;var n=C[A]={i:A,l:!1,exports:{}};return g[A].call(n.exports,n,n.exports,I),n.l=!0,n.exports}var C={};return I.m=g,I.c=C,I.i=function(g){return g},I.d=function(g,I,C){Object.defineProperty(g,I,{configurable:!1,enumerable:!0,get:C})},I.n=function(g){var C=g&&g.__esModule?function(){return g["default"]}:function(){return g};return I.d(C,"a",C),C},I.o=function(g,I){return Object.prototype.hasOwnProperty.call(g,I)},I.p="",I(I.s=8)}([function(module,exports){eval("myCommunityBank.factory('baseApiFactory', ['$http', '$sce','$location', function($http, $sce, $location) {\n    var self = this;\n\n    self.lastPayload = null;\n    self.environment = angular.element('html').data('env');\n\n    self.apiKey = '8ab7c59b5843653401584365625a0000';\n\n    self.culoans = {\n        url: null,\n        sandbox: 'https://applicationculoans-uat.culoans.co.uk/cuplatform/',\n        production: 'https://applicationculoans.culoans.co.uk/',\n        headers: {\n            'X-API-KEY': self.apiKey,\n            'X-Auth-Token': null\n        }\n    };\n\n    self.culoansFiles = {\n        url: null,\n        sandbox: 'https://applicationculoans-uat.culoans.co.uk/cuplatform/',\n        production: 'https://file-applicationculoans.culoans.co.uk/cuplatformfiles/',\n        headers: {\n            'X-API-KEY': self.apiKey,\n            'X-Auth-Token': null\n        }\n    };\n\n    self.ihub = {\n        url: null,\n        sandbox: 'https://applicationculoans-uat.culoans.co.uk/cuplatform/loanapplications/',\n        production: 'https://mycommunitybankapp.culoans.co.uk/ihub/',\n        headers : {},\n        endpoints: ['address'],\n        headers: {\n            'X-API-KEY': self.apiKey,\n            'X-Auth-Token': null\n        }\n    };\n\n    var weburl = $location.absUrl();\n    \n\n    if(weburl.split('aggr_cd=') && weburl.split('aggr_cd=')[1] && weburl.split('aggr_cd=')[1].split(\"&\")){\n        self.aggrCode = weburl.split('aggr_cd=')[1].split(\"&\")[0];\n    } else {\n        self.aggrCode = \"MYCB\";\n    }\n    \n    if(weburl.split('brandid=') && weburl.split('brandid=')[1] && weburl.split('brandid=')[1].split(\"&\")){\n        self.brandid = weburl.split('brandid=')[1].split(\"&\")[0];\n    }\n    \n\n    self.aggrUrl = window.location.href;\n\n    self.disableSandbox = function () {\n        self.culoans.url = self.culoans.production;\n        self.culoansFiles.url = self.culoansFiles.production;\n        self.ihub.url = self.ihub.production;\n    };\n\n    self.enableSandbox = function () {\n        self.culoans.url = self.culoans.sandbox;\n        self.culoansFiles.url = self.culoansFiles.sandbox;\n        self.ihub.url = self.ihub.sandbox;\n    };\n\n    self.getApiRequestUrl = function (endpoint) {\n        var url = self.culoans.url + endpoint;\n\n        if (self.ihub.endpoints.indexOf(endpoint) > -1) {\n            url = self.ihub.url + endpoint;\n        }\n\n        return $sce.trustAsResourceUrl(url);\n    };\n\n    self.getApiRequestUrlFiles = function (endpoint) {\n        var url = self.culoansFiles.url + endpoint;\n\n        if (self.ihub.endpoints.indexOf(endpoint) > -1) {\n            url = self.ihub.url + endpoint;\n        }\n\n        return $sce.trustAsResourceUrl(url);\n    };\n\n    self.getApiRequestHeaders = function (endpoint) {\n        return self.ihub.endpoints.indexOf(endpoint) == -1 ? self.culoans.headers : self.ihub.headers;\n    };\n\n    self.getSafeEsignUrl = function (url) {\n        return $sce.trustAsResourceUrl(url);\n    };\n\n    self.formatPostCodeResponse = function (data) {\n\n        var address = {\n            generic: {\n                city: data.address.town,\n                county: data.address.county,\n                street: data.address.address1,\n                postcode: data.address.postcode\n            },\n            suggestions: []\n        };\n\n        var suggestions = data.possibleMatches;\n        _.each(suggestions, function (line) {\n            address.suggestions.push(((line.organisation) + \" \" + (line.flatNumber) + \" \" + (line.buildingName) + \" \" + (line.buildingNumber)));\n        });\n\n        return address;\n    };\n\n    self.lookupPostcode = function (postcode, success, fail) {\n        return self.getApi('loanapplications/address', {\n            postcode: postcode.replace(/ /g,'')\n        }, function (data) {\n            if (data && data.errorNumber != 3) {\n                if (success) {\n                    var formatted = self.formatPostCodeResponse(data);\n                    return success(formatted);\n                }\n            } else {\n                if (fail) {\n                    if (data && data.errorMessage) {\n                        var msg = data.errorMessage.replace('error ', '');\n                        return fail(msg);\n                    } else {\n                        console.error('API provided no data');\n                        return fail('Postcode not found (e)');\n                    }\n                }\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.getPurposes = function (success, fail) {\n        return self.getApi('masterdata', {\n            queryType: 'purpose'\n        }, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n\n    self.getEmpstatuss = function (success, fail) {\n        return self.getApi('masterdata', {\n            queryType: 'empstatus'\n        }, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n\n    self.getCreditratings = function (success, fail) {\n        return self.getApi('masterdata', {\n            queryType: 'creditrating'\n        }, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.getSalutations = function (success, fail) {\n        return self.getApi('masterdata', {\n            queryType: 'title'\n        }, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.getNationalities = function (success, fail) {\n        return self.getApi('masterdata', {\n            queryType: 'nationality'\n        }, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.getSecurityQuestions = function (success, fail) {\n        return self.getApi('masterdata', {\n            queryType: 'security'\n        }, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.syncMeta = function (metas, config) {\n        if (config.purposes) {\n            self.getPurposes(function (data) {\n                metas.purposes = data.purpose.masterData;\n            });\n        }\n\n        if (config.empstatuss) {\n            self.getEmpstatuss(function (data) {\n                metas.empstatuss = data.empstatus.masterData;\n            });\n        }\n\n        if (config.creditratings) {\n            self.getCreditratings(function (data) {\n                metas.creditratings = data.creditrating.masterData;\n            });\n        }\n\n        if (config.titles) {\n            self.getSalutations(function (data) {\n                metas.titles = data.title.masterData;\n            });\n        }\n\n        if (config.nationalities) {\n            self.getNationalities(function (data) {\n                metas.nationalities = data.nationality.masterData;\n                angular.element(document).trigger('updated::nationalities');\n            });\n        }\n\n        if (config.security) {\n            self.getSecurityQuestions(function (data) {\n                metas.security_questions = data.security.masterData;\n            });\n        }\n    };\n\n    self.getApi = function (endpoint, query, success, fail) {\n        var url = self.getApiRequestUrl(endpoint);\n        var headers = self.getApiRequestHeaders(endpoint);\n\n        self.lastPayload = {\n            url: url.$$unwrapTrustedValue(),\n            data: query,\n            headers: headers\n        };\n\n        $http.get(url, {\n            params: query,\n            headers: headers\n        }, {\n            timeout: (45 * 1000)\n        })\n        .then(function (response) {\n            if (success) {\n                return success(response.data);\n            }\n        }, function (response) {\n            var message = self.parseErrors(response, 'a');\n            if (fail) {\n                return fail(message);\n            }\n        })\n        .catch(function (err) {\n            var message = self.parseErrors(err, 'b');\n            if (fail) {\n                return fail(message);\n            }\n        });\n    };\n\n\n    self.getApiFiles = function (endpoint, query, success, fail) {\n        var url = self.getApiRequestUrlFiles(endpoint);\n        var headers = self.getApiRequestHeaders(endpoint);\n\n        self.lastPayload = {\n            url: url.$$unwrapTrustedValue(),\n            data: query,\n            headers: headers\n        };\n\n        $http.get(url, {\n            params: query,\n            headers: headers\n        }, {\n            timeout: (45 * 1000)\n        })\n        .then(function (response) {\n            if (success) {\n                return success(response.data);\n            }\n        }, function (response) {\n            var message = self.parseErrors(response, 'a');\n            if (fail) {\n                return fail(message);\n            }\n        })\n        .catch(function (err) {\n            var message = self.parseErrors(err, 'b');\n            if (fail) {\n                return fail(message);\n            }\n        });\n    };\n\n    self.postApi = function (endpoint, data, success, fail) {\n        var url = self.getApiRequestUrl(endpoint);\n        var headers = self.getApiRequestHeaders(endpoint);\n\n        self.lastPayload = {\n            url: url.$$unwrapTrustedValue(),\n            data: data,\n            headers: headers\n        };\n\n        $http.post(url, data, {\n            headers: headers\n        }, {\n            timeout: (45 * 1000)\n        })\n        .then(function (response) {\n            if (success) {\n                return success(response.data);\n            }\n        }, function (response) {\n            var message = self.parseErrors(response, 'c');\n            if (fail) {\n                return fail(message);\n            }\n        })\n        .catch(function (err) {\n            var message = self.parseErrors(err, 'd');\n            if (fail) {\n                return fail(message);\n            }\n        });\n    };\n    \n    self.postApiFiles = function (endpoint, data, success, fail) {       \n\n        var url = self.getApiRequestUrlFiles(endpoint);\n        var headers = self.getApiRequestHeaders(endpoint);\n\n        self.lastPayload = {\n            url: url.$$unwrapTrustedValue(),\n            data: data,\n            headers: headers\n        };\n\n        $http.post(url, data, {\n            headers: headers\n        }, {\n            timeout: (45 * 1000)\n        })\n        .then(function (response) {\n            if (success) {\n                return success(response.data);\n            }\n        }, function (response) {\n            var message = self.parseErrors(response, 'c');\n            if (fail) {\n                return fail(message);\n            }\n        })\n        .catch(function (err) {\n            var message = self.parseErrors(err, 'd');\n            if (fail) {\n                return fail(message);\n            }\n        });\n    };\n\n    \n\n    self.putApi = function (endpoint, data, success, fail) {\n        var url = self.getApiRequestUrl(endpoint);\n        var headers = self.getApiRequestHeaders(endpoint);\n\n        self.lastPayload = {\n            url: url.$$unwrapTrustedValue(),\n            data: data,\n            headers: headers\n        };\n\n        $http.put(url, data, {\n            headers: headers\n        }, {\n            timeout: (45 * 1000)\n        })\n        .then(function (response) {\n            if (success) {\n                return success(response.data);\n            }\n        }, function (response) {\n            var message = self.parseErrors(response, 'e');\n            if (fail) {\n                return fail(message);\n            }\n        })\n        .catch(function (err) {\n            var message = self.parseErrors(err, 'f');\n            if (fail) {\n                return fail(message);\n            }\n        });\n    };\n\n    self.parseErrors = function (_data, tag) {\n\n        var data = null;\n\n        if (_data.data) {\n            data = _data.data;\n        } else {\n            data = _data;\n        }\n\n        self.saveToSentry(data);\n\n        if (data.message) {\n            var errorMessage = data.message;\n            UIkit.modal.alert(errorMessage);\n            return errorMessage;\n        }\n\n        if (angular.isObject(data) && data.platformResponse && Object.keys(data.platformResponse).length) {\n            var firstError = _.first(data.platformResponse);\n            var errorMessage$1 = firstError.description || firstError.responseDesc;\n\n            var errorAlert = \"\\n                <h3>Persistent API Error</h3>\\n                <p>\" + errorMessage$1 + \"</p>\\n            \";\n\n            UIkit.modal.alert(errorAlert);\n            return errorMessage$1;\n        }\n        else if(data.description){\n            return data.description;\n        }\n        return 'Sorry the Persistent API has returned an unexpected response, please try again later or contact us via phone. ' + (tag ? (\" (\" + tag + \")\") : '');\n    };\n\n    self.saveToSentry = function (data) {\n\n        var extras = angular.extend({}, self.lastPayload);\n        extras.response = data;\n\n        if (self.environment != 'development') {\n            Raven.captureException('Persistent API Error', {\n                extra: extras\n            });\n        }\n\n        self.lastPayload = {};\n    }\n\n    if (self.environment === 'production') {\n        self.disableSandbox();\n    } else {\n        self.enableSandbox();\n    }\n\n    return self;\n}]);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy90aGVtZS1hc3NldHMvanMvX2FwcGxpY2F0aW9ucy9fYmFzZS1mYWN0b3J5LmpzP2MyNjEiXSwic291cmNlc0NvbnRlbnQiOlsibXlDb21tdW5pdHlCYW5rLmZhY3RvcnkoJ2Jhc2VBcGlGYWN0b3J5JywgWyckaHR0cCcsICckc2NlJywnJGxvY2F0aW9uJywgZnVuY3Rpb24oJGh0dHAsICRzY2UsICRsb2NhdGlvbikge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgc2VsZi5sYXN0UGF5bG9hZCA9IG51bGw7XG4gICAgc2VsZi5lbnZpcm9ubWVudCA9IGFuZ3VsYXIuZWxlbWVudCgnaHRtbCcpLmRhdGEoJ2VudicpO1xuXG4gICAgc2VsZi5hcGlLZXkgPSAnOGFiN2M1OWI1ODQzNjUzNDAxNTg0MzY1NjI1YTAwMDAnO1xuXG4gICAgc2VsZi5jdWxvYW5zID0ge1xuICAgICAgICB1cmw6IG51bGwsXG4gICAgICAgIHNhbmRib3g6ICdodHRwczovL2FwcGxpY2F0aW9uY3Vsb2Fucy11YXQuY3Vsb2Fucy5jby51ay9jdXBsYXRmb3JtLycsXG4gICAgICAgIHByb2R1Y3Rpb246ICdodHRwczovL2FwcGxpY2F0aW9uY3Vsb2Fucy5jdWxvYW5zLmNvLnVrLycsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdYLUFQSS1LRVknOiBzZWxmLmFwaUtleSxcbiAgICAgICAgICAgICdYLUF1dGgtVG9rZW4nOiBudWxsXG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgc2VsZi5jdWxvYW5zRmlsZXMgPSB7XG4gICAgICAgIHVybDogbnVsbCxcbiAgICAgICAgc2FuZGJveDogJ2h0dHBzOi8vYXBwbGljYXRpb25jdWxvYW5zLXVhdC5jdWxvYW5zLmNvLnVrL2N1cGxhdGZvcm0vJyxcbiAgICAgICAgcHJvZHVjdGlvbjogJ2h0dHBzOi8vZmlsZS1hcHBsaWNhdGlvbmN1bG9hbnMuY3Vsb2Fucy5jby51ay9jdXBsYXRmb3JtZmlsZXMvJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ1gtQVBJLUtFWSc6IHNlbGYuYXBpS2V5LFxuICAgICAgICAgICAgJ1gtQXV0aC1Ub2tlbic6IG51bGxcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBzZWxmLmlodWIgPSB7XG4gICAgICAgIHVybDogbnVsbCxcbiAgICAgICAgc2FuZGJveDogJ2h0dHBzOi8vYXBwbGljYXRpb25jdWxvYW5zLXVhdC5jdWxvYW5zLmNvLnVrL2N1cGxhdGZvcm0vbG9hbmFwcGxpY2F0aW9ucy8nLFxuICAgICAgICBwcm9kdWN0aW9uOiAnaHR0cHM6Ly9teWNvbW11bml0eWJhbmthcHAuY3Vsb2Fucy5jby51ay9paHViLycsXG4gICAgICAgIGhlYWRlcnMgOiB7fSxcbiAgICAgICAgZW5kcG9pbnRzOiBbJ2FkZHJlc3MnXSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ1gtQVBJLUtFWSc6IHNlbGYuYXBpS2V5LFxuICAgICAgICAgICAgJ1gtQXV0aC1Ub2tlbic6IG51bGxcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBsZXQgd2VidXJsID0gJGxvY2F0aW9uLmFic1VybCgpO1xuICAgIFxuXG4gICAgaWYod2VidXJsLnNwbGl0KCdhZ2dyX2NkPScpICYmIHdlYnVybC5zcGxpdCgnYWdncl9jZD0nKVsxXSAmJiB3ZWJ1cmwuc3BsaXQoJ2FnZ3JfY2Q9JylbMV0uc3BsaXQoXCImXCIpKXtcbiAgICAgICAgc2VsZi5hZ2dyQ29kZSA9IHdlYnVybC5zcGxpdCgnYWdncl9jZD0nKVsxXS5zcGxpdChcIiZcIilbMF07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZi5hZ2dyQ29kZSA9IFwiTVlDQlwiO1xuICAgIH1cbiAgICBcbiAgICBpZih3ZWJ1cmwuc3BsaXQoJ2JyYW5kaWQ9JykgJiYgd2VidXJsLnNwbGl0KCdicmFuZGlkPScpWzFdICYmIHdlYnVybC5zcGxpdCgnYnJhbmRpZD0nKVsxXS5zcGxpdChcIiZcIikpe1xuICAgICAgICBzZWxmLmJyYW5kaWQgPSB3ZWJ1cmwuc3BsaXQoJ2JyYW5kaWQ9JylbMV0uc3BsaXQoXCImXCIpWzBdO1xuICAgIH1cbiAgICBcblxuICAgIHNlbGYuYWdnclVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuXG4gICAgc2VsZi5kaXNhYmxlU2FuZGJveCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi5jdWxvYW5zLnVybCA9IHNlbGYuY3Vsb2Fucy5wcm9kdWN0aW9uO1xuICAgICAgICBzZWxmLmN1bG9hbnNGaWxlcy51cmwgPSBzZWxmLmN1bG9hbnNGaWxlcy5wcm9kdWN0aW9uO1xuICAgICAgICBzZWxmLmlodWIudXJsID0gc2VsZi5paHViLnByb2R1Y3Rpb247XG4gICAgfTtcblxuICAgIHNlbGYuZW5hYmxlU2FuZGJveCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi5jdWxvYW5zLnVybCA9IHNlbGYuY3Vsb2Fucy5zYW5kYm94O1xuICAgICAgICBzZWxmLmN1bG9hbnNGaWxlcy51cmwgPSBzZWxmLmN1bG9hbnNGaWxlcy5zYW5kYm94O1xuICAgICAgICBzZWxmLmlodWIudXJsID0gc2VsZi5paHViLnNhbmRib3g7XG4gICAgfTtcblxuICAgIHNlbGYuZ2V0QXBpUmVxdWVzdFVybCA9IGZ1bmN0aW9uIChlbmRwb2ludCkge1xuICAgICAgICBsZXQgdXJsID0gc2VsZi5jdWxvYW5zLnVybCArIGVuZHBvaW50O1xuXG4gICAgICAgIGlmIChzZWxmLmlodWIuZW5kcG9pbnRzLmluZGV4T2YoZW5kcG9pbnQpID4gLTEpIHtcbiAgICAgICAgICAgIHVybCA9IHNlbGYuaWh1Yi51cmwgKyBlbmRwb2ludDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNSZXNvdXJjZVVybCh1cmwpO1xuICAgIH07XG5cbiAgICBzZWxmLmdldEFwaVJlcXVlc3RVcmxGaWxlcyA9IGZ1bmN0aW9uIChlbmRwb2ludCkge1xuICAgICAgICBsZXQgdXJsID0gc2VsZi5jdWxvYW5zRmlsZXMudXJsICsgZW5kcG9pbnQ7XG5cbiAgICAgICAgaWYgKHNlbGYuaWh1Yi5lbmRwb2ludHMuaW5kZXhPZihlbmRwb2ludCkgPiAtMSkge1xuICAgICAgICAgICAgdXJsID0gc2VsZi5paHViLnVybCArIGVuZHBvaW50O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc1Jlc291cmNlVXJsKHVybCk7XG4gICAgfTtcblxuICAgIHNlbGYuZ2V0QXBpUmVxdWVzdEhlYWRlcnMgPSBmdW5jdGlvbiAoZW5kcG9pbnQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuaWh1Yi5lbmRwb2ludHMuaW5kZXhPZihlbmRwb2ludCkgPT0gLTEgPyBzZWxmLmN1bG9hbnMuaGVhZGVycyA6IHNlbGYuaWh1Yi5oZWFkZXJzO1xuICAgIH07XG5cbiAgICBzZWxmLmdldFNhZmVFc2lnblVybCA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc1Jlc291cmNlVXJsKHVybCk7XG4gICAgfTtcblxuICAgIHNlbGYuZm9ybWF0UG9zdENvZGVSZXNwb25zZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cbiAgICAgICAgbGV0IGFkZHJlc3MgPSB7XG4gICAgICAgICAgICBnZW5lcmljOiB7XG4gICAgICAgICAgICAgICAgY2l0eTogZGF0YS5hZGRyZXNzLnRvd24sXG4gICAgICAgICAgICAgICAgY291bnR5OiBkYXRhLmFkZHJlc3MuY291bnR5LFxuICAgICAgICAgICAgICAgIHN0cmVldDogZGF0YS5hZGRyZXNzLmFkZHJlc3MxLFxuICAgICAgICAgICAgICAgIHBvc3Rjb2RlOiBkYXRhLmFkZHJlc3MucG9zdGNvZGVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWdnZXN0aW9uczogW11cbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgc3VnZ2VzdGlvbnMgPSBkYXRhLnBvc3NpYmxlTWF0Y2hlcztcbiAgICAgICAgXy5lYWNoKHN1Z2dlc3Rpb25zLCBmdW5jdGlvbiAobGluZSkge1xuICAgICAgICAgICAgYWRkcmVzcy5zdWdnZXN0aW9ucy5wdXNoKGAke2xpbmUub3JnYW5pc2F0aW9ufSAke2xpbmUuZmxhdE51bWJlcn0gJHtsaW5lLmJ1aWxkaW5nTmFtZX0gJHtsaW5lLmJ1aWxkaW5nTnVtYmVyfWApO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gYWRkcmVzcztcbiAgICB9O1xuXG4gICAgc2VsZi5sb29rdXBQb3N0Y29kZSA9IGZ1bmN0aW9uIChwb3N0Y29kZSwgc3VjY2VzcywgZmFpbCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRBcGkoJ2xvYW5hcHBsaWNhdGlvbnMvYWRkcmVzcycsIHtcbiAgICAgICAgICAgIHBvc3Rjb2RlOiBwb3N0Y29kZS5yZXBsYWNlKC8gL2csJycpXG4gICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmVycm9yTnVtYmVyICE9IDMpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgZm9ybWF0dGVkID0gc2VsZi5mb3JtYXRQb3N0Q29kZVJlc3BvbnNlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2Vzcyhmb3JtYXR0ZWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5lcnJvck1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtc2cgPSBkYXRhLmVycm9yTWVzc2FnZS5yZXBsYWNlKCdlcnJvciAnLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChtc2cpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQVBJIHByb3ZpZGVkIG5vIGRhdGEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKCdQb3N0Y29kZSBub3QgZm91bmQgKGUpJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHNlbGYuZ2V0UHVycG9zZXMgPSBmdW5jdGlvbiAoc3VjY2VzcywgZmFpbCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRBcGkoJ21hc3RlcmRhdGEnLCB7XG4gICAgICAgICAgICBxdWVyeVR5cGU6ICdwdXJwb3NlJ1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG5cbiAgICBzZWxmLmdldEVtcHN0YXR1c3MgPSBmdW5jdGlvbiAoc3VjY2VzcywgZmFpbCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRBcGkoJ21hc3RlcmRhdGEnLCB7XG4gICAgICAgICAgICBxdWVyeVR5cGU6ICdlbXBzdGF0dXMnXG4gICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBpZiAoZmFpbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cblxuICAgIHNlbGYuZ2V0Q3JlZGl0cmF0aW5ncyA9IGZ1bmN0aW9uIChzdWNjZXNzLCBmYWlsKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldEFwaSgnbWFzdGVyZGF0YScsIHtcbiAgICAgICAgICAgIHF1ZXJ5VHlwZTogJ2NyZWRpdHJhdGluZydcbiAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHNlbGYuZ2V0U2FsdXRhdGlvbnMgPSBmdW5jdGlvbiAoc3VjY2VzcywgZmFpbCkge1xuICAgICAgICByZXR1cm4gc2VsZi5nZXRBcGkoJ21hc3RlcmRhdGEnLCB7XG4gICAgICAgICAgICBxdWVyeVR5cGU6ICd0aXRsZSdcbiAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHNlbGYuZ2V0TmF0aW9uYWxpdGllcyA9IGZ1bmN0aW9uIChzdWNjZXNzLCBmYWlsKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldEFwaSgnbWFzdGVyZGF0YScsIHtcbiAgICAgICAgICAgIHF1ZXJ5VHlwZTogJ25hdGlvbmFsaXR5J1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgc2VsZi5nZXRTZWN1cml0eVF1ZXN0aW9ucyA9IGZ1bmN0aW9uIChzdWNjZXNzLCBmYWlsKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldEFwaSgnbWFzdGVyZGF0YScsIHtcbiAgICAgICAgICAgIHF1ZXJ5VHlwZTogJ3NlY3VyaXR5J1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgc2VsZi5zeW5jTWV0YSA9IGZ1bmN0aW9uIChtZXRhcywgY29uZmlnKSB7XG4gICAgICAgIGlmIChjb25maWcucHVycG9zZXMpIHtcbiAgICAgICAgICAgIHNlbGYuZ2V0UHVycG9zZXMoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBtZXRhcy5wdXJwb3NlcyA9IGRhdGEucHVycG9zZS5tYXN0ZXJEYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29uZmlnLmVtcHN0YXR1c3MpIHtcbiAgICAgICAgICAgIHNlbGYuZ2V0RW1wc3RhdHVzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIG1ldGFzLmVtcHN0YXR1c3MgPSBkYXRhLmVtcHN0YXR1cy5tYXN0ZXJEYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29uZmlnLmNyZWRpdHJhdGluZ3MpIHtcbiAgICAgICAgICAgIHNlbGYuZ2V0Q3JlZGl0cmF0aW5ncyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIG1ldGFzLmNyZWRpdHJhdGluZ3MgPSBkYXRhLmNyZWRpdHJhdGluZy5tYXN0ZXJEYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29uZmlnLnRpdGxlcykge1xuICAgICAgICAgICAgc2VsZi5nZXRTYWx1dGF0aW9ucyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIG1ldGFzLnRpdGxlcyA9IGRhdGEudGl0bGUubWFzdGVyRGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbmZpZy5uYXRpb25hbGl0aWVzKSB7XG4gICAgICAgICAgICBzZWxmLmdldE5hdGlvbmFsaXRpZXMoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBtZXRhcy5uYXRpb25hbGl0aWVzID0gZGF0YS5uYXRpb25hbGl0eS5tYXN0ZXJEYXRhO1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkudHJpZ2dlcigndXBkYXRlZDo6bmF0aW9uYWxpdGllcycpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29uZmlnLnNlY3VyaXR5KSB7XG4gICAgICAgICAgICBzZWxmLmdldFNlY3VyaXR5UXVlc3Rpb25zKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgbWV0YXMuc2VjdXJpdHlfcXVlc3Rpb25zID0gZGF0YS5zZWN1cml0eS5tYXN0ZXJEYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgc2VsZi5nZXRBcGkgPSBmdW5jdGlvbiAoZW5kcG9pbnQsIHF1ZXJ5LCBzdWNjZXNzLCBmYWlsKSB7XG4gICAgICAgIGxldCB1cmwgPSBzZWxmLmdldEFwaVJlcXVlc3RVcmwoZW5kcG9pbnQpO1xuICAgICAgICBsZXQgaGVhZGVycyA9IHNlbGYuZ2V0QXBpUmVxdWVzdEhlYWRlcnMoZW5kcG9pbnQpO1xuXG4gICAgICAgIHNlbGYubGFzdFBheWxvYWQgPSB7XG4gICAgICAgICAgICB1cmw6IHVybC4kJHVud3JhcFRydXN0ZWRWYWx1ZSgpLFxuICAgICAgICAgICAgZGF0YTogcXVlcnksXG4gICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzXG4gICAgICAgIH07XG5cbiAgICAgICAgJGh0dHAuZ2V0KHVybCwge1xuICAgICAgICAgICAgcGFyYW1zOiBxdWVyeSxcbiAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgdGltZW91dDogKDQ1ICogMTAwMClcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gc2VsZi5wYXJzZUVycm9ycyhyZXNwb25zZSwgJ2EnKTtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwobWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBsZXQgbWVzc2FnZSA9IHNlbGYucGFyc2VFcnJvcnMoZXJyLCAnYicpO1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChtZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuXG4gICAgc2VsZi5nZXRBcGlGaWxlcyA9IGZ1bmN0aW9uIChlbmRwb2ludCwgcXVlcnksIHN1Y2Nlc3MsIGZhaWwpIHtcbiAgICAgICAgbGV0IHVybCA9IHNlbGYuZ2V0QXBpUmVxdWVzdFVybEZpbGVzKGVuZHBvaW50KTtcbiAgICAgICAgbGV0IGhlYWRlcnMgPSBzZWxmLmdldEFwaVJlcXVlc3RIZWFkZXJzKGVuZHBvaW50KTtcblxuICAgICAgICBzZWxmLmxhc3RQYXlsb2FkID0ge1xuICAgICAgICAgICAgdXJsOiB1cmwuJCR1bndyYXBUcnVzdGVkVmFsdWUoKSxcbiAgICAgICAgICAgIGRhdGE6IHF1ZXJ5LFxuICAgICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xuICAgICAgICB9O1xuXG4gICAgICAgICRodHRwLmdldCh1cmwsIHtcbiAgICAgICAgICAgIHBhcmFtczogcXVlcnksXG4gICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHRpbWVvdXQ6ICg0NSAqIDEwMDApXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBsZXQgbWVzc2FnZSA9IHNlbGYucGFyc2VFcnJvcnMocmVzcG9uc2UsICdhJyk7XG4gICAgICAgICAgICBpZiAoZmFpbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKG1lc3NhZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBzZWxmLnBhcnNlRXJyb3JzKGVyciwgJ2InKTtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwobWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBzZWxmLnBvc3RBcGkgPSBmdW5jdGlvbiAoZW5kcG9pbnQsIGRhdGEsIHN1Y2Nlc3MsIGZhaWwpIHtcbiAgICAgICAgbGV0IHVybCA9IHNlbGYuZ2V0QXBpUmVxdWVzdFVybChlbmRwb2ludCk7XG4gICAgICAgIGxldCBoZWFkZXJzID0gc2VsZi5nZXRBcGlSZXF1ZXN0SGVhZGVycyhlbmRwb2ludCk7XG5cbiAgICAgICAgc2VsZi5sYXN0UGF5bG9hZCA9IHtcbiAgICAgICAgICAgIHVybDogdXJsLiQkdW53cmFwVHJ1c3RlZFZhbHVlKCksXG4gICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xuICAgICAgICB9O1xuXG4gICAgICAgICRodHRwLnBvc3QodXJsLCBkYXRhLCB7XG4gICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHRpbWVvdXQ6ICg0NSAqIDEwMDApXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBsZXQgbWVzc2FnZSA9IHNlbGYucGFyc2VFcnJvcnMocmVzcG9uc2UsICdjJyk7XG4gICAgICAgICAgICBpZiAoZmFpbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKG1lc3NhZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBzZWxmLnBhcnNlRXJyb3JzKGVyciwgJ2QnKTtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwobWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgXG4gICAgc2VsZi5wb3N0QXBpRmlsZXMgPSBmdW5jdGlvbiAoZW5kcG9pbnQsIGRhdGEsIHN1Y2Nlc3MsIGZhaWwpIHsgICAgICAgXG5cbiAgICAgICAgbGV0IHVybCA9IHNlbGYuZ2V0QXBpUmVxdWVzdFVybEZpbGVzKGVuZHBvaW50KTtcbiAgICAgICAgbGV0IGhlYWRlcnMgPSBzZWxmLmdldEFwaVJlcXVlc3RIZWFkZXJzKGVuZHBvaW50KTtcblxuICAgICAgICBzZWxmLmxhc3RQYXlsb2FkID0ge1xuICAgICAgICAgICAgdXJsOiB1cmwuJCR1bndyYXBUcnVzdGVkVmFsdWUoKSxcbiAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzXG4gICAgICAgIH07XG5cbiAgICAgICAgJGh0dHAucG9zdCh1cmwsIGRhdGEsIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgdGltZW91dDogKDQ1ICogMTAwMClcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gc2VsZi5wYXJzZUVycm9ycyhyZXNwb25zZSwgJ2MnKTtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwobWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBsZXQgbWVzc2FnZSA9IHNlbGYucGFyc2VFcnJvcnMoZXJyLCAnZCcpO1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChtZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIFxuXG4gICAgc2VsZi5wdXRBcGkgPSBmdW5jdGlvbiAoZW5kcG9pbnQsIGRhdGEsIHN1Y2Nlc3MsIGZhaWwpIHtcbiAgICAgICAgbGV0IHVybCA9IHNlbGYuZ2V0QXBpUmVxdWVzdFVybChlbmRwb2ludCk7XG4gICAgICAgIGxldCBoZWFkZXJzID0gc2VsZi5nZXRBcGlSZXF1ZXN0SGVhZGVycyhlbmRwb2ludCk7XG5cbiAgICAgICAgc2VsZi5sYXN0UGF5bG9hZCA9IHtcbiAgICAgICAgICAgIHVybDogdXJsLiQkdW53cmFwVHJ1c3RlZFZhbHVlKCksXG4gICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xuICAgICAgICB9O1xuXG4gICAgICAgICRodHRwLnB1dCh1cmwsIGRhdGEsIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgdGltZW91dDogKDQ1ICogMTAwMClcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gc2VsZi5wYXJzZUVycm9ycyhyZXNwb25zZSwgJ2UnKTtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwobWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBsZXQgbWVzc2FnZSA9IHNlbGYucGFyc2VFcnJvcnMoZXJyLCAnZicpO1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChtZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHNlbGYucGFyc2VFcnJvcnMgPSBmdW5jdGlvbiAoX2RhdGEsIHRhZykge1xuXG4gICAgICAgIGxldCBkYXRhID0gbnVsbDtcblxuICAgICAgICBpZiAoX2RhdGEuZGF0YSkge1xuICAgICAgICAgICAgZGF0YSA9IF9kYXRhLmRhdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkYXRhID0gX2RhdGE7XG4gICAgICAgIH1cblxuICAgICAgICBzZWxmLnNhdmVUb1NlbnRyeShkYXRhKTtcblxuICAgICAgICBpZiAoZGF0YS5tZXNzYWdlKSB7XG4gICAgICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICAgVUlraXQubW9kYWwuYWxlcnQoZXJyb3JNZXNzYWdlKTtcbiAgICAgICAgICAgIHJldHVybiBlcnJvck1lc3NhZ2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYW5ndWxhci5pc09iamVjdChkYXRhKSAmJiBkYXRhLnBsYXRmb3JtUmVzcG9uc2UgJiYgT2JqZWN0LmtleXMoZGF0YS5wbGF0Zm9ybVJlc3BvbnNlKS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxldCBmaXJzdEVycm9yID0gXy5maXJzdChkYXRhLnBsYXRmb3JtUmVzcG9uc2UpO1xuICAgICAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9IGZpcnN0RXJyb3IuZGVzY3JpcHRpb24gfHwgZmlyc3RFcnJvci5yZXNwb25zZURlc2M7XG5cbiAgICAgICAgICAgIGxldCBlcnJvckFsZXJ0ID0gYFxuICAgICAgICAgICAgICAgIDxoMz5QZXJzaXN0ZW50IEFQSSBFcnJvcjwvaDM+XG4gICAgICAgICAgICAgICAgPHA+JHsgZXJyb3JNZXNzYWdlIH08L3A+XG4gICAgICAgICAgICBgO1xuXG4gICAgICAgICAgICBVSWtpdC5tb2RhbC5hbGVydChlcnJvckFsZXJ0KTtcbiAgICAgICAgICAgIHJldHVybiBlcnJvck1lc3NhZ2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZihkYXRhLmRlc2NyaXB0aW9uKXtcbiAgICAgICAgICAgIHJldHVybiBkYXRhLmRlc2NyaXB0aW9uO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnU29ycnkgdGhlIFBlcnNpc3RlbnQgQVBJIGhhcyByZXR1cm5lZCBhbiB1bmV4cGVjdGVkIHJlc3BvbnNlLCBwbGVhc2UgdHJ5IGFnYWluIGxhdGVyIG9yIGNvbnRhY3QgdXMgdmlhIHBob25lLiAnICsgKHRhZyA/IGAgKCR7dGFnfSlgIDogJycpO1xuICAgIH07XG5cbiAgICBzZWxmLnNhdmVUb1NlbnRyeSA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cbiAgICAgICAgbGV0IGV4dHJhcyA9IGFuZ3VsYXIuZXh0ZW5kKHt9LCBzZWxmLmxhc3RQYXlsb2FkKTtcbiAgICAgICAgZXh0cmFzLnJlc3BvbnNlID0gZGF0YTtcblxuICAgICAgICBpZiAoc2VsZi5lbnZpcm9ubWVudCAhPSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgICAgICAgICBSYXZlbi5jYXB0dXJlRXhjZXB0aW9uKCdQZXJzaXN0ZW50IEFQSSBFcnJvcicsIHtcbiAgICAgICAgICAgICAgICBleHRyYTogZXh0cmFzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGYubGFzdFBheWxvYWQgPSB7fTtcbiAgICB9XG5cbiAgICBpZiAoc2VsZi5lbnZpcm9ubWVudCA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICAgIHNlbGYuZGlzYWJsZVNhbmRib3goKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLmVuYWJsZVNhbmRib3goKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2VsZjtcbn1dKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0aGVtZS1hc3NldHMvanMvX2FwcGxpY2F0aW9ucy9fYmFzZS1mYWN0b3J5LmpzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");
},function(module,exports){eval("myCommunityBank.service('baseApplicationService', ['$window',function ($window) {\n\n    var self = this;\n    var $scope = {};\n\n    angular.element(document).on('updated::nationalities', function () {\n      var underscore = _.noConflict(); \n      if(typeof underscore.findWhere != 'undefined' && typeof underscore.findWhere == 'function'){\n        if (!_.isObject(self.form.personal.passport.nationality)) {\n              self.form.personal.passport.nationality = underscore.findWhere(self.meta.nationalities, {\n                  masterCode: ''\n              });\n          } else {\n              self.form.personal.passport.nationality = underscore.findWhere(self.meta.nationalities, {\n                  masterCode: self.form.personal.passport.nationality.masterCode\n              });\n          }\n       } else {\n         if (!_.isObject(self.form.personal.passport.nationality)) {\n              self.form.personal.passport.nationality = _.findWhere(self.meta.nationalities, {\n                  masterCode: ''\n              });\n          } else {\n              self.form.personal.passport.nationality = _.findWhere(self.meta.nationalities, {\n                  masterCode: self.form.personal.passport.nationality.masterCode\n              });\n          }\n       }\n    });\n\n    self.getNewAddress = function () {\n        return {\n            number: '',\n            street: '',\n            city: '',\n            postcode: '',\n            cant_find: false,\n            cant_find_emp: false,\n            less_than_three_years: false,\n            suggestions: []\n        };\n    }\n\n    self.attachScope = function(_scope) {\n        _scope.meta = self.meta;\n        _scope.form = self.form;\n        _scope.product = self.product;\n        $scope = _scope;\n        return this;\n    };\n\n    self.setId = function (id) {\n        console.error('Implement on child class level');\n    };\n\n    self.getId = function () {\n        console.error('Implement on child class level');\n    };\n\n    self.getCuId = function () {\n        return self.product.cuid;\n    };\n\n    self.setCuId = function (cuid) {\n        self.product.cuid = cuid;\n        return this;\n    };\n\n    self.getState = function () {\n        return self.form.request.state;\n    }\n\n    self.getDOB = function () {\n        var today = new Date();\n        var birthMonth = self.form.personal.dob.month.number -1;\n        var m = today.getMonth() - birthMonth;\n        var d = today.getDate() - self.form.personal.dob.day;\n        var y = today.getFullYear() - self.form.personal.dob.year;\n\n        if (\n            self.form.personal.dob.year &&\n            self.form.personal.dob.month &&\n            self.form.personal.dob.day\n        ) {\n            return ((self.form.personal.dob.day) + \"/\" + (self.form.personal.dob.month.number) + \"/\" + (self.form.personal.dob.year))\n        }\n \n        return null;\n    };\n    \n    \n\n    self.getAnnualIncome = function () {\n        var income = self.form.personal.annual_income || '';\n            income = income + '';            \n            income = income.split(',').join('');\n        return income;\n    };\n\n    self.getAmount = function () {\n        var loanAmount = self.form.request.amount || '';\n            loanAmount = loanAmount + '';            \n            loanAmount = loanAmount.split(',').join('');\n        return loanAmount;\n    };\n\n    self.getPassportExpiry = function () {\n        var parts = self.form.personal.passport.expiry.split('/');\n\n        if (parts.length == 3) {\n            var now = Date.now(),\n                jsFormat = (parts[2]) + \"-\" + (parts[1]) + \"-\" + (parts[0]),\n                dateObj = Date.parse(jsFormat);\n\n            return self.form.personal.passport.expiry;\n\n            // If we need to validate it more\n            if (now < dateObj) {\n                return self.form.personal.passport.expiry;\n            }\n        }\n\n        return '';\n    };\n\n    self.preparePersonalData = function() {\n        var nationality = null;\n        if(typeof self.form.personal.passport.nationality != 'undefined'){\n            nationality = self.form.personal.passport.nationality.masterCode;\n        }\n        var data = {\n            deviceType: 'Home',\n            incomeType: 'Annual',\n            birthDate: self.getDOB(),\n            eMail: self.form.personal.email,\n            confirmEmail: self.form.personal.confirmEmail,\n            title: self.form.personal.title,\n            income: self.getAnnualIncome(),\n            loanAmount: self.getAmount(),            \n            phoneNumber: self.form.personal.phone,\n            homeNumber: self.form.personal.homeNumber,\n            lastName: self.form.personal.last_name,\n            employerName: self.form.personal.employer,\n            relativeinmycb: self.form.personal.relativeinmycb,\n            relativeMembershipId: self.form.personal.relativeMembershipId,\n            association: self.form.personal.association,\n            employerAddress: self.form.personal.employerAddress,\n            employerBuildingName: self.form.personal.employerBuildingName,\n            employerBuildingNumber: self.form.personal.employerBuildingNumber,\n            employerCity: self.form.personal.employerCity,\n            employerStreet: self.form.personal.employerStreet,\n            employerAbodeNumber: self.form.personal.employerAbodeNumber,\n            employerPostcode: self.form.personal.employerPostcode,\n            employmentSector: self.form.personal.employmentSector,\n            employmentPosition: self.form.personal.employmentPosition,\n            firstName: self.form.personal.first_name,\n            passportValidUntil: self.getPassportExpiry(),\n            middleName: self.form.personal.middle_name,\n            passportIdNumber: self.form.personal.passport.number,\n            nationality: nationality,\n            employmentStatus: self.form.personal.employmentStatus,\n            passportIssuingAuthority: self.form.personal.passport.authority,\n            depositAmount: self.form.personal.deposit_amount\n        };\n\n        return data;\n    };\n\n    self.prepareAddresses = function () {\n        if(typeof self.form.addresses[0].number ==  'undefined' || null == self.form.addresses[0].number){\n            return;\n        }\n        var add = self.form.addresses[0].number.split(\",\");\n        var data = {\n            city: self.form.addresses[0].city,\n            street: null != self.form.addresses[0].street ? self.form.addresses[0].street : \"\",\n            postcode: self.form.addresses[0].postcode,\n            buildingNumber: null != add[2] ? add[2] : \"\",\n            abodeNumber: null != add[0] ? add[0] : \"\",\n            buildingName: null != add[1] ? add[1] : \"\"\n        };\n        data.address = (data.abodeNumber) + \" \" + (data.buildingNumber) + \" \" + (data.buildingName) + \", \" + (data.street) + \", \" + (data.city);\n        var additionalAddresses = self.form.addresses.slice(1, self.form.addresses.length);\n\n        _.each(additionalAddresses, function (addr, key) {\n            data[(\"prevAddr\" + (key + 1) + \"City\")] = addr.city;\n            data[(\"prevAddr\" + (key + 1) + \"Street\")] = addr.street;\n            data[(\"prevAddr\" + (key + 1) + \"Postcode\")] = addr.postcode;\n            data[(\"prevAddr\" + (key + 1) + \"AbodeNumber\")] = addr.number;\n            data[(\"prevAddr\" + (key + 1) + \"BuildingNumber\")] = addr.number;\n            data[(\"prevAddr\" + (key + 1))] = (addr.number) + \", \" + (addr.street) + \", \" + (addr.city);\n        });\n        return data;\n    };\n\n    self.prepareBankDetails = function () {\n\n        var data = {\n            bankSortCode: self.form.bank.sortcode || '',\n            bankAccountNumber: self.form.bank.account_number || '',\n            bankAccountType: self.form.bank.current_or_savings,\n            bankAccountUsage: self.form.bank.personal_or_business\n        };\n\n        // Nasty hacks for persistent api as they wont change it\n        data.bankSortCode = data.bankSortCode + '';\n        data.bankAccountNumber = data.bankAccountNumber + '';\n\n        return data;\n    };\n\n    self.prepareSecurityData = function () {\n\n        var data = {\n            securityQuestion: self.form.security.question,\n            securityQuestionAnswer: self.form.security.answer\n        };\n\n        return data;\n    };\n\n    self.prepareTosData = function () {\n        var data = {\n            joinFEA: self.form.tos.join_fea,\n            privacyAgreementAgreed: self.form.tos.privacy,\n            cuEligibility: self.form.tos.cuEligibility ? \"CB:\"+self.form.tos.cuEligibility + \"\" : self.form.tos.cuEligibility,\n            ehPostcode: self.form.tos.ehPostcode,\n            cardiffVale: self.form.tos.cardiffVale\n        };\n\n        return data;\n    };\n\n    self.prepareOddMandatoryFields = function () {\n\n        var data = {\n            amtStep: '',\n            tenureStep: '',\n            commonBondCharity: self.form.personal.commonBondCharity,\n            secondFurtherAddress: self.form.addresses.length > 2,\n            movedWithin3YearsCheckbox: self.form.addresses[0].less_than_three_years\n        };\n\n        return data;\n    };\n\n    window.saveBackup = function () {\n        return;\n        return localStorage.setItem('applicationFormData', JSON.stringify(self.form));\n    };\n\n    window.loadBackup = function () {\n        return;\n        var data = null;\n\n        try {\n            var backup = localStorage.getItem('applicationFormData') || '{}';\n            data = JSON.parse(backup);\n        } catch(exception) {\n            data = null;\n        }\n\n        if (data) {\n            angular.extend(self.form, data);\n        }\n    };\n\n    window.pruneBackup = function () {\n        localStorage.setItem('applicationFormData', '{}');\n    };\n\n    self.cachedYears = null;\n    if($window.innerWidth < 760){\n        self.months = [\n            {\n                name: 'Jan',\n                number: 1,\n                days: 31\n            },\n            {\n                name: 'Feb',\n                number: 2,\n                days: 28\n            },\n            {\n                name: 'Mar',\n                number: 3,\n                days: 31\n            },\n            {\n                name: 'Apr',\n                number: 4,\n                days: 30\n            },\n            {\n                name: 'May',\n                number: 5,\n                days: 31\n            },\n            {\n                name: 'June',\n                number: 6,\n                days: 30\n            },\n            {\n                name: 'July',\n                number: 7,\n                days: 31\n            },\n            {\n                name: 'Aug',\n                number: 8,\n                days: 31\n            },\n            {\n                name: 'Sept',\n                number: 9,\n                days: 30\n            },\n            {\n                name: 'Oct',\n                number: 10,\n                days: 31\n            },\n            {\n                name: 'Nov',\n                number: 11,\n                days: 30\n            },\n            {\n                name: 'Dec',\n                number: 12,\n                days: 31\n            }\n        ]\n    }\n    else{\n       self.months = [\n        {\n            name: 'January',\n            number: 1,\n            days: 31\n        },\n        {\n            name: 'February',\n            number: 2,\n            days: 28\n        },\n        {\n            name: 'March',\n            number: 3,\n            days: 31\n        },\n        {\n            name: 'April',\n            number: 4,\n            days: 30\n        },\n        {\n            name: 'May',\n            number: 5,\n            days: 31\n        },\n        {\n            name: 'June',\n            number: 6,\n            days: 30\n        },\n        {\n            name: 'July',\n            number: 7,\n            days: 31\n        },\n        {\n            name: 'August',\n            number: 8,\n            days: 31\n        },\n        {\n            name: 'September',\n            number: 9,\n            days: 30\n        },\n        {\n            name: 'October',\n            number: 10,\n            days: 31\n        },\n        {\n            name: 'November',\n            number: 11,\n            days: 30\n        },\n        {\n            name: 'December',\n            number: 12,\n            days: 31\n        }\n    ] \n    }\n    self.meta = {\n        titles: [],\n        nationalities: [],\n        bank_types: [],\n        security_questions: [],\n        device_types: [],\n        income_types: [],\n        months: self.months,\n        monthsDays: function (month) {\n            var maxDays = month.days || 31;\n            var days = [];\n\n            for (var i = 1; i <= maxDays; i++) {\n                days.push(i);\n            }\n\n            return days;\n        },\n        years: function () {\n            // We dont want to do this every time!\n            if (self.cachedYears) {\n                return self.cachedYears;\n            } else {\n                self.cachedYears = [];\n            }\n\n            var thisYear = new Date().getFullYear();\n            var maxDate = thisYear - 18;\n            var minDate = thisYear - 100;\n            var dateDiff = maxDate - minDate;\n\n            \n\n            for (var i = 0; i <= dateDiff; i++) {\n                var year = maxDate - i;\n                self.cachedYears.push(year);\n            }\n            return self.cachedYears;\n        }\n        \n    };\n    \n    self.product = {\n        cuid: null,\n        id: null\n    };\n\n    self.form = {\n\n        request: {\n            id: null,\n            state: 'IN_PROGRESS'\n        },\n\n        personal: {\n            title: '',\n            first_name: '',\n            last_name: '',\n            email: '',\n            confirmEmail: '',\n            phone: '',\n            annual_income: '',\n            dob: {\n                day: '',\n                month: '',\n                year: ''\n            },\n            passport: {\n                nationality: '',\n                number: '',\n                authority: '',\n                expiry: ''\n            },\n        },\n\n        verify: {\n            email: '',\n            phone: '',\n            loanId: '',\n            sortCode: '',\n            accountNumber: '',\n            cuEligibility: ''\n        },\n\n        addresses: [\n            self.getNewAddress()\n        ],\n\n        bank: {\n            personal_or_business: 'PERSONAL',\n            current_or_savings: 'CURRENT',\n            sortcode: '',\n            account_number: ''\n        },\n\n        security: {\n            question: '',\n            answer: ''\n        },\n\n        tos: {\n            join_fea: false,\n            privacy: false,\n            cuEligibility: ''\n        }\n    };\n\n    window.loadBackup();\n}]);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy90aGVtZS1hc3NldHMvanMvX2FwcGxpY2F0aW9ucy9fYmFzZS1zZXJ2aWNlLmpzPzFlMmEiXSwic291cmNlc0NvbnRlbnQiOlsibXlDb21tdW5pdHlCYW5rLnNlcnZpY2UoJ2Jhc2VBcHBsaWNhdGlvblNlcnZpY2UnLCBbJyR3aW5kb3cnLGZ1bmN0aW9uICgkd2luZG93KSB7XG5cbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBsZXQgJHNjb3BlID0ge307XG5cbiAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLm9uKCd1cGRhdGVkOjpuYXRpb25hbGl0aWVzJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHVuZGVyc2NvcmUgPSBfLm5vQ29uZmxpY3QoKTsgXG4gICAgICBpZih0eXBlb2YgdW5kZXJzY29yZS5maW5kV2hlcmUgIT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHVuZGVyc2NvcmUuZmluZFdoZXJlID09ICdmdW5jdGlvbicpe1xuICAgICAgICBpZiAoIV8uaXNPYmplY3Qoc2VsZi5mb3JtLnBlcnNvbmFsLnBhc3Nwb3J0Lm5hdGlvbmFsaXR5KSkge1xuICAgICAgICAgICAgICBzZWxmLmZvcm0ucGVyc29uYWwucGFzc3BvcnQubmF0aW9uYWxpdHkgPSB1bmRlcnNjb3JlLmZpbmRXaGVyZShzZWxmLm1ldGEubmF0aW9uYWxpdGllcywge1xuICAgICAgICAgICAgICAgICAgbWFzdGVyQ29kZTogJydcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc2VsZi5mb3JtLnBlcnNvbmFsLnBhc3Nwb3J0Lm5hdGlvbmFsaXR5ID0gdW5kZXJzY29yZS5maW5kV2hlcmUoc2VsZi5tZXRhLm5hdGlvbmFsaXRpZXMsIHtcbiAgICAgICAgICAgICAgICAgIG1hc3RlckNvZGU6IHNlbGYuZm9ybS5wZXJzb25hbC5wYXNzcG9ydC5uYXRpb25hbGl0eS5tYXN0ZXJDb2RlXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICB9IGVsc2Uge1xuICAgICAgICAgaWYgKCFfLmlzT2JqZWN0KHNlbGYuZm9ybS5wZXJzb25hbC5wYXNzcG9ydC5uYXRpb25hbGl0eSkpIHtcbiAgICAgICAgICAgICAgc2VsZi5mb3JtLnBlcnNvbmFsLnBhc3Nwb3J0Lm5hdGlvbmFsaXR5ID0gXy5maW5kV2hlcmUoc2VsZi5tZXRhLm5hdGlvbmFsaXRpZXMsIHtcbiAgICAgICAgICAgICAgICAgIG1hc3RlckNvZGU6ICcnXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNlbGYuZm9ybS5wZXJzb25hbC5wYXNzcG9ydC5uYXRpb25hbGl0eSA9IF8uZmluZFdoZXJlKHNlbGYubWV0YS5uYXRpb25hbGl0aWVzLCB7XG4gICAgICAgICAgICAgICAgICBtYXN0ZXJDb2RlOiBzZWxmLmZvcm0ucGVyc29uYWwucGFzc3BvcnQubmF0aW9uYWxpdHkubWFzdGVyQ29kZVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgfVxuICAgIH0pO1xuXG4gICAgc2VsZi5nZXROZXdBZGRyZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbnVtYmVyOiAnJyxcbiAgICAgICAgICAgIHN0cmVldDogJycsXG4gICAgICAgICAgICBjaXR5OiAnJyxcbiAgICAgICAgICAgIHBvc3Rjb2RlOiAnJyxcbiAgICAgICAgICAgIGNhbnRfZmluZDogZmFsc2UsXG4gICAgICAgICAgICBjYW50X2ZpbmRfZW1wOiBmYWxzZSxcbiAgICAgICAgICAgIGxlc3NfdGhhbl90aHJlZV95ZWFyczogZmFsc2UsXG4gICAgICAgICAgICBzdWdnZXN0aW9uczogW11cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBzZWxmLmF0dGFjaFNjb3BlID0gZnVuY3Rpb24oX3Njb3BlKSB7XG4gICAgICAgIF9zY29wZS5tZXRhID0gc2VsZi5tZXRhO1xuICAgICAgICBfc2NvcGUuZm9ybSA9IHNlbGYuZm9ybTtcbiAgICAgICAgX3Njb3BlLnByb2R1Y3QgPSBzZWxmLnByb2R1Y3Q7XG4gICAgICAgICRzY29wZSA9IF9zY29wZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIHNlbGYuc2V0SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignSW1wbGVtZW50IG9uIGNoaWxkIGNsYXNzIGxldmVsJyk7XG4gICAgfTtcblxuICAgIHNlbGYuZ2V0SWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ltcGxlbWVudCBvbiBjaGlsZCBjbGFzcyBsZXZlbCcpO1xuICAgIH07XG5cbiAgICBzZWxmLmdldEN1SWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLnByb2R1Y3QuY3VpZDtcbiAgICB9O1xuXG4gICAgc2VsZi5zZXRDdUlkID0gZnVuY3Rpb24gKGN1aWQpIHtcbiAgICAgICAgc2VsZi5wcm9kdWN0LmN1aWQgPSBjdWlkO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgc2VsZi5nZXRTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuZm9ybS5yZXF1ZXN0LnN0YXRlO1xuICAgIH1cblxuICAgIHNlbGYuZ2V0RE9CID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgdG9kYXkgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBsZXQgYmlydGhNb250aCA9IHNlbGYuZm9ybS5wZXJzb25hbC5kb2IubW9udGgubnVtYmVyIC0xO1xuICAgICAgICBsZXQgbSA9IHRvZGF5LmdldE1vbnRoKCkgLSBiaXJ0aE1vbnRoO1xuICAgICAgICBsZXQgZCA9IHRvZGF5LmdldERhdGUoKSAtIHNlbGYuZm9ybS5wZXJzb25hbC5kb2IuZGF5O1xuICAgICAgICBsZXQgeSA9IHRvZGF5LmdldEZ1bGxZZWFyKCkgLSBzZWxmLmZvcm0ucGVyc29uYWwuZG9iLnllYXI7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgc2VsZi5mb3JtLnBlcnNvbmFsLmRvYi55ZWFyICYmXG4gICAgICAgICAgICBzZWxmLmZvcm0ucGVyc29uYWwuZG9iLm1vbnRoICYmXG4gICAgICAgICAgICBzZWxmLmZvcm0ucGVyc29uYWwuZG9iLmRheVxuICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBgJHtzZWxmLmZvcm0ucGVyc29uYWwuZG9iLmRheX0vJHtzZWxmLmZvcm0ucGVyc29uYWwuZG9iLm1vbnRoLm51bWJlcn0vJHtzZWxmLmZvcm0ucGVyc29uYWwuZG9iLnllYXJ9YFxuICAgICAgICB9XG4gXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG4gICAgXG4gICAgXG5cbiAgICBzZWxmLmdldEFubnVhbEluY29tZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IGluY29tZSA9IHNlbGYuZm9ybS5wZXJzb25hbC5hbm51YWxfaW5jb21lIHx8ICcnO1xuICAgICAgICAgICAgaW5jb21lID0gaW5jb21lICsgJyc7ICAgICAgICAgICAgXG4gICAgICAgICAgICBpbmNvbWUgPSBpbmNvbWUuc3BsaXQoJywnKS5qb2luKCcnKTtcbiAgICAgICAgcmV0dXJuIGluY29tZTtcbiAgICB9O1xuXG4gICAgc2VsZi5nZXRBbW91bnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBsb2FuQW1vdW50ID0gc2VsZi5mb3JtLnJlcXVlc3QuYW1vdW50IHx8ICcnO1xuICAgICAgICAgICAgbG9hbkFtb3VudCA9IGxvYW5BbW91bnQgKyAnJzsgICAgICAgICAgICBcbiAgICAgICAgICAgIGxvYW5BbW91bnQgPSBsb2FuQW1vdW50LnNwbGl0KCcsJykuam9pbignJyk7XG4gICAgICAgIHJldHVybiBsb2FuQW1vdW50O1xuICAgIH07XG5cbiAgICBzZWxmLmdldFBhc3Nwb3J0RXhwaXJ5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgcGFydHMgPSBzZWxmLmZvcm0ucGVyc29uYWwucGFzc3BvcnQuZXhwaXJ5LnNwbGl0KCcvJyk7XG5cbiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PSAzKSB7XG4gICAgICAgICAgICBsZXQgbm93ID0gRGF0ZS5ub3coKSxcbiAgICAgICAgICAgICAgICBqc0Zvcm1hdCA9IGAke3BhcnRzWzJdfS0ke3BhcnRzWzFdfS0ke3BhcnRzWzBdfWAsXG4gICAgICAgICAgICAgICAgZGF0ZU9iaiA9IERhdGUucGFyc2UoanNGb3JtYXQpO1xuXG4gICAgICAgICAgICByZXR1cm4gc2VsZi5mb3JtLnBlcnNvbmFsLnBhc3Nwb3J0LmV4cGlyeTtcblxuICAgICAgICAgICAgLy8gSWYgd2UgbmVlZCB0byB2YWxpZGF0ZSBpdCBtb3JlXG4gICAgICAgICAgICBpZiAobm93IDwgZGF0ZU9iaikge1xuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmZvcm0ucGVyc29uYWwucGFzc3BvcnQuZXhwaXJ5O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH07XG5cbiAgICBzZWxmLnByZXBhcmVQZXJzb25hbERhdGEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG5hdGlvbmFsaXR5ID0gbnVsbDtcbiAgICAgICAgaWYodHlwZW9mIHNlbGYuZm9ybS5wZXJzb25hbC5wYXNzcG9ydC5uYXRpb25hbGl0eSAhPSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgICBuYXRpb25hbGl0eSA9IHNlbGYuZm9ybS5wZXJzb25hbC5wYXNzcG9ydC5uYXRpb25hbGl0eS5tYXN0ZXJDb2RlO1xuICAgICAgICB9XG4gICAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICAgICAgZGV2aWNlVHlwZTogJ0hvbWUnLFxuICAgICAgICAgICAgaW5jb21lVHlwZTogJ0FubnVhbCcsXG4gICAgICAgICAgICBiaXJ0aERhdGU6IHNlbGYuZ2V0RE9CKCksXG4gICAgICAgICAgICBlTWFpbDogc2VsZi5mb3JtLnBlcnNvbmFsLmVtYWlsLFxuICAgICAgICAgICAgY29uZmlybUVtYWlsOiBzZWxmLmZvcm0ucGVyc29uYWwuY29uZmlybUVtYWlsLFxuICAgICAgICAgICAgdGl0bGU6IHNlbGYuZm9ybS5wZXJzb25hbC50aXRsZSxcbiAgICAgICAgICAgIGluY29tZTogc2VsZi5nZXRBbm51YWxJbmNvbWUoKSxcbiAgICAgICAgICAgIGxvYW5BbW91bnQ6IHNlbGYuZ2V0QW1vdW50KCksICAgICAgICAgICAgXG4gICAgICAgICAgICBwaG9uZU51bWJlcjogc2VsZi5mb3JtLnBlcnNvbmFsLnBob25lLFxuICAgICAgICAgICAgaG9tZU51bWJlcjogc2VsZi5mb3JtLnBlcnNvbmFsLmhvbWVOdW1iZXIsXG4gICAgICAgICAgICBsYXN0TmFtZTogc2VsZi5mb3JtLnBlcnNvbmFsLmxhc3RfbmFtZSxcbiAgICAgICAgICAgIGVtcGxveWVyTmFtZTogc2VsZi5mb3JtLnBlcnNvbmFsLmVtcGxveWVyLFxuICAgICAgICAgICAgcmVsYXRpdmVpbm15Y2I6IHNlbGYuZm9ybS5wZXJzb25hbC5yZWxhdGl2ZWlubXljYixcbiAgICAgICAgICAgIHJlbGF0aXZlTWVtYmVyc2hpcElkOiBzZWxmLmZvcm0ucGVyc29uYWwucmVsYXRpdmVNZW1iZXJzaGlwSWQsXG4gICAgICAgICAgICBhc3NvY2lhdGlvbjogc2VsZi5mb3JtLnBlcnNvbmFsLmFzc29jaWF0aW9uLFxuICAgICAgICAgICAgZW1wbG95ZXJBZGRyZXNzOiBzZWxmLmZvcm0ucGVyc29uYWwuZW1wbG95ZXJBZGRyZXNzLFxuICAgICAgICAgICAgZW1wbG95ZXJCdWlsZGluZ05hbWU6IHNlbGYuZm9ybS5wZXJzb25hbC5lbXBsb3llckJ1aWxkaW5nTmFtZSxcbiAgICAgICAgICAgIGVtcGxveWVyQnVpbGRpbmdOdW1iZXI6IHNlbGYuZm9ybS5wZXJzb25hbC5lbXBsb3llckJ1aWxkaW5nTnVtYmVyLFxuICAgICAgICAgICAgZW1wbG95ZXJDaXR5OiBzZWxmLmZvcm0ucGVyc29uYWwuZW1wbG95ZXJDaXR5LFxuICAgICAgICAgICAgZW1wbG95ZXJTdHJlZXQ6IHNlbGYuZm9ybS5wZXJzb25hbC5lbXBsb3llclN0cmVldCxcbiAgICAgICAgICAgIGVtcGxveWVyQWJvZGVOdW1iZXI6IHNlbGYuZm9ybS5wZXJzb25hbC5lbXBsb3llckFib2RlTnVtYmVyLFxuICAgICAgICAgICAgZW1wbG95ZXJQb3N0Y29kZTogc2VsZi5mb3JtLnBlcnNvbmFsLmVtcGxveWVyUG9zdGNvZGUsXG4gICAgICAgICAgICBlbXBsb3ltZW50U2VjdG9yOiBzZWxmLmZvcm0ucGVyc29uYWwuZW1wbG95bWVudFNlY3RvcixcbiAgICAgICAgICAgIGVtcGxveW1lbnRQb3NpdGlvbjogc2VsZi5mb3JtLnBlcnNvbmFsLmVtcGxveW1lbnRQb3NpdGlvbixcbiAgICAgICAgICAgIGZpcnN0TmFtZTogc2VsZi5mb3JtLnBlcnNvbmFsLmZpcnN0X25hbWUsXG4gICAgICAgICAgICBwYXNzcG9ydFZhbGlkVW50aWw6IHNlbGYuZ2V0UGFzc3BvcnRFeHBpcnkoKSxcbiAgICAgICAgICAgIG1pZGRsZU5hbWU6IHNlbGYuZm9ybS5wZXJzb25hbC5taWRkbGVfbmFtZSxcbiAgICAgICAgICAgIHBhc3Nwb3J0SWROdW1iZXI6IHNlbGYuZm9ybS5wZXJzb25hbC5wYXNzcG9ydC5udW1iZXIsXG4gICAgICAgICAgICBuYXRpb25hbGl0eTogbmF0aW9uYWxpdHksXG4gICAgICAgICAgICBlbXBsb3ltZW50U3RhdHVzOiBzZWxmLmZvcm0ucGVyc29uYWwuZW1wbG95bWVudFN0YXR1cyxcbiAgICAgICAgICAgIHBhc3Nwb3J0SXNzdWluZ0F1dGhvcml0eTogc2VsZi5mb3JtLnBlcnNvbmFsLnBhc3Nwb3J0LmF1dGhvcml0eSxcbiAgICAgICAgICAgIGRlcG9zaXRBbW91bnQ6IHNlbGYuZm9ybS5wZXJzb25hbC5kZXBvc2l0X2Ftb3VudFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH07XG5cbiAgICBzZWxmLnByZXBhcmVBZGRyZXNzZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmKHR5cGVvZiBzZWxmLmZvcm0uYWRkcmVzc2VzWzBdLm51bWJlciA9PSAgJ3VuZGVmaW5lZCcgfHwgbnVsbCA9PSBzZWxmLmZvcm0uYWRkcmVzc2VzWzBdLm51bWJlcil7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFkZCA9IHNlbGYuZm9ybS5hZGRyZXNzZXNbMF0ubnVtYmVyLnNwbGl0KFwiLFwiKTtcbiAgICAgICAgbGV0IGRhdGEgPSB7XG4gICAgICAgICAgICBjaXR5OiBzZWxmLmZvcm0uYWRkcmVzc2VzWzBdLmNpdHksXG4gICAgICAgICAgICBzdHJlZXQ6IG51bGwgIT0gc2VsZi5mb3JtLmFkZHJlc3Nlc1swXS5zdHJlZXQgPyBzZWxmLmZvcm0uYWRkcmVzc2VzWzBdLnN0cmVldCA6IFwiXCIsXG4gICAgICAgICAgICBwb3N0Y29kZTogc2VsZi5mb3JtLmFkZHJlc3Nlc1swXS5wb3N0Y29kZSxcbiAgICAgICAgICAgIGJ1aWxkaW5nTnVtYmVyOiBudWxsICE9IGFkZFsyXSA/IGFkZFsyXSA6IFwiXCIsXG4gICAgICAgICAgICBhYm9kZU51bWJlcjogbnVsbCAhPSBhZGRbMF0gPyBhZGRbMF0gOiBcIlwiLFxuICAgICAgICAgICAgYnVpbGRpbmdOYW1lOiBudWxsICE9IGFkZFsxXSA/IGFkZFsxXSA6IFwiXCJcbiAgICAgICAgfTtcbiAgICAgICAgZGF0YS5hZGRyZXNzID0gYCR7ZGF0YS5hYm9kZU51bWJlcn0gJHtkYXRhLmJ1aWxkaW5nTnVtYmVyfSAke2RhdGEuYnVpbGRpbmdOYW1lfSwgJHtkYXRhLnN0cmVldH0sICR7ZGF0YS5jaXR5fWA7XG4gICAgICAgIGxldCBhZGRpdGlvbmFsQWRkcmVzc2VzID0gc2VsZi5mb3JtLmFkZHJlc3Nlcy5zbGljZSgxLCBzZWxmLmZvcm0uYWRkcmVzc2VzLmxlbmd0aCk7XG5cbiAgICAgICAgXy5lYWNoKGFkZGl0aW9uYWxBZGRyZXNzZXMsIGZ1bmN0aW9uIChhZGRyLCBrZXkpIHtcbiAgICAgICAgICAgIGRhdGFbYHByZXZBZGRyJHsga2V5ICsgMX1DaXR5YF0gPSBhZGRyLmNpdHk7XG4gICAgICAgICAgICBkYXRhW2BwcmV2QWRkciR7IGtleSArIDF9U3RyZWV0YF0gPSBhZGRyLnN0cmVldDtcbiAgICAgICAgICAgIGRhdGFbYHByZXZBZGRyJHsga2V5ICsgMX1Qb3N0Y29kZWBdID0gYWRkci5wb3N0Y29kZTtcbiAgICAgICAgICAgIGRhdGFbYHByZXZBZGRyJHsga2V5ICsgMX1BYm9kZU51bWJlcmBdID0gYWRkci5udW1iZXI7XG4gICAgICAgICAgICBkYXRhW2BwcmV2QWRkciR7IGtleSArIDF9QnVpbGRpbmdOdW1iZXJgXSA9IGFkZHIubnVtYmVyO1xuICAgICAgICAgICAgZGF0YVtgcHJldkFkZHIkeyBrZXkgKyAxfWBdID0gYCR7YWRkci5udW1iZXJ9LCAke2FkZHIuc3RyZWV0fSwgJHthZGRyLmNpdHl9YDtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH07XG5cbiAgICBzZWxmLnByZXBhcmVCYW5rRGV0YWlscyA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgIGJhbmtTb3J0Q29kZTogc2VsZi5mb3JtLmJhbmsuc29ydGNvZGUgfHwgJycsXG4gICAgICAgICAgICBiYW5rQWNjb3VudE51bWJlcjogc2VsZi5mb3JtLmJhbmsuYWNjb3VudF9udW1iZXIgfHwgJycsXG4gICAgICAgICAgICBiYW5rQWNjb3VudFR5cGU6IHNlbGYuZm9ybS5iYW5rLmN1cnJlbnRfb3Jfc2F2aW5ncyxcbiAgICAgICAgICAgIGJhbmtBY2NvdW50VXNhZ2U6IHNlbGYuZm9ybS5iYW5rLnBlcnNvbmFsX29yX2J1c2luZXNzXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gTmFzdHkgaGFja3MgZm9yIHBlcnNpc3RlbnQgYXBpIGFzIHRoZXkgd29udCBjaGFuZ2UgaXRcbiAgICAgICAgZGF0YS5iYW5rU29ydENvZGUgPSBkYXRhLmJhbmtTb3J0Q29kZSArICcnO1xuICAgICAgICBkYXRhLmJhbmtBY2NvdW50TnVtYmVyID0gZGF0YS5iYW5rQWNjb3VudE51bWJlciArICcnO1xuXG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH07XG5cbiAgICBzZWxmLnByZXBhcmVTZWN1cml0eURhdGEgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgbGV0IGRhdGEgPSB7XG4gICAgICAgICAgICBzZWN1cml0eVF1ZXN0aW9uOiBzZWxmLmZvcm0uc2VjdXJpdHkucXVlc3Rpb24sXG4gICAgICAgICAgICBzZWN1cml0eVF1ZXN0aW9uQW5zd2VyOiBzZWxmLmZvcm0uc2VjdXJpdHkuYW5zd2VyXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfTtcblxuICAgIHNlbGYucHJlcGFyZVRvc0RhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICAgICAgam9pbkZFQTogc2VsZi5mb3JtLnRvcy5qb2luX2ZlYSxcbiAgICAgICAgICAgIHByaXZhY3lBZ3JlZW1lbnRBZ3JlZWQ6IHNlbGYuZm9ybS50b3MucHJpdmFjeSxcbiAgICAgICAgICAgIGN1RWxpZ2liaWxpdHk6IHNlbGYuZm9ybS50b3MuY3VFbGlnaWJpbGl0eSA/IFwiQ0I6XCIrc2VsZi5mb3JtLnRvcy5jdUVsaWdpYmlsaXR5ICsgXCJcIiA6IHNlbGYuZm9ybS50b3MuY3VFbGlnaWJpbGl0eSxcbiAgICAgICAgICAgIGVoUG9zdGNvZGU6IHNlbGYuZm9ybS50b3MuZWhQb3N0Y29kZSxcbiAgICAgICAgICAgIGNhcmRpZmZWYWxlOiBzZWxmLmZvcm0udG9zLmNhcmRpZmZWYWxlXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfTtcblxuICAgIHNlbGYucHJlcGFyZU9kZE1hbmRhdG9yeUZpZWxkcyA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgIGFtdFN0ZXA6ICcnLFxuICAgICAgICAgICAgdGVudXJlU3RlcDogJycsXG4gICAgICAgICAgICBjb21tb25Cb25kQ2hhcml0eTogc2VsZi5mb3JtLnBlcnNvbmFsLmNvbW1vbkJvbmRDaGFyaXR5LFxuICAgICAgICAgICAgc2Vjb25kRnVydGhlckFkZHJlc3M6IHNlbGYuZm9ybS5hZGRyZXNzZXMubGVuZ3RoID4gMixcbiAgICAgICAgICAgIG1vdmVkV2l0aGluM1llYXJzQ2hlY2tib3g6IHNlbGYuZm9ybS5hZGRyZXNzZXNbMF0ubGVzc190aGFuX3RocmVlX3llYXJzXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfTtcblxuICAgIHdpbmRvdy5zYXZlQmFja3VwID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm47XG4gICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYXBwbGljYXRpb25Gb3JtRGF0YScsIEpTT04uc3RyaW5naWZ5KHNlbGYuZm9ybSkpO1xuICAgIH07XG5cbiAgICB3aW5kb3cubG9hZEJhY2t1cCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgZGF0YSA9IG51bGw7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxldCBiYWNrdXAgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYXBwbGljYXRpb25Gb3JtRGF0YScpIHx8ICd7fSc7XG4gICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShiYWNrdXApO1xuICAgICAgICB9IGNhdGNoKGV4Y2VwdGlvbikge1xuICAgICAgICAgICAgZGF0YSA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoc2VsZi5mb3JtLCBkYXRhKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB3aW5kb3cucHJ1bmVCYWNrdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdhcHBsaWNhdGlvbkZvcm1EYXRhJywgJ3t9Jyk7XG4gICAgfTtcblxuICAgIHNlbGYuY2FjaGVkWWVhcnMgPSBudWxsO1xuICAgIGlmKCR3aW5kb3cuaW5uZXJXaWR0aCA8IDc2MCl7XG4gICAgICAgIHNlbGYubW9udGhzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdKYW4nLFxuICAgICAgICAgICAgICAgIG51bWJlcjogMSxcbiAgICAgICAgICAgICAgICBkYXlzOiAzMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnRmViJyxcbiAgICAgICAgICAgICAgICBudW1iZXI6IDIsXG4gICAgICAgICAgICAgICAgZGF5czogMjhcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ01hcicsXG4gICAgICAgICAgICAgICAgbnVtYmVyOiAzLFxuICAgICAgICAgICAgICAgIGRheXM6IDMxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdBcHInLFxuICAgICAgICAgICAgICAgIG51bWJlcjogNCxcbiAgICAgICAgICAgICAgICBkYXlzOiAzMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnTWF5JyxcbiAgICAgICAgICAgICAgICBudW1iZXI6IDUsXG4gICAgICAgICAgICAgICAgZGF5czogMzFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ0p1bmUnLFxuICAgICAgICAgICAgICAgIG51bWJlcjogNixcbiAgICAgICAgICAgICAgICBkYXlzOiAzMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnSnVseScsXG4gICAgICAgICAgICAgICAgbnVtYmVyOiA3LFxuICAgICAgICAgICAgICAgIGRheXM6IDMxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdBdWcnLFxuICAgICAgICAgICAgICAgIG51bWJlcjogOCxcbiAgICAgICAgICAgICAgICBkYXlzOiAzMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnU2VwdCcsXG4gICAgICAgICAgICAgICAgbnVtYmVyOiA5LFxuICAgICAgICAgICAgICAgIGRheXM6IDMwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdPY3QnLFxuICAgICAgICAgICAgICAgIG51bWJlcjogMTAsXG4gICAgICAgICAgICAgICAgZGF5czogMzFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ05vdicsXG4gICAgICAgICAgICAgICAgbnVtYmVyOiAxMSxcbiAgICAgICAgICAgICAgICBkYXlzOiAzMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnRGVjJyxcbiAgICAgICAgICAgICAgICBudW1iZXI6IDEyLFxuICAgICAgICAgICAgICAgIGRheXM6IDMxXG4gICAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICB9XG4gICAgZWxzZXtcbiAgICAgICBzZWxmLm1vbnRocyA9IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ0phbnVhcnknLFxuICAgICAgICAgICAgbnVtYmVyOiAxLFxuICAgICAgICAgICAgZGF5czogMzFcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ0ZlYnJ1YXJ5JyxcbiAgICAgICAgICAgIG51bWJlcjogMixcbiAgICAgICAgICAgIGRheXM6IDI4XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdNYXJjaCcsXG4gICAgICAgICAgICBudW1iZXI6IDMsXG4gICAgICAgICAgICBkYXlzOiAzMVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnQXByaWwnLFxuICAgICAgICAgICAgbnVtYmVyOiA0LFxuICAgICAgICAgICAgZGF5czogMzBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ01heScsXG4gICAgICAgICAgICBudW1iZXI6IDUsXG4gICAgICAgICAgICBkYXlzOiAzMVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnSnVuZScsXG4gICAgICAgICAgICBudW1iZXI6IDYsXG4gICAgICAgICAgICBkYXlzOiAzMFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnSnVseScsXG4gICAgICAgICAgICBudW1iZXI6IDcsXG4gICAgICAgICAgICBkYXlzOiAzMVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnQXVndXN0JyxcbiAgICAgICAgICAgIG51bWJlcjogOCxcbiAgICAgICAgICAgIGRheXM6IDMxXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdTZXB0ZW1iZXInLFxuICAgICAgICAgICAgbnVtYmVyOiA5LFxuICAgICAgICAgICAgZGF5czogMzBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ09jdG9iZXInLFxuICAgICAgICAgICAgbnVtYmVyOiAxMCxcbiAgICAgICAgICAgIGRheXM6IDMxXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdOb3ZlbWJlcicsXG4gICAgICAgICAgICBudW1iZXI6IDExLFxuICAgICAgICAgICAgZGF5czogMzBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ0RlY2VtYmVyJyxcbiAgICAgICAgICAgIG51bWJlcjogMTIsXG4gICAgICAgICAgICBkYXlzOiAzMVxuICAgICAgICB9XG4gICAgXSBcbiAgICB9XG4gICAgc2VsZi5tZXRhID0ge1xuICAgICAgICB0aXRsZXM6IFtdLFxuICAgICAgICBuYXRpb25hbGl0aWVzOiBbXSxcbiAgICAgICAgYmFua190eXBlczogW10sXG4gICAgICAgIHNlY3VyaXR5X3F1ZXN0aW9uczogW10sXG4gICAgICAgIGRldmljZV90eXBlczogW10sXG4gICAgICAgIGluY29tZV90eXBlczogW10sXG4gICAgICAgIG1vbnRoczogc2VsZi5tb250aHMsXG4gICAgICAgIG1vbnRoc0RheXM6IGZ1bmN0aW9uIChtb250aCkge1xuICAgICAgICAgICAgbGV0IG1heERheXMgPSBtb250aC5kYXlzIHx8IDMxO1xuICAgICAgICAgICAgbGV0IGRheXMgPSBbXTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gbWF4RGF5czsgaSsrKSB7XG4gICAgICAgICAgICAgICAgZGF5cy5wdXNoKGkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZGF5cztcbiAgICAgICAgfSxcbiAgICAgICAgeWVhcnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIFdlIGRvbnQgd2FudCB0byBkbyB0aGlzIGV2ZXJ5IHRpbWUhXG4gICAgICAgICAgICBpZiAoc2VsZi5jYWNoZWRZZWFycykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNhY2hlZFllYXJzO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZWxmLmNhY2hlZFllYXJzID0gW107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCB0aGlzWWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgICAgIGxldCBtYXhEYXRlID0gdGhpc1llYXIgLSAxODtcbiAgICAgICAgICAgIGxldCBtaW5EYXRlID0gdGhpc1llYXIgLSAxMDA7XG4gICAgICAgICAgICBsZXQgZGF0ZURpZmYgPSBtYXhEYXRlIC0gbWluRGF0ZTtcblxuICAgICAgICAgICAgXG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGRhdGVEaWZmOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgeWVhciA9IG1heERhdGUgLSBpO1xuICAgICAgICAgICAgICAgIHNlbGYuY2FjaGVkWWVhcnMucHVzaCh5ZWFyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzZWxmLmNhY2hlZFllYXJzO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH07XG4gICAgXG4gICAgc2VsZi5wcm9kdWN0ID0ge1xuICAgICAgICBjdWlkOiBudWxsLFxuICAgICAgICBpZDogbnVsbFxuICAgIH07XG5cbiAgICBzZWxmLmZvcm0gPSB7XG5cbiAgICAgICAgcmVxdWVzdDoge1xuICAgICAgICAgICAgaWQ6IG51bGwsXG4gICAgICAgICAgICBzdGF0ZTogJ0lOX1BST0dSRVNTJ1xuICAgICAgICB9LFxuXG4gICAgICAgIHBlcnNvbmFsOiB7XG4gICAgICAgICAgICB0aXRsZTogJycsXG4gICAgICAgICAgICBmaXJzdF9uYW1lOiAnJyxcbiAgICAgICAgICAgIGxhc3RfbmFtZTogJycsXG4gICAgICAgICAgICBlbWFpbDogJycsXG4gICAgICAgICAgICBjb25maXJtRW1haWw6ICcnLFxuICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgYW5udWFsX2luY29tZTogJycsXG4gICAgICAgICAgICBkb2I6IHtcbiAgICAgICAgICAgICAgICBkYXk6ICcnLFxuICAgICAgICAgICAgICAgIG1vbnRoOiAnJyxcbiAgICAgICAgICAgICAgICB5ZWFyOiAnJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhc3Nwb3J0OiB7XG4gICAgICAgICAgICAgICAgbmF0aW9uYWxpdHk6ICcnLFxuICAgICAgICAgICAgICAgIG51bWJlcjogJycsXG4gICAgICAgICAgICAgICAgYXV0aG9yaXR5OiAnJyxcbiAgICAgICAgICAgICAgICBleHBpcnk6ICcnXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuXG4gICAgICAgIHZlcmlmeToge1xuICAgICAgICAgICAgZW1haWw6ICcnLFxuICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgbG9hbklkOiAnJyxcbiAgICAgICAgICAgIHNvcnRDb2RlOiAnJyxcbiAgICAgICAgICAgIGFjY291bnROdW1iZXI6ICcnLFxuICAgICAgICAgICAgY3VFbGlnaWJpbGl0eTogJydcbiAgICAgICAgfSxcblxuICAgICAgICBhZGRyZXNzZXM6IFtcbiAgICAgICAgICAgIHNlbGYuZ2V0TmV3QWRkcmVzcygpXG4gICAgICAgIF0sXG5cbiAgICAgICAgYmFuazoge1xuICAgICAgICAgICAgcGVyc29uYWxfb3JfYnVzaW5lc3M6ICdQRVJTT05BTCcsXG4gICAgICAgICAgICBjdXJyZW50X29yX3NhdmluZ3M6ICdDVVJSRU5UJyxcbiAgICAgICAgICAgIHNvcnRjb2RlOiAnJyxcbiAgICAgICAgICAgIGFjY291bnRfbnVtYmVyOiAnJ1xuICAgICAgICB9LFxuXG4gICAgICAgIHNlY3VyaXR5OiB7XG4gICAgICAgICAgICBxdWVzdGlvbjogJycsXG4gICAgICAgICAgICBhbnN3ZXI6ICcnXG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9zOiB7XG4gICAgICAgICAgICBqb2luX2ZlYTogZmFsc2UsXG4gICAgICAgICAgICBwcml2YWN5OiBmYWxzZSxcbiAgICAgICAgICAgIGN1RWxpZ2liaWxpdHk6ICcnXG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgd2luZG93LmxvYWRCYWNrdXAoKTtcbn1dKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0aGVtZS1hc3NldHMvanMvX2FwcGxpY2F0aW9ucy9fYmFzZS1zZXJ2aWNlLmpzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");
},function(module,exports){eval("myCommunityBank.controller('loanApplicationController', ['$scope', 'cuLoansApiFactory', '$filter', 'loanApplicationService','baseApplicationService', '$timeout','$rootScope','$location','$window',  function($scope, cuLoansApiFactory, $filter, loanApplicationService,baseApplicationService, $timeout,$rootScope,$location,$window){\n\n    /* Here we setup the whole controller ready to do stuff! */\n    $scope.step = 'apply';\n    $scope.loansApi = cuLoansApiFactory;\n    $scope.allProducts = [];\n    $scope.productId = angular.element('[data-productid]').data('productid');\n    $scope.suggestedProduct = null;\n    $scope.globalErrorMessage = null;\n    \n\n    $scope.loanCtrlConf = {};\n    $scope.loanCtrlConf.changeDetail = true;\n    \n\n    var metaConfig = (function () {\n        var el = angular.element('[data-meta]');\n\n        var config = {\n            titles: true,\n            security: true,\n            nationalities: true,\n            purposes:  true,\n            empstatuss:  true,\n            creditratings:  true,\n        };\n        \n\n        if (el.length) {\n            var mods = el.data('meta').split(',');\n            _.each(mods, function (m) {\n                var item = m.split(':');\n                config[item[0].trim()] = item[1].trim() === 'true';\n            })\n        }\n\n        return config;\n    })();\n\n    $scope.result = {\n        apr: 0,\n        term: 0,\n        total: 0,\n        union: '',\n        amount: 0,\n        monthlies: 0,\n        first_date: 0,\n        status: 'REJT',\n        esign: null\n    };\n\n    $scope.summary = {\n        monthlyRepayments: function () {\n            return loanApplicationService.monthlyRepayments($scope.suggestedProduct);\n        },\n        totalRepayment: function () {\n            return loanApplicationService.totalRepayment($scope.suggestedProduct);\n        },\n        APR: function () {\n            return loanApplicationService.getAPR();\n        }\n    }\n\n    $scope.amount = {\n        options: {\n            step: 50,\n             enforceStep: false,\n            // enforceRange: true,\n            showSelectionBar: true,\n            onEnd: saveApplicationInformation,\n            translate: function (value) {\n                return $filter('currency')(value, '&pound')\n            }\n        }\n    };\n\n    $scope.apr = {\n        options : {\n\n        }\n    }\n\n    $scope.term = {\n        options: {\n            step: 1,\n            showSelectionBar: true,\n            // enforceRange: true,\n             enforceStep: false,\n            onEnd: saveApplicationInformation,\n            translate: function (value) {\n                return (value + \" months\")\n            }\n        }\n    };\n\n\n    $scope.application = loanApplicationService.attachScope($scope);\n    $scope.loansApi.syncMeta($scope.meta, metaConfig);\n\n    function setupSliders (product) {\n        $scope.amount.options.floor = product.minLoanAmount;\n        $scope.amount.options.ceil = product.maxLoanAmount;\n        $rootScope.maxApr = product.fairApr;\n        $rootScope.minApr = product.excellentApr;\n        if(localStorage.getItem('loanAmount') < product.minLoanAmount || localStorage.getItem('loanAmount') > product.maxLoanAmount){\n            localStorage.setItem('loanAmount','null');\n        }\n        if(localStorage.getItem('loanAmount') != 'undefined' && 'null' != localStorage.getItem('loanAmount') && null != localStorage.getItem('loanAmount'))\n            $scope.application.form.request.amount = localStorage.getItem('loanAmount');\n        else\n            $scope.application.form.request.amount = product.minLoanAmount;\n\n        $scope.term.options.floor = product.minLoanTermInMonths;\n        $scope.term.options.ceil = product.maxLoanTermInMonths;\n        if(localStorage.getItem('loanTerm') < product.minLoanTermInMonths || localStorage.getItem('loanTerm') > product.maxLoanTermInMonths){\n            localStorage.setItem('loanTerm','null');\n        }\n        if(localStorage.getItem('loanTerm') != 'undefined' && 'null' != localStorage.getItem('loanTerm') && null != localStorage.getItem('loanTerm')) \n         $scope.application.form.request.term = localStorage.getItem('loanTerm');\n        else \n         $scope.application.form.request.term = product.minLoanTermInMonths;\n    };\n\n    function loadApplication () {\n        if ($scope.application.getId()) {\n            continueApplication();\n        } else {\n            startApplication();\n        }\n    };\n\n    function continueApplication () {\n        var cuId = angular.element('[data-cuid]').data('cuid');\n        $scope.application.setCuId(cuId);\n        saveSliderInformation();\n        saveApplicationInformation();\n    };\n\n    function startApplication () {\n        saveSliderInformation();\n\n        if ($scope.suggestedProduct) {\n            $scope.loansApi.startApplication($scope.suggestedProduct, function (data) {\n                var cuId = angular.element('[data-cuid]').data('cuid');\n\n                $scope.application\n                    .setId(data.LoanApplicationID)\n                    .setCuId(cuId)\n\n                    window.saveBackup();\n\n            }, function (err) {\n                console.error(err);\n            });\n        }\n    };\n\n    function saveSliderInformation () {\n      \n        localStorage.setItem('loanAmount', $scope.application.form.request.amount);\n        localStorage.setItem('loanTerm', $scope.application.form.request.term);\n    };\n\n    function saveApplicationInformation () {\n        // Dont bother doing anything if we\n        // have not matched a product\n        if (!$scope.suggestedProduct || !$scope.application.getId()) {\n            return false;\n        }\n\n        saveSliderInformation();\n\n        var constructedApplicationData = $scope.application.prepareForApi();\n\n        $scope.loansApi.syncApplication(constructedApplicationData, function (data) {\n            // console.log(data);\n        }, function (err) {\n            console.error(err);\n        });\n    };\n\n    function findProduct (callback) {\n       var under = _.noConflict(); \n       if(typeof under.findWhere != 'undefined' && typeof under.findWhere == 'function'){\n        $scope.suggestedProduct = under.findWhere($scope.products, {\n            loanProductId: $scope.productId            \n        });\n       } else {\n        $scope.suggestedProduct = _.findWhere($scope.products, {\n            loanProductId: $scope.productId            \n        });\n       }\n\n        callback($scope.suggestedProduct);\n    };\n    \n    $scope.loansApi.fetchEmployerList(function (data){\n        $scope.employerList = data;\n    }, function (err) {\n        UIkit.notification({\n            message: err,\n            status: 'danger',\n            pos: 'bottom-right'\n        });\n    });\n\n    $scope.toggleSearch = function () {\n        $window.onclick = null;\n        $scope.menuOpen = !$scope.menuOpen;\n    \n        if ($scope.model.menuOpen) {\n            $window.onclick = function (event) {\n                $scope.menuOpen = false;\n                $scope.$apply();\n            };\n        }\n    };\n\n    $window.onclick = function(e) {\n        if(e.target.className.split(\" \").indexOf(\"clickoutside\") < 0)\n        {\n            $scope.parentObj.businesschoiceSelected = false;\n            $scope.parentObj.occupationchoiceSelected = false;\n            $scope.parentObj.employerchoiceSelected = false;\n            $scope.parentObj.associationchoiceSelected = false;\n        }\n    }\n\n    $scope.loansApi.fetchBusinessList(function (data){\n        $scope.businessList = data;\n    }, function (err) {\n        UIkit.notification({\n            message: err,\n            status: 'danger',\n            pos: 'bottom-right'\n        });\n    });\n\n    $scope.loansApi.fetchOccupationList(function (data){\n        $scope.occupationList = data;\n    }, function (err) {\n        UIkit.notification({\n            message: err,\n            status: 'danger',\n            pos: 'bottom-right'\n        });\n    });\n\n    $scope.loansApi.fetchAssociationList(function (data){\n      $scope.associationList = [];\n      for(var i in data)  {\n        $scope.associationList.push(data[i].associationName);\n      }\n    }, function (err) {\n        UIkit.notification({\n            message: err,\n            status: 'danger',\n            pos: 'bottom-right'\n        });\n    });\n\n\n    $scope.loansApi.fetchEmployerList(function (data){\n        \n        $scope.employerList = data;\n        \n        \n\n    }, function (err) {\n        UIkit.notification({\n            message: err,\n            status: 'danger',\n            pos: 'bottom-right'\n        });\n    });\n\n    $scope.loansApi.fetchCharityList(function (data){\n        \n        $scope.charityList = data;\n        \n        \n\n    }, function (err) {\n        UIkit.notification({\n            message: err,\n            status: 'danger',\n            pos: 'bottom-right'\n        });\n    });\n\n    $scope.loansApi.fetchProducts(function (data){\n        var prodId = angular.element('[data-productid]').data('productid');\n        if(\"REFER\" == prodId) {\n            //call api to send sms/email\n            return;\n        } else if(\"NA\" == prodId) {\n            return;\n        }\n        $scope.products = data;\n\n        \n\n        return findProduct(function (product) {\n            $scope.apr.options.maxApr = product.fairApr;\n            $scope.apr.options.minApr = product.excellentApr;\n            setupSliders(product);\n            loadApplication();\n        });\n\n    }, function (err) {\n        UIkit.notification({\n            message: err,\n            status: 'danger',\n            pos: 'bottom-right'\n        });\n    });\n\n    /* We're now ready to start doing stuff with the form */\n\n    $scope.isActiveStep = function (step) {\n        return $scope.step == step;\n    };\n\n    $scope.setActiveStep = function (step) {\n        $scope.step = step;\n\n        $timeout(function () {\n            var el = jQuery('.application-section, .processing-step');\n\n            if (el.length) {\n\n                var offset = el.eq(0).position().top - 15;\n\n                jQuery('html, body').animate({\n                    scrollTop: offset\n                });\n            }\n        }, 150);\n\n        return $scope.step;\n    };\n    $scope.contentYes= 'no';\n    $scope.changeEmployerStaus = function (){\n        var allowedEmp = [\"ce\", \"se\", \"te\", \"em\", \"re\"];\n        if(baseApplicationService.getCuId() == 'C-0002') {\n            if(allowedEmp.indexOf($scope.application.form.personal.employmentStatus)>-1){\n                $scope.contentYes= 'yes';\n            } else {\n                $scope.contentYes= 'no';\n            }\n        } else {\n            if(allowedEmp.indexOf($scope.application.form.personal.employmentStatus)==-1){\n                $scope.noEmployer();\n            } else{\n                $scope.contentYes= 'yes';\n            }\n        }\n    }\n\n    $scope.submitApplication = function () {        \n        var income = baseApplicationService.getAnnualIncome();         \n        if(income < 18000 && baseApplicationService.getCuId() != 'C-0002'){\n            UIkit.modal.confirm(\"\\n                <p>Sorry but we can only lend to people with annual income above &pound;18000.</p>\", {\n                labels: {\n                    cancel: '',\n                    ok: \"Ok\"\n                }\n            }).then(function() {\n                history.back();\n            scope.$apply()\n            });\n        }\n               \n        if ($scope.application.form.addresses != 'undefined' && $scope.application.form.addresses.length > 0 && $scope.application.form.addresses[0].postcode == $scope.application.form.personal.employerPostcode && 'Self Employed' == $scope.application.form.personal.employer) {\n            UIkit.modal.confirm(\"\\n                <p>Sorry but we can only lend to people in fulltime employment.</p>\", {\n                labels: {\n                    cancel: '',\n                    ok: \"Ok\"\n                }\n            }).then(function() {\n                history.back();\n                scope.$apply()\n            });\n        } \n\n        var validation = loanApplicationService.validator.go();\n        $scope.globalErrorMessage = null;\n\n        \n\n        if (validation.success) {\n            $scope.setActiveStep('processing');\n            $scope.application.form.verify.loanId = $scope.application.getId();\n            $scope.loansApi.submitApplication($scope.application, function (data) {\n                var emi = loanApplicationService.calculateMonthlyPayment(data.amount,data.term,data.rate);\n                $scope.result = {\n                    amount: data.amount,\n                    term: data.term,\n                    apr: data.apr,\n                    monthlies: emi ,\n                    total: emi * data.term,\n                    first_date: data.firstInstallmentDate,\n                    union: data.allocatedCU,\n                    status: data.status,\n                    applicant: data.applicant\n                };\n                \n                \n                \n                if($scope.result.status == 'SAPR'){\n                   // move to that page where user will get accept or reject button\n                   //once user clicks accept call $scope.acceptApplication();\n                   // else $scope.setActiveStep('rejected');\n                   //  window.pruneBackup();\n                   $scope.application.amount = Math.trunc(data.amount);\n                   $scope.application.form.request.amount = Math.trunc(data.amount);\n                   $scope.application.term = data.term;\n                   $scope.application.form.request.term = data.term;\n                   $scope.application.apr = data.apr;\n                   $scope.suggestedProduct.excellentRate = data.rate;\n                    $scope.suggestedProduct.excellentApr = data.apr;\n                   $scope.setActiveStep('semiapproved');\n                   // $scope.acceptApplication();\n                   // $scope.generateAgreement();\n                }\n                else if ($scope.result.status == 'ADRB'){\n                    $scope.setActiveStep('advicerobo');\n                    $scope.application.amount = data.amount;\n                    $scope.application.apr = data.apr;\n                    $scope.application.term = data.term;\n                    $scope.application.datatoken = data.datatoken;\n                    setTimeout(function() {\n                        var d = document;\n                        var s = 'script';\n                        var id = 'advicerobo_com_sdk';\n                        var js, fjs = d.getElementsByTagName(s)[0];\n                        if (d.getElementById(id)) return;\n                        js = d.createElement(s);\n                        js.id = id;\n                        js.src = \"https://pcs.advicerobo.com/plugin/embed.js \";\n                        fjs.parentNode.insertBefore(js, fjs);\n                        var el = document.getElementById(\"my-questionnaire\");\n                        el.addEventListener(\n                        'ar.questionnaireSubmissionSucceeded',\n                        function(e) {\n                            $scope.setActiveStep('processing');  \n                            $scope.acceptApplication(false);\n                        },\n                        false\n                        );\n\n                        el.addEventListener(\n                        'ar.questionnaireCompleted',\n                        function(e) {\n                            $scope.$apply(function () {\n                                $scope.showLoading= true;\n                            });\n                            \n                            //$scope.setActiveStep('showLoading');\n                            //document.getElementById(\"overlayBox\").className = \"overlay text-center d_block\";\n                        },\n                        false\n                        );\n                    }, 2000);\n                }\n                else if ($scope.result.status == 'APPR') {\n                    $scope.application.amount = data.amount;\n                    $scope.application.term = data.term;\n                    //$scope.confirmBankDetails(false);\n                    $scope.setActiveStep('loanDetails');\n                    //$scope.acceptApplication(false)\n                } else {\n                    $scope.setActiveStep('rejected');\n                    window.pruneBackup();\n                }\n            }, function (err) {\n                $scope.globalErrorMessage = err;\n                $scope.setActiveStep('error');\n                console.error(err);\n            });\n        }\n    };\n    \n    $scope.goToBankDetails = function () {\n        $scope.result.amount = $scope.application.form.request.amount;\n        $scope.result.term = $scope.application.form.request.term;\n        \n        $scope.application.amount = $scope.application.form.request.amount;\n        $scope.application.term = $scope.application.form.request.term;\n        $scope.setActiveStep('loanDetails');\n    }\n    \n    $scope.acceptApplication = function (isRevised) {\n        $scope.loansApi.acceptApplication($scope.application, function (data) {\n            $scope.result = {\n                amount: data.loanAmount,\n                term: data.loanTermMonths,\n                apr: data.loanAPR,\n                monthlies: data.emiAmount,\n                total: data.loanAmount + data.totalInterestDue,\n                first_date: data.firstInstallmentDate,\n                union: data.allocatedCU,\n                status: data.status,\n                applicant : data.applicant\n            };\n            if ($scope.result.status == 'APPR') {\n                $scope.setActiveStep('accepted');\n                $scope.generateAgreement();\n            } else if ($scope.result.status == 'CAPR') {\n                $scope.setActiveStep('conditionallyapproved');\n            } else if ($scope.result.status == 'MAUR') {\n                if(isRevised){\n                    $scope.setActiveStep('rev_manually');\n                }else{\n                    $scope.setActiveStep('manually');\n                }\n                \n                window.pruneBackup();\n            }  else {\n                $scope.setActiveStep('rejected');\n                window.pruneBackup();\n            }\n        }, function (err) {\n            $scope.globalErrorMessage = err;\n            $scope.setActiveStep('error');\n            console.error(err);\n        });\n    };\n\n\n    $scope.generateAgreement = function () {\n        $scope.loansApi.generateAgreement($scope.application, function (data) {\n            if (data && data.esignUrl) {\n                $scope.result.esign = $scope.loansApi.getSafeEsignUrl(data.esignUrl);\n            } \n        }, function (err) {\n            $scope.globalErrorMessage = err;\n            $scope.setActiveStep('error');\n            console.error(err);\n        });\n    };\n\n    $scope.goToAgreement = function () {\n        $scope.setActiveStep('sign');\n        $scope.globalErrorMessage = null;\n    };\n\n    $scope.confirmSignature = function () {\n        UIkit.modal.confirm(\"\\n            <h3>Warning! Before you continue</h3>\\n            <p>Please make sure you've clicked the blue 'Click to Sign' button on the previous agreement document.</p>\\n            <p>If you continue now without clicking this button, your application will not be complete and you will need to start again.</p>\", {\n            labels: {\n                cancel: 'Back to agreement',\n                ok: \"Continue\"\n            }\n        }).then(function() {\n            window.pruneBackup();\n            $scope.$apply(function () {\n                $scope.setActiveStep('confirmation');\n            });\n        });\n    };\n\n    $scope.increaseTerm = function () {\n         $scope.application.form.request.term = $scope.application.form.request.term + 1;\n    };\n\n    $scope.reduceTerm = function () {\n        $scope.application.form.request.term = $scope.application.form.request.term - 1;\n    };\n\n    $scope.increaseAmount = function () {\n         $scope.application.form.request.amount = $scope.application.form.request.amount + 100;\n    };\n\n    $scope.reduceAmount = function () {\n        $scope.application.form.request.amount = $scope.application.form.request.amount - 100;\n    };\n\n    $scope.lookupAddress = function (address) {\n        address.cant_find = false;\n\n        $scope.loansApi.lookupPostcode(address.postcode, function (data) {\n            address.city = data.generic.city;\n            address.street = data.generic.street;\n            address.postcode = data.generic.postcode;\n            address.suggestions = data.suggestions;\n\n            return $scope.updateApplication();\n    }, function (err) {\n            address.cant_find = true;\n            UIkit.notification({\n                message: err,\n                status: 'danger',\n                pos: 'bottom-right'\n            });\n        });\n    };\n\n    $scope.lookupAddressEmp = function (address) {\n        address.cant_find_emp = false;\n\n        $scope.loansApi.lookupPostcode(address.employerPostcode, function (data) {\n            address.employerCity = data.generic.city;\n            address.employerStreet = data.generic.street;\n            address.employerPostcode = data.generic.postcode;\n            address.employerSuggestions = data.suggestions;\n\n            return $scope.updateApplication();\n        }, function (err) {\n            address.cant_find_emp = true;\n            UIkit.notification({\n                message: err,\n                status: 'danger',\n                pos: 'bottom-right'\n            });\n        });\n    };\n\n    $scope.addressThreeYearToggle = function (address) {\n        if (address.less_than_three_years) {\n            $scope.application.form.addresses.push(loanApplicationService.getNewAddress());\n        } else {\n            var index = $scope.application.form.addresses.indexOf(address);\n            $scope.application.form.addresses.splice(index + 1, 1);\n        }\n    };\n\n    $scope.updateApplication = function () {\n        saveApplicationInformation();\n    };\n    $scope.onTextClick = function ($event) {\n        $event.target.select();\n    };\n    \n    $scope.parentObj = {};\n    $scope.parentObj.businesschoiceSelected= true;\n    $scope.setBusiness = function(val){\n      console.info(val);\n      $scope.application.form.personal.employmentSector = val;\n      $scope.parentObj.businesschoiceSelected= false;\n    }\n  \n    $scope.parentObj.occupationchoiceSelected= true;\n    $scope.setOccupation = function(val){\n      console.info(val);\n      $scope.application.form.personal.employmentPosition = val;\n      $scope.parentObj.occupationchoiceSelected= false;\n    }\n\n    $scope.parentObj.employerchoiceSelected= true;\n    $scope.setEmployerName = function(val){\n      console.info(val);\n      $scope.application.form.personal.employer = val;\n      $scope.parentObj.employerchoiceSelected= false;\n    }\n\n    $scope.parentObj.associationchoiceSelected= false;\n    $scope.setAssociation = function(val){\n      console.info(val);\n      $scope.application.form.personal.association = val;\n      $scope.parentObj.associationchoiceSelected= false;\n    }\n\n    self.loanAmtRemoveComma =  function(amt){\n        var loanAmount = amt || '';\n            loanAmount = loanAmount + '';            \n            loanAmount = loanAmount.split(',').join('');\n            return loanAmount;\n    }\n\n    $scope.validateLoanDetails = function () {\n        //console.info($scope.amount.options.floor,$scope.application.form.request.amount ,$scope.amount.options.ceil)\n        \n        if(typeof $scope.application.form == 'undefined' || typeof $scope.amount.options == 'undefined' || typeof $scope.term.options == 'undefined'){\n            return;\n        }\n        else if (loanAmtRemoveComma($scope.application.form.request.amount) < parseInt($scope.amount.options.floor) || loanAmtRemoveComma($scope.application.form.request.amount) > parseInt($scope.amount.options.ceil)) {\n          return \"inv-amt\";\n        } else if ($scope.application.form.request.term < parseInt($scope.term.options.floor) || $scope.application.form.request.term > parseInt($scope.term.options.ceil)) {\n          return \"inv-term\";\n        } else if ($scope.application.form.request.term < parseInt($scope.term.options.floor) || $scope.application.form.request.term > parseInt($scope.application.term)) {\n          return \"inv-term\";\n        } \n      };\n\n      $scope.confirmDetails = function(){\n        $scope.setActiveStep('processing');\n            var weburl = $location.absUrl();\n            if(weburl.split('refId=') && weburl.split('refId=')[1] && weburl.split('refId=')[1].split(\"&\")){\n                $scope.application.form.verify.loanId = weburl.split('refId=')[1].split(\"&\")[0];\n            } else {\n                alert(\"Reference ID not defined\");\n            }\n            $scope.application.form.verify.url = weburl;\n            $scope.loansApi.confirmDetails($scope.application.form.verify, \n            function (data) {\n\n                $scope.result = {\n                    amount: data.amount,\n                    term: data.term,\n                    apr: data.apr,\n                    monthlies: data.monthlyRepayment,\n                    total: data.totalAmount,\n                    applicant : data.fullName\n                };\n\n                $scope.setActiveStep('loanDetails');\n             }, function (err) {\n                $scope.errorMessageConfused = err;\n                $scope.setActiveStep('mismatchDetail');\n            });\n    };\n\n    $scope.benefitCU = function(){\n        $scope.setActiveStep('processing');\n            var weburl = $location.absUrl();\n            if(weburl.split('refId=') && weburl.split('refId=')[1] && weburl.split('refId=')[1].split(\"&\")){\n                $scope.application.form.verify.loanId = weburl.split('refId=')[1].split(\"&\")[0];\n            } else {\n                alert(\"Reference ID not defined\");\n            }\n            $scope.application.form.verify.url = weburl;\n            $scope.loansApi.confirmDetails($scope.application.form.verify, \n            function (data) {\n\n                $scope.result = {\n                    amount: data.amount,\n                    term: data.term,\n                    apr: data.apr,\n                    monthlies: data.monthlyRepayment,\n                    total: data.totalAmount,\n                    applicant : data.fullName\n                };\n\n                $scope.setActiveStep('benefitCreditUnion');\n             }, function (err) {\n                $scope.errorMessageConfused = err;\n                $scope.setActiveStep('mismatchDetail');\n            });\n    };\n\n    $scope.saveDetails = function(){\n        var cuId = angular.element('[data-cuid]').data('cuid');\n        var validation = loanApplicationService.validator.validateBankDetails();\n        if (validation.success) {\n            $scope.setActiveStep('processing');\n            if(cuId == 'BS-0001') $scope.application.form.verify.cuEligibility  = \"true\";\n            $scope.loansApi.saveDetails($scope.application.form.verify, function (data) {\n                \n                 $scope.application\n                 .setId($scope.application.form.verify.loanId);\n                 $scope.application.amount = $scope.result.amount; \n                 $scope.application.term = $scope.result.term; \n                 $scope.acceptApplication();\n             \n                \n             }, function (err) {\n                $scope.errorMessageConfused = err.description;\n                $scope.setActiveStep('mismatchBankDetail');\n            });\n        }\n            \n    };\n    \n\n    $scope.showDebugInformation = function () {\n        var information = localStorage.getItem('applicationFormData') || null;\n        UIkit.modal.alert((\"\\n            <textarea style=\\\"width: 100%; height: 50px; background: black; color: white;\\\">\" + information + \"</textarea>\\n            <p>Please copy/paste all the text from above.</p>\\n        \"));\n    }\n\n    $scope.getMyQuote = function(url){\n        saveSliderInformation();\n        window.location.href = url;\n    }\n\n    $scope.noEmployer = function(){\n        UIkit.modal.confirm(\"\\n            <p>Sorry but we can only lend to people in fulltime employment.</p>\", {\n            labels: {\n                cancel: '',\n                ok: \"Ok\"\n            }\n        }).then(function() {\n            history.back();\n          scope.$apply()\n        });\n    }\n}]).filter('highlight',['$sce', function ($sce) {\n    return function (input, query) {\n      if (query === '' || query == null) {\n          return \"\";\n      } else if (query.length < 1) {\n          return \"\";\n      }\n      return $sce.trustAsHtml(input.toUpperCase().replace(RegExp('('+ query.toUpperCase() + ')', 'g'), '<b class=\"high_light\">$1</b>'));\n    }\n  }])\n.filter('highlight2',['$sce', function ($sce) {\n    return function (input, query) {\n      if (query === '' || query == null) {\n          return $sce.trustAsHtml(input);\n      } else if (query.length < 1) {\n          return $sce.trustAsHtml(input);\n      }\n      return $sce.trustAsHtml(input.toUpperCase().replace(RegExp('('+ query.toUpperCase() + ')', 'g'), '<b class=\"high_light\">$1</b>'));\n    }\n  }])\n\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy90aGVtZS1hc3NldHMvanMvX2FwcGxpY2F0aW9ucy9fbG9hbi1jb250cm9sbGVyLmpzPzM2MjciXSwic291cmNlc0NvbnRlbnQiOlsibXlDb21tdW5pdHlCYW5rLmNvbnRyb2xsZXIoJ2xvYW5BcHBsaWNhdGlvbkNvbnRyb2xsZXInLCBbJyRzY29wZScsICdjdUxvYW5zQXBpRmFjdG9yeScsICckZmlsdGVyJywgJ2xvYW5BcHBsaWNhdGlvblNlcnZpY2UnLCdiYXNlQXBwbGljYXRpb25TZXJ2aWNlJywgJyR0aW1lb3V0JywnJHJvb3RTY29wZScsJyRsb2NhdGlvbicsJyR3aW5kb3cnLCAgZnVuY3Rpb24oJHNjb3BlLCBjdUxvYW5zQXBpRmFjdG9yeSwgJGZpbHRlciwgbG9hbkFwcGxpY2F0aW9uU2VydmljZSxiYXNlQXBwbGljYXRpb25TZXJ2aWNlLCAkdGltZW91dCwkcm9vdFNjb3BlLCRsb2NhdGlvbiwkd2luZG93KXtcblxuICAgIC8qIEhlcmUgd2Ugc2V0dXAgdGhlIHdob2xlIGNvbnRyb2xsZXIgcmVhZHkgdG8gZG8gc3R1ZmYhICovXG4gICAgJHNjb3BlLnN0ZXAgPSAnYXBwbHknO1xuICAgICRzY29wZS5sb2Fuc0FwaSA9IGN1TG9hbnNBcGlGYWN0b3J5O1xuICAgICRzY29wZS5hbGxQcm9kdWN0cyA9IFtdO1xuICAgICRzY29wZS5wcm9kdWN0SWQgPSBhbmd1bGFyLmVsZW1lbnQoJ1tkYXRhLXByb2R1Y3RpZF0nKS5kYXRhKCdwcm9kdWN0aWQnKTtcbiAgICAkc2NvcGUuc3VnZ2VzdGVkUHJvZHVjdCA9IG51bGw7XG4gICAgJHNjb3BlLmdsb2JhbEVycm9yTWVzc2FnZSA9IG51bGw7XG4gICAgXG5cbiAgICAkc2NvcGUubG9hbkN0cmxDb25mID0ge307XG4gICAgJHNjb3BlLmxvYW5DdHJsQ29uZi5jaGFuZ2VEZXRhaWwgPSB0cnVlO1xuICAgIFxuXG4gICAgbGV0IG1ldGFDb25maWcgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgZWwgPSBhbmd1bGFyLmVsZW1lbnQoJ1tkYXRhLW1ldGFdJyk7XG5cbiAgICAgICAgbGV0IGNvbmZpZyA9IHtcbiAgICAgICAgICAgIHRpdGxlczogdHJ1ZSxcbiAgICAgICAgICAgIHNlY3VyaXR5OiB0cnVlLFxuICAgICAgICAgICAgbmF0aW9uYWxpdGllczogdHJ1ZSxcbiAgICAgICAgICAgIHB1cnBvc2VzOiAgdHJ1ZSxcbiAgICAgICAgICAgIGVtcHN0YXR1c3M6ICB0cnVlLFxuICAgICAgICAgICAgY3JlZGl0cmF0aW5nczogIHRydWUsXG4gICAgICAgIH07XG4gICAgICAgIFxuXG4gICAgICAgIGlmIChlbC5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxldCBtb2RzID0gZWwuZGF0YSgnbWV0YScpLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICBfLmVhY2gobW9kcywgZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IG0uc3BsaXQoJzonKTtcbiAgICAgICAgICAgICAgICBjb25maWdbaXRlbVswXS50cmltKCldID0gaXRlbVsxXS50cmltKCkgPT09ICd0cnVlJztcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgIH0pKCk7XG5cbiAgICAkc2NvcGUucmVzdWx0ID0ge1xuICAgICAgICBhcHI6IDAsXG4gICAgICAgIHRlcm06IDAsXG4gICAgICAgIHRvdGFsOiAwLFxuICAgICAgICB1bmlvbjogJycsXG4gICAgICAgIGFtb3VudDogMCxcbiAgICAgICAgbW9udGhsaWVzOiAwLFxuICAgICAgICBmaXJzdF9kYXRlOiAwLFxuICAgICAgICBzdGF0dXM6ICdSRUpUJyxcbiAgICAgICAgZXNpZ246IG51bGxcbiAgICB9O1xuXG4gICAgJHNjb3BlLnN1bW1hcnkgPSB7XG4gICAgICAgIG1vbnRobHlSZXBheW1lbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gbG9hbkFwcGxpY2F0aW9uU2VydmljZS5tb250aGx5UmVwYXltZW50cygkc2NvcGUuc3VnZ2VzdGVkUHJvZHVjdCk7XG4gICAgICAgIH0sXG4gICAgICAgIHRvdGFsUmVwYXltZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gbG9hbkFwcGxpY2F0aW9uU2VydmljZS50b3RhbFJlcGF5bWVudCgkc2NvcGUuc3VnZ2VzdGVkUHJvZHVjdCk7XG4gICAgICAgIH0sXG4gICAgICAgIEFQUjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGxvYW5BcHBsaWNhdGlvblNlcnZpY2UuZ2V0QVBSKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkc2NvcGUuYW1vdW50ID0ge1xuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICBzdGVwOiA1MCxcbiAgICAgICAgICAgICBlbmZvcmNlU3RlcDogZmFsc2UsXG4gICAgICAgICAgICAvLyBlbmZvcmNlUmFuZ2U6IHRydWUsXG4gICAgICAgICAgICBzaG93U2VsZWN0aW9uQmFyOiB0cnVlLFxuICAgICAgICAgICAgb25FbmQ6IHNhdmVBcHBsaWNhdGlvbkluZm9ybWF0aW9uLFxuICAgICAgICAgICAgdHJhbnNsYXRlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGZpbHRlcignY3VycmVuY3knKSh2YWx1ZSwgJyZwb3VuZCcpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLmFwciA9IHtcbiAgICAgICAgb3B0aW9ucyA6IHtcblxuICAgICAgICB9XG4gICAgfVxuXG4gICAgJHNjb3BlLnRlcm0gPSB7XG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIHN0ZXA6IDEsXG4gICAgICAgICAgICBzaG93U2VsZWN0aW9uQmFyOiB0cnVlLFxuICAgICAgICAgICAgLy8gZW5mb3JjZVJhbmdlOiB0cnVlLFxuICAgICAgICAgICAgIGVuZm9yY2VTdGVwOiBmYWxzZSxcbiAgICAgICAgICAgIG9uRW5kOiBzYXZlQXBwbGljYXRpb25JbmZvcm1hdGlvbixcbiAgICAgICAgICAgIHRyYW5zbGF0ZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke3ZhbHVlfSBtb250aHNgXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAkc2NvcGUuYXBwbGljYXRpb24gPSBsb2FuQXBwbGljYXRpb25TZXJ2aWNlLmF0dGFjaFNjb3BlKCRzY29wZSk7XG4gICAgJHNjb3BlLmxvYW5zQXBpLnN5bmNNZXRhKCRzY29wZS5tZXRhLCBtZXRhQ29uZmlnKTtcblxuICAgIGZ1bmN0aW9uIHNldHVwU2xpZGVycyAocHJvZHVjdCkge1xuICAgICAgICAkc2NvcGUuYW1vdW50Lm9wdGlvbnMuZmxvb3IgPSBwcm9kdWN0Lm1pbkxvYW5BbW91bnQ7XG4gICAgICAgICRzY29wZS5hbW91bnQub3B0aW9ucy5jZWlsID0gcHJvZHVjdC5tYXhMb2FuQW1vdW50O1xuICAgICAgICAkcm9vdFNjb3BlLm1heEFwciA9IHByb2R1Y3QuZmFpckFwcjtcbiAgICAgICAgJHJvb3RTY29wZS5taW5BcHIgPSBwcm9kdWN0LmV4Y2VsbGVudEFwcjtcbiAgICAgICAgaWYobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xvYW5BbW91bnQnKSA8IHByb2R1Y3QubWluTG9hbkFtb3VudCB8fCBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbG9hbkFtb3VudCcpID4gcHJvZHVjdC5tYXhMb2FuQW1vdW50KXtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdsb2FuQW1vdW50JywnbnVsbCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsb2FuQW1vdW50JykgIT0gJ3VuZGVmaW5lZCcgJiYgJ251bGwnICE9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsb2FuQW1vdW50JykgJiYgbnVsbCAhPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbG9hbkFtb3VudCcpKVxuICAgICAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucmVxdWVzdC5hbW91bnQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbG9hbkFtb3VudCcpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5yZXF1ZXN0LmFtb3VudCA9IHByb2R1Y3QubWluTG9hbkFtb3VudDtcblxuICAgICAgICAkc2NvcGUudGVybS5vcHRpb25zLmZsb29yID0gcHJvZHVjdC5taW5Mb2FuVGVybUluTW9udGhzO1xuICAgICAgICAkc2NvcGUudGVybS5vcHRpb25zLmNlaWwgPSBwcm9kdWN0Lm1heExvYW5UZXJtSW5Nb250aHM7XG4gICAgICAgIGlmKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsb2FuVGVybScpIDwgcHJvZHVjdC5taW5Mb2FuVGVybUluTW9udGhzIHx8IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsb2FuVGVybScpID4gcHJvZHVjdC5tYXhMb2FuVGVybUluTW9udGhzKXtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdsb2FuVGVybScsJ251bGwnKTtcbiAgICAgICAgfVxuICAgICAgICBpZihsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbG9hblRlcm0nKSAhPSAndW5kZWZpbmVkJyAmJiAnbnVsbCcgIT0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xvYW5UZXJtJykgJiYgbnVsbCAhPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbG9hblRlcm0nKSkgXG4gICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5yZXF1ZXN0LnRlcm0gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbG9hblRlcm0nKTtcbiAgICAgICAgZWxzZSBcbiAgICAgICAgICRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnJlcXVlc3QudGVybSA9IHByb2R1Y3QubWluTG9hblRlcm1Jbk1vbnRocztcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gbG9hZEFwcGxpY2F0aW9uICgpIHtcbiAgICAgICAgaWYgKCRzY29wZS5hcHBsaWNhdGlvbi5nZXRJZCgpKSB7XG4gICAgICAgICAgICBjb250aW51ZUFwcGxpY2F0aW9uKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdGFydEFwcGxpY2F0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gY29udGludWVBcHBsaWNhdGlvbiAoKSB7XG4gICAgICAgIGxldCBjdUlkID0gYW5ndWxhci5lbGVtZW50KCdbZGF0YS1jdWlkXScpLmRhdGEoJ2N1aWQnKTtcbiAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLnNldEN1SWQoY3VJZCk7XG4gICAgICAgIHNhdmVTbGlkZXJJbmZvcm1hdGlvbigpO1xuICAgICAgICBzYXZlQXBwbGljYXRpb25JbmZvcm1hdGlvbigpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBzdGFydEFwcGxpY2F0aW9uICgpIHtcbiAgICAgICAgc2F2ZVNsaWRlckluZm9ybWF0aW9uKCk7XG5cbiAgICAgICAgaWYgKCRzY29wZS5zdWdnZXN0ZWRQcm9kdWN0KSB7XG4gICAgICAgICAgICAkc2NvcGUubG9hbnNBcGkuc3RhcnRBcHBsaWNhdGlvbigkc2NvcGUuc3VnZ2VzdGVkUHJvZHVjdCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3VJZCA9IGFuZ3VsYXIuZWxlbWVudCgnW2RhdGEtY3VpZF0nKS5kYXRhKCdjdWlkJyk7XG5cbiAgICAgICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb25cbiAgICAgICAgICAgICAgICAgICAgLnNldElkKGRhdGEuTG9hbkFwcGxpY2F0aW9uSUQpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRDdUlkKGN1SWQpXG5cbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNhdmVCYWNrdXAoKTtcblxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHNhdmVTbGlkZXJJbmZvcm1hdGlvbiAoKSB7XG4gICAgICBcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2xvYW5BbW91bnQnLCAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5yZXF1ZXN0LmFtb3VudCk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdsb2FuVGVybScsICRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnJlcXVlc3QudGVybSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHNhdmVBcHBsaWNhdGlvbkluZm9ybWF0aW9uICgpIHtcbiAgICAgICAgLy8gRG9udCBib3RoZXIgZG9pbmcgYW55dGhpbmcgaWYgd2VcbiAgICAgICAgLy8gaGF2ZSBub3QgbWF0Y2hlZCBhIHByb2R1Y3RcbiAgICAgICAgaWYgKCEkc2NvcGUuc3VnZ2VzdGVkUHJvZHVjdCB8fCAhJHNjb3BlLmFwcGxpY2F0aW9uLmdldElkKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNhdmVTbGlkZXJJbmZvcm1hdGlvbigpO1xuXG4gICAgICAgIGxldCBjb25zdHJ1Y3RlZEFwcGxpY2F0aW9uRGF0YSA9ICRzY29wZS5hcHBsaWNhdGlvbi5wcmVwYXJlRm9yQXBpKCk7XG5cbiAgICAgICAgJHNjb3BlLmxvYW5zQXBpLnN5bmNBcHBsaWNhdGlvbihjb25zdHJ1Y3RlZEFwcGxpY2F0aW9uRGF0YSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBmaW5kUHJvZHVjdCAoY2FsbGJhY2spIHtcbiAgICAgICB2YXIgdW5kZXIgPSBfLm5vQ29uZmxpY3QoKTsgXG4gICAgICAgaWYodHlwZW9mIHVuZGVyLmZpbmRXaGVyZSAhPSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgdW5kZXIuZmluZFdoZXJlID09ICdmdW5jdGlvbicpe1xuICAgICAgICAkc2NvcGUuc3VnZ2VzdGVkUHJvZHVjdCA9IHVuZGVyLmZpbmRXaGVyZSgkc2NvcGUucHJvZHVjdHMsIHtcbiAgICAgICAgICAgIGxvYW5Qcm9kdWN0SWQ6ICRzY29wZS5wcm9kdWN0SWQgICAgICAgICAgICBcbiAgICAgICAgfSk7XG4gICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLnN1Z2dlc3RlZFByb2R1Y3QgPSBfLmZpbmRXaGVyZSgkc2NvcGUucHJvZHVjdHMsIHtcbiAgICAgICAgICAgIGxvYW5Qcm9kdWN0SWQ6ICRzY29wZS5wcm9kdWN0SWQgICAgICAgICAgICBcbiAgICAgICAgfSk7XG4gICAgICAgfVxuXG4gICAgICAgIGNhbGxiYWNrKCRzY29wZS5zdWdnZXN0ZWRQcm9kdWN0KTtcbiAgICB9O1xuICAgIFxuICAgICRzY29wZS5sb2Fuc0FwaS5mZXRjaEVtcGxveWVyTGlzdChmdW5jdGlvbiAoZGF0YSl7XG4gICAgICAgICRzY29wZS5lbXBsb3llckxpc3QgPSBkYXRhO1xuICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgVUlraXQubm90aWZpY2F0aW9uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycixcbiAgICAgICAgICAgIHN0YXR1czogJ2RhbmdlcicsXG4gICAgICAgICAgICBwb3M6ICdib3R0b20tcmlnaHQnXG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLnRvZ2dsZVNlYXJjaCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJHdpbmRvdy5vbmNsaWNrID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLm1lbnVPcGVuID0gISRzY29wZS5tZW51T3BlbjtcbiAgICBcbiAgICAgICAgaWYgKCRzY29wZS5tb2RlbC5tZW51T3Blbikge1xuICAgICAgICAgICAgJHdpbmRvdy5vbmNsaWNrID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lbnVPcGVuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkd2luZG93Lm9uY2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmKGUudGFyZ2V0LmNsYXNzTmFtZS5zcGxpdChcIiBcIikuaW5kZXhPZihcImNsaWNrb3V0c2lkZVwiKSA8IDApXG4gICAgICAgIHtcbiAgICAgICAgICAgICRzY29wZS5wYXJlbnRPYmouYnVzaW5lc3NjaG9pY2VTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLnBhcmVudE9iai5vY2N1cGF0aW9uY2hvaWNlU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICRzY29wZS5wYXJlbnRPYmouZW1wbG95ZXJjaG9pY2VTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLnBhcmVudE9iai5hc3NvY2lhdGlvbmNob2ljZVNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkc2NvcGUubG9hbnNBcGkuZmV0Y2hCdXNpbmVzc0xpc3QoZnVuY3Rpb24gKGRhdGEpe1xuICAgICAgICAkc2NvcGUuYnVzaW5lc3NMaXN0ID0gZGF0YTtcbiAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIFVJa2l0Lm5vdGlmaWNhdGlvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiBlcnIsXG4gICAgICAgICAgICBzdGF0dXM6ICdkYW5nZXInLFxuICAgICAgICAgICAgcG9zOiAnYm90dG9tLXJpZ2h0J1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgICRzY29wZS5sb2Fuc0FwaS5mZXRjaE9jY3VwYXRpb25MaXN0KGZ1bmN0aW9uIChkYXRhKXtcbiAgICAgICAgJHNjb3BlLm9jY3VwYXRpb25MaXN0ID0gZGF0YTtcbiAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIFVJa2l0Lm5vdGlmaWNhdGlvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiBlcnIsXG4gICAgICAgICAgICBzdGF0dXM6ICdkYW5nZXInLFxuICAgICAgICAgICAgcG9zOiAnYm90dG9tLXJpZ2h0J1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgICRzY29wZS5sb2Fuc0FwaS5mZXRjaEFzc29jaWF0aW9uTGlzdChmdW5jdGlvbiAoZGF0YSl7XG4gICAgICAkc2NvcGUuYXNzb2NpYXRpb25MaXN0ID0gW107XG4gICAgICBmb3IodmFyIGkgaW4gZGF0YSkgIHtcbiAgICAgICAgJHNjb3BlLmFzc29jaWF0aW9uTGlzdC5wdXNoKGRhdGFbaV0uYXNzb2NpYXRpb25OYW1lKTtcbiAgICAgIH1cbiAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIFVJa2l0Lm5vdGlmaWNhdGlvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiBlcnIsXG4gICAgICAgICAgICBzdGF0dXM6ICdkYW5nZXInLFxuICAgICAgICAgICAgcG9zOiAnYm90dG9tLXJpZ2h0J1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuXG4gICAgJHNjb3BlLmxvYW5zQXBpLmZldGNoRW1wbG95ZXJMaXN0KGZ1bmN0aW9uIChkYXRhKXtcbiAgICAgICAgXG4gICAgICAgICRzY29wZS5lbXBsb3llckxpc3QgPSBkYXRhO1xuICAgICAgICBcbiAgICAgICAgXG5cbiAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIFVJa2l0Lm5vdGlmaWNhdGlvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiBlcnIsXG4gICAgICAgICAgICBzdGF0dXM6ICdkYW5nZXInLFxuICAgICAgICAgICAgcG9zOiAnYm90dG9tLXJpZ2h0J1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgICRzY29wZS5sb2Fuc0FwaS5mZXRjaENoYXJpdHlMaXN0KGZ1bmN0aW9uIChkYXRhKXtcbiAgICAgICAgXG4gICAgICAgICRzY29wZS5jaGFyaXR5TGlzdCA9IGRhdGE7XG4gICAgICAgIFxuICAgICAgICBcblxuICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgVUlraXQubm90aWZpY2F0aW9uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycixcbiAgICAgICAgICAgIHN0YXR1czogJ2RhbmdlcicsXG4gICAgICAgICAgICBwb3M6ICdib3R0b20tcmlnaHQnXG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLmxvYW5zQXBpLmZldGNoUHJvZHVjdHMoZnVuY3Rpb24gKGRhdGEpe1xuICAgICAgICBsZXQgcHJvZElkID0gYW5ndWxhci5lbGVtZW50KCdbZGF0YS1wcm9kdWN0aWRdJykuZGF0YSgncHJvZHVjdGlkJyk7XG4gICAgICAgIGlmKFwiUkVGRVJcIiA9PSBwcm9kSWQpIHtcbiAgICAgICAgICAgIC8vY2FsbCBhcGkgdG8gc2VuZCBzbXMvZW1haWxcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIGlmKFwiTkFcIiA9PSBwcm9kSWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAkc2NvcGUucHJvZHVjdHMgPSBkYXRhO1xuXG4gICAgICAgIFxuXG4gICAgICAgIHJldHVybiBmaW5kUHJvZHVjdChmdW5jdGlvbiAocHJvZHVjdCkge1xuICAgICAgICAgICAgJHNjb3BlLmFwci5vcHRpb25zLm1heEFwciA9IHByb2R1Y3QuZmFpckFwcjtcbiAgICAgICAgICAgICRzY29wZS5hcHIub3B0aW9ucy5taW5BcHIgPSBwcm9kdWN0LmV4Y2VsbGVudEFwcjtcbiAgICAgICAgICAgIHNldHVwU2xpZGVycyhwcm9kdWN0KTtcbiAgICAgICAgICAgIGxvYWRBcHBsaWNhdGlvbigpO1xuICAgICAgICB9KTtcblxuICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgVUlraXQubm90aWZpY2F0aW9uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycixcbiAgICAgICAgICAgIHN0YXR1czogJ2RhbmdlcicsXG4gICAgICAgICAgICBwb3M6ICdib3R0b20tcmlnaHQnXG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLyogV2UncmUgbm93IHJlYWR5IHRvIHN0YXJ0IGRvaW5nIHN0dWZmIHdpdGggdGhlIGZvcm0gKi9cblxuICAgICRzY29wZS5pc0FjdGl2ZVN0ZXAgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgICByZXR1cm4gJHNjb3BlLnN0ZXAgPT0gc3RlcDtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNldEFjdGl2ZVN0ZXAgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgICAkc2NvcGUuc3RlcCA9IHN0ZXA7XG5cbiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbGV0IGVsID0galF1ZXJ5KCcuYXBwbGljYXRpb24tc2VjdGlvbiwgLnByb2Nlc3Npbmctc3RlcCcpO1xuXG4gICAgICAgICAgICBpZiAoZWwubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0ID0gZWwuZXEoMCkucG9zaXRpb24oKS50b3AgLSAxNTtcblxuICAgICAgICAgICAgICAgIGpRdWVyeSgnaHRtbCwgYm9keScpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IG9mZnNldFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAxNTApO1xuXG4gICAgICAgIHJldHVybiAkc2NvcGUuc3RlcDtcbiAgICB9O1xuICAgICRzY29wZS5jb250ZW50WWVzPSAnbm8nO1xuICAgICRzY29wZS5jaGFuZ2VFbXBsb3llclN0YXVzID0gZnVuY3Rpb24gKCl7XG4gICAgICAgIHZhciBhbGxvd2VkRW1wID0gW1wiY2VcIiwgXCJzZVwiLCBcInRlXCIsIFwiZW1cIiwgXCJyZVwiXTtcbiAgICAgICAgaWYoYmFzZUFwcGxpY2F0aW9uU2VydmljZS5nZXRDdUlkKCkgPT0gJ0MtMDAwMicpIHtcbiAgICAgICAgICAgIGlmKGFsbG93ZWRFbXAuaW5kZXhPZigkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5wZXJzb25hbC5lbXBsb3ltZW50U3RhdHVzKT4tMSl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnRZZXM9ICd5ZXMnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29udGVudFllcz0gJ25vJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmKGFsbG93ZWRFbXAuaW5kZXhPZigkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5wZXJzb25hbC5lbXBsb3ltZW50U3RhdHVzKT09LTEpe1xuICAgICAgICAgICAgICAgICRzY29wZS5ub0VtcGxveWVyKCk7XG4gICAgICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnRZZXM9ICd5ZXMnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgJHNjb3BlLnN1Ym1pdEFwcGxpY2F0aW9uID0gZnVuY3Rpb24gKCkgeyAgICAgICAgXG4gICAgICAgIHZhciBpbmNvbWUgPSBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLmdldEFubnVhbEluY29tZSgpOyAgICAgICAgIFxuICAgICAgICBpZihpbmNvbWUgPCAxODAwMCAmJiBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLmdldEN1SWQoKSAhPSAnQy0wMDAyJyl7XG4gICAgICAgICAgICBVSWtpdC5tb2RhbC5jb25maXJtKGBcbiAgICAgICAgICAgICAgICA8cD5Tb3JyeSBidXQgd2UgY2FuIG9ubHkgbGVuZCB0byBwZW9wbGUgd2l0aCBhbm51YWwgaW5jb21lIGFib3ZlICZwb3VuZDsxODAwMC48L3A+YCwge1xuICAgICAgICAgICAgICAgIGxhYmVsczoge1xuICAgICAgICAgICAgICAgICAgICBjYW5jZWw6ICcnLFxuICAgICAgICAgICAgICAgICAgICBvazogXCJPa1wiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBoaXN0b3J5LmJhY2soKTtcbiAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAgICAgICAgXG4gICAgICAgIGlmICgkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5hZGRyZXNzZXMgIT0gJ3VuZGVmaW5lZCcgJiYgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0uYWRkcmVzc2VzLmxlbmd0aCA+IDAgJiYgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0uYWRkcmVzc2VzWzBdLnBvc3Rjb2RlID09ICRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnBlcnNvbmFsLmVtcGxveWVyUG9zdGNvZGUgJiYgJ1NlbGYgRW1wbG95ZWQnID09ICRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnBlcnNvbmFsLmVtcGxveWVyKSB7XG4gICAgICAgICAgICBVSWtpdC5tb2RhbC5jb25maXJtKGBcbiAgICAgICAgICAgICAgICA8cD5Tb3JyeSBidXQgd2UgY2FuIG9ubHkgbGVuZCB0byBwZW9wbGUgaW4gZnVsbHRpbWUgZW1wbG95bWVudC48L3A+YCwge1xuICAgICAgICAgICAgICAgIGxhYmVsczoge1xuICAgICAgICAgICAgICAgICAgICBjYW5jZWw6ICcnLFxuICAgICAgICAgICAgICAgICAgICBvazogXCJPa1wiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBoaXN0b3J5LmJhY2soKTtcbiAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gXG5cbiAgICAgICAgbGV0IHZhbGlkYXRpb24gPSBsb2FuQXBwbGljYXRpb25TZXJ2aWNlLnZhbGlkYXRvci5nbygpO1xuICAgICAgICAkc2NvcGUuZ2xvYmFsRXJyb3JNZXNzYWdlID0gbnVsbDtcblxuICAgICAgICBcblxuICAgICAgICBpZiAodmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgICAgICAkc2NvcGUuc2V0QWN0aXZlU3RlcCgncHJvY2Vzc2luZycpO1xuICAgICAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0udmVyaWZ5LmxvYW5JZCA9ICRzY29wZS5hcHBsaWNhdGlvbi5nZXRJZCgpO1xuICAgICAgICAgICAgJHNjb3BlLmxvYW5zQXBpLnN1Ym1pdEFwcGxpY2F0aW9uKCRzY29wZS5hcHBsaWNhdGlvbiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgZW1pID0gbG9hbkFwcGxpY2F0aW9uU2VydmljZS5jYWxjdWxhdGVNb250aGx5UGF5bWVudChkYXRhLmFtb3VudCxkYXRhLnRlcm0sZGF0YS5yYXRlKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGRhdGEuYW1vdW50LFxuICAgICAgICAgICAgICAgICAgICB0ZXJtOiBkYXRhLnRlcm0sXG4gICAgICAgICAgICAgICAgICAgIGFwcjogZGF0YS5hcHIsXG4gICAgICAgICAgICAgICAgICAgIG1vbnRobGllczogZW1pICxcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IGVtaSAqIGRhdGEudGVybSxcbiAgICAgICAgICAgICAgICAgICAgZmlyc3RfZGF0ZTogZGF0YS5maXJzdEluc3RhbGxtZW50RGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgdW5pb246IGRhdGEuYWxsb2NhdGVkQ1UsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogZGF0YS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIGFwcGxpY2FudDogZGF0YS5hcHBsaWNhbnRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKCRzY29wZS5yZXN1bHQuc3RhdHVzID09ICdTQVBSJyl7XG4gICAgICAgICAgICAgICAgICAgLy8gbW92ZSB0byB0aGF0IHBhZ2Ugd2hlcmUgdXNlciB3aWxsIGdldCBhY2NlcHQgb3IgcmVqZWN0IGJ1dHRvblxuICAgICAgICAgICAgICAgICAgIC8vb25jZSB1c2VyIGNsaWNrcyBhY2NlcHQgY2FsbCAkc2NvcGUuYWNjZXB0QXBwbGljYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAvLyBlbHNlICRzY29wZS5zZXRBY3RpdmVTdGVwKCdyZWplY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgIC8vICB3aW5kb3cucHJ1bmVCYWNrdXAoKTtcbiAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uYW1vdW50ID0gTWF0aC50cnVuYyhkYXRhLmFtb3VudCk7XG4gICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucmVxdWVzdC5hbW91bnQgPSBNYXRoLnRydW5jKGRhdGEuYW1vdW50KTtcbiAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24udGVybSA9IGRhdGEudGVybTtcbiAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5yZXF1ZXN0LnRlcm0gPSBkYXRhLnRlcm07XG4gICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLmFwciA9IGRhdGEuYXByO1xuICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWdnZXN0ZWRQcm9kdWN0LmV4Y2VsbGVudFJhdGUgPSBkYXRhLnJhdGU7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWdnZXN0ZWRQcm9kdWN0LmV4Y2VsbGVudEFwciA9IGRhdGEuYXByO1xuICAgICAgICAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdzZW1pYXBwcm92ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAvLyAkc2NvcGUuYWNjZXB0QXBwbGljYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAvLyAkc2NvcGUuZ2VuZXJhdGVBZ3JlZW1lbnQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLnJlc3VsdC5zdGF0dXMgPT0gJ0FEUkInKXtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNldEFjdGl2ZVN0ZXAoJ2FkdmljZXJvYm8nKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLmFtb3VudCA9IGRhdGEuYW1vdW50O1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uYXByID0gZGF0YS5hcHI7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBsaWNhdGlvbi50ZXJtID0gZGF0YS50ZXJtO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uZGF0YXRva2VuID0gZGF0YS5kYXRhdG9rZW47XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGRvY3VtZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSAnc2NyaXB0JztcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZCA9ICdhZHZpY2Vyb2JvX2NvbV9zZGsnO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGpzLCBmanMgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKHMpWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQuZ2V0RWxlbWVudEJ5SWQoaWQpKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICBqcyA9IGQuY3JlYXRlRWxlbWVudChzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpzLmlkID0gaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBqcy5zcmMgPSBcImh0dHBzOi8vcGNzLmFkdmljZXJvYm8uY29tL3BsdWdpbi9lbWJlZC5qcyBcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZqcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqcywgZmpzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibXktcXVlc3Rpb25uYWlyZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAnYXIucXVlc3Rpb25uYWlyZVN1Ym1pc3Npb25TdWNjZWVkZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdwcm9jZXNzaW5nJyk7ICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWNjZXB0QXBwbGljYXRpb24oZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2FyLnF1ZXN0aW9ubmFpcmVDb21wbGV0ZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0xvYWRpbmc9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGUuc2V0QWN0aXZlU3RlcCgnc2hvd0xvYWRpbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3ZlcmxheUJveFwiKS5jbGFzc05hbWUgPSBcIm92ZXJsYXkgdGV4dC1jZW50ZXIgZF9ibG9ja1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICB9LCAyMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLnJlc3VsdC5zdGF0dXMgPT0gJ0FQUFInKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBsaWNhdGlvbi5hbW91bnQgPSBkYXRhLmFtb3VudDtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLnRlcm0gPSBkYXRhLnRlcm07XG4gICAgICAgICAgICAgICAgICAgIC8vJHNjb3BlLmNvbmZpcm1CYW5rRGV0YWlscyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdsb2FuRGV0YWlscycpO1xuICAgICAgICAgICAgICAgICAgICAvLyRzY29wZS5hY2NlcHRBcHBsaWNhdGlvbihmYWxzZSlcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0QWN0aXZlU3RlcCgncmVqZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnBydW5lQmFja3VwKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICRzY29wZS5nbG9iYWxFcnJvck1lc3NhZ2UgPSBlcnI7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNldEFjdGl2ZVN0ZXAoJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFxuICAgICRzY29wZS5nb1RvQmFua0RldGFpbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRzY29wZS5yZXN1bHQuYW1vdW50ID0gJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucmVxdWVzdC5hbW91bnQ7XG4gICAgICAgICRzY29wZS5yZXN1bHQudGVybSA9ICRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnJlcXVlc3QudGVybTtcbiAgICAgICAgXG4gICAgICAgICRzY29wZS5hcHBsaWNhdGlvbi5hbW91bnQgPSAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5yZXF1ZXN0LmFtb3VudDtcbiAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLnRlcm0gPSAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5yZXF1ZXN0LnRlcm07XG4gICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdsb2FuRGV0YWlscycpO1xuICAgIH1cbiAgICBcbiAgICAkc2NvcGUuYWNjZXB0QXBwbGljYXRpb24gPSBmdW5jdGlvbiAoaXNSZXZpc2VkKSB7XG4gICAgICAgICRzY29wZS5sb2Fuc0FwaS5hY2NlcHRBcHBsaWNhdGlvbigkc2NvcGUuYXBwbGljYXRpb24sIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAkc2NvcGUucmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgIGFtb3VudDogZGF0YS5sb2FuQW1vdW50LFxuICAgICAgICAgICAgICAgIHRlcm06IGRhdGEubG9hblRlcm1Nb250aHMsXG4gICAgICAgICAgICAgICAgYXByOiBkYXRhLmxvYW5BUFIsXG4gICAgICAgICAgICAgICAgbW9udGhsaWVzOiBkYXRhLmVtaUFtb3VudCxcbiAgICAgICAgICAgICAgICB0b3RhbDogZGF0YS5sb2FuQW1vdW50ICsgZGF0YS50b3RhbEludGVyZXN0RHVlLFxuICAgICAgICAgICAgICAgIGZpcnN0X2RhdGU6IGRhdGEuZmlyc3RJbnN0YWxsbWVudERhdGUsXG4gICAgICAgICAgICAgICAgdW5pb246IGRhdGEuYWxsb2NhdGVkQ1UsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICBhcHBsaWNhbnQgOiBkYXRhLmFwcGxpY2FudFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmICgkc2NvcGUucmVzdWx0LnN0YXR1cyA9PSAnQVBQUicpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2V0QWN0aXZlU3RlcCgnYWNjZXB0ZWQnKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ2VuZXJhdGVBZ3JlZW1lbnQoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLnJlc3VsdC5zdGF0dXMgPT0gJ0NBUFInKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNldEFjdGl2ZVN0ZXAoJ2NvbmRpdGlvbmFsbHlhcHByb3ZlZCcpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgkc2NvcGUucmVzdWx0LnN0YXR1cyA9PSAnTUFVUicpIHtcbiAgICAgICAgICAgICAgICBpZihpc1JldmlzZWQpe1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0QWN0aXZlU3RlcCgncmV2X21hbnVhbGx5Jyk7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdtYW51YWxseScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB3aW5kb3cucHJ1bmVCYWNrdXAoKTtcbiAgICAgICAgICAgIH0gIGVsc2Uge1xuICAgICAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdyZWplY3RlZCcpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5wcnVuZUJhY2t1cCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAkc2NvcGUuZ2xvYmFsRXJyb3JNZXNzYWdlID0gZXJyO1xuICAgICAgICAgICAgJHNjb3BlLnNldEFjdGl2ZVN0ZXAoJ2Vycm9yJyk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgIH0pO1xuICAgIH07XG5cblxuICAgICRzY29wZS5nZW5lcmF0ZUFncmVlbWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJHNjb3BlLmxvYW5zQXBpLmdlbmVyYXRlQWdyZWVtZW50KCRzY29wZS5hcHBsaWNhdGlvbiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEuZXNpZ25VcmwpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0LmVzaWduID0gJHNjb3BlLmxvYW5zQXBpLmdldFNhZmVFc2lnblVybChkYXRhLmVzaWduVXJsKTtcbiAgICAgICAgICAgIH0gXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICRzY29wZS5nbG9iYWxFcnJvck1lc3NhZ2UgPSBlcnI7XG4gICAgICAgICAgICAkc2NvcGUuc2V0QWN0aXZlU3RlcCgnZXJyb3InKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5nb1RvQWdyZWVtZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAkc2NvcGUuc2V0QWN0aXZlU3RlcCgnc2lnbicpO1xuICAgICAgICAkc2NvcGUuZ2xvYmFsRXJyb3JNZXNzYWdlID0gbnVsbDtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmNvbmZpcm1TaWduYXR1cmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIFVJa2l0Lm1vZGFsLmNvbmZpcm0oYFxuICAgICAgICAgICAgPGgzPldhcm5pbmchIEJlZm9yZSB5b3UgY29udGludWU8L2gzPlxuICAgICAgICAgICAgPHA+UGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgY2xpY2tlZCB0aGUgYmx1ZSAnQ2xpY2sgdG8gU2lnbicgYnV0dG9uIG9uIHRoZSBwcmV2aW91cyBhZ3JlZW1lbnQgZG9jdW1lbnQuPC9wPlxuICAgICAgICAgICAgPHA+SWYgeW91IGNvbnRpbnVlIG5vdyB3aXRob3V0IGNsaWNraW5nIHRoaXMgYnV0dG9uLCB5b3VyIGFwcGxpY2F0aW9uIHdpbGwgbm90IGJlIGNvbXBsZXRlIGFuZCB5b3Ugd2lsbCBuZWVkIHRvIHN0YXJ0IGFnYWluLjwvcD5gLCB7XG4gICAgICAgICAgICBsYWJlbHM6IHtcbiAgICAgICAgICAgICAgICBjYW5jZWw6ICdCYWNrIHRvIGFncmVlbWVudCcsXG4gICAgICAgICAgICAgICAgb2s6IFwiQ29udGludWVcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2luZG93LnBydW5lQmFja3VwKCk7XG4gICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2V0QWN0aXZlU3RlcCgnY29uZmlybWF0aW9uJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5pbmNyZWFzZVRlcm0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5yZXF1ZXN0LnRlcm0gPSAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5yZXF1ZXN0LnRlcm0gKyAxO1xuICAgIH07XG5cbiAgICAkc2NvcGUucmVkdWNlVGVybSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucmVxdWVzdC50ZXJtID0gJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucmVxdWVzdC50ZXJtIC0gMTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmluY3JlYXNlQW1vdW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucmVxdWVzdC5hbW91bnQgPSAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5yZXF1ZXN0LmFtb3VudCArIDEwMDtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnJlZHVjZUFtb3VudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucmVxdWVzdC5hbW91bnQgPSAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5yZXF1ZXN0LmFtb3VudCAtIDEwMDtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmxvb2t1cEFkZHJlc3MgPSBmdW5jdGlvbiAoYWRkcmVzcykge1xuICAgICAgICBhZGRyZXNzLmNhbnRfZmluZCA9IGZhbHNlO1xuXG4gICAgICAgICRzY29wZS5sb2Fuc0FwaS5sb29rdXBQb3N0Y29kZShhZGRyZXNzLnBvc3Rjb2RlLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgYWRkcmVzcy5jaXR5ID0gZGF0YS5nZW5lcmljLmNpdHk7XG4gICAgICAgICAgICBhZGRyZXNzLnN0cmVldCA9IGRhdGEuZ2VuZXJpYy5zdHJlZXQ7XG4gICAgICAgICAgICBhZGRyZXNzLnBvc3Rjb2RlID0gZGF0YS5nZW5lcmljLnBvc3Rjb2RlO1xuICAgICAgICAgICAgYWRkcmVzcy5zdWdnZXN0aW9ucyA9IGRhdGEuc3VnZ2VzdGlvbnM7XG5cbiAgICAgICAgICAgIHJldHVybiAkc2NvcGUudXBkYXRlQXBwbGljYXRpb24oKTtcbiAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBhZGRyZXNzLmNhbnRfZmluZCA9IHRydWU7XG4gICAgICAgICAgICBVSWtpdC5ub3RpZmljYXRpb24oe1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycixcbiAgICAgICAgICAgICAgICBzdGF0dXM6ICdkYW5nZXInLFxuICAgICAgICAgICAgICAgIHBvczogJ2JvdHRvbS1yaWdodCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmxvb2t1cEFkZHJlc3NFbXAgPSBmdW5jdGlvbiAoYWRkcmVzcykge1xuICAgICAgICBhZGRyZXNzLmNhbnRfZmluZF9lbXAgPSBmYWxzZTtcblxuICAgICAgICAkc2NvcGUubG9hbnNBcGkubG9va3VwUG9zdGNvZGUoYWRkcmVzcy5lbXBsb3llclBvc3Rjb2RlLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgYWRkcmVzcy5lbXBsb3llckNpdHkgPSBkYXRhLmdlbmVyaWMuY2l0eTtcbiAgICAgICAgICAgIGFkZHJlc3MuZW1wbG95ZXJTdHJlZXQgPSBkYXRhLmdlbmVyaWMuc3RyZWV0O1xuICAgICAgICAgICAgYWRkcmVzcy5lbXBsb3llclBvc3Rjb2RlID0gZGF0YS5nZW5lcmljLnBvc3Rjb2RlO1xuICAgICAgICAgICAgYWRkcmVzcy5lbXBsb3llclN1Z2dlc3Rpb25zID0gZGF0YS5zdWdnZXN0aW9ucztcblxuICAgICAgICAgICAgcmV0dXJuICRzY29wZS51cGRhdGVBcHBsaWNhdGlvbigpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBhZGRyZXNzLmNhbnRfZmluZF9lbXAgPSB0cnVlO1xuICAgICAgICAgICAgVUlraXQubm90aWZpY2F0aW9uKHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnIsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnZGFuZ2VyJyxcbiAgICAgICAgICAgICAgICBwb3M6ICdib3R0b20tcmlnaHQnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5hZGRyZXNzVGhyZWVZZWFyVG9nZ2xlID0gZnVuY3Rpb24gKGFkZHJlc3MpIHtcbiAgICAgICAgaWYgKGFkZHJlc3MubGVzc190aGFuX3RocmVlX3llYXJzKSB7XG4gICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5hZGRyZXNzZXMucHVzaChsb2FuQXBwbGljYXRpb25TZXJ2aWNlLmdldE5ld0FkZHJlc3MoKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgaW5kZXggPSAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5hZGRyZXNzZXMuaW5kZXhPZihhZGRyZXNzKTtcbiAgICAgICAgICAgICRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLmFkZHJlc3Nlcy5zcGxpY2UoaW5kZXggKyAxLCAxKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUudXBkYXRlQXBwbGljYXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNhdmVBcHBsaWNhdGlvbkluZm9ybWF0aW9uKCk7XG4gICAgfTtcbiAgICAkc2NvcGUub25UZXh0Q2xpY2sgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICRldmVudC50YXJnZXQuc2VsZWN0KCk7XG4gICAgfTtcbiAgICBcbiAgICAkc2NvcGUucGFyZW50T2JqID0ge307XG4gICAgJHNjb3BlLnBhcmVudE9iai5idXNpbmVzc2Nob2ljZVNlbGVjdGVkPSB0cnVlO1xuICAgICRzY29wZS5zZXRCdXNpbmVzcyA9IGZ1bmN0aW9uKHZhbCl7XG4gICAgICBjb25zb2xlLmluZm8odmFsKTtcbiAgICAgICRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnBlcnNvbmFsLmVtcGxveW1lbnRTZWN0b3IgPSB2YWw7XG4gICAgICAkc2NvcGUucGFyZW50T2JqLmJ1c2luZXNzY2hvaWNlU2VsZWN0ZWQ9IGZhbHNlO1xuICAgIH1cbiAgXG4gICAgJHNjb3BlLnBhcmVudE9iai5vY2N1cGF0aW9uY2hvaWNlU2VsZWN0ZWQ9IHRydWU7XG4gICAgJHNjb3BlLnNldE9jY3VwYXRpb24gPSBmdW5jdGlvbih2YWwpe1xuICAgICAgY29uc29sZS5pbmZvKHZhbCk7XG4gICAgICAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5wZXJzb25hbC5lbXBsb3ltZW50UG9zaXRpb24gPSB2YWw7XG4gICAgICAkc2NvcGUucGFyZW50T2JqLm9jY3VwYXRpb25jaG9pY2VTZWxlY3RlZD0gZmFsc2U7XG4gICAgfVxuXG4gICAgJHNjb3BlLnBhcmVudE9iai5lbXBsb3llcmNob2ljZVNlbGVjdGVkPSB0cnVlO1xuICAgICRzY29wZS5zZXRFbXBsb3llck5hbWUgPSBmdW5jdGlvbih2YWwpe1xuICAgICAgY29uc29sZS5pbmZvKHZhbCk7XG4gICAgICAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5wZXJzb25hbC5lbXBsb3llciA9IHZhbDtcbiAgICAgICRzY29wZS5wYXJlbnRPYmouZW1wbG95ZXJjaG9pY2VTZWxlY3RlZD0gZmFsc2U7XG4gICAgfVxuXG4gICAgJHNjb3BlLnBhcmVudE9iai5hc3NvY2lhdGlvbmNob2ljZVNlbGVjdGVkPSBmYWxzZTtcbiAgICAkc2NvcGUuc2V0QXNzb2NpYXRpb24gPSBmdW5jdGlvbih2YWwpe1xuICAgICAgY29uc29sZS5pbmZvKHZhbCk7XG4gICAgICAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5wZXJzb25hbC5hc3NvY2lhdGlvbiA9IHZhbDtcbiAgICAgICRzY29wZS5wYXJlbnRPYmouYXNzb2NpYXRpb25jaG9pY2VTZWxlY3RlZD0gZmFsc2U7XG4gICAgfVxuXG4gICAgc2VsZi5sb2FuQW10UmVtb3ZlQ29tbWEgPSAgZnVuY3Rpb24oYW10KXtcbiAgICAgICAgbGV0IGxvYW5BbW91bnQgPSBhbXQgfHwgJyc7XG4gICAgICAgICAgICBsb2FuQW1vdW50ID0gbG9hbkFtb3VudCArICcnOyAgICAgICAgICAgIFxuICAgICAgICAgICAgbG9hbkFtb3VudCA9IGxvYW5BbW91bnQuc3BsaXQoJywnKS5qb2luKCcnKTtcbiAgICAgICAgICAgIHJldHVybiBsb2FuQW1vdW50O1xuICAgIH1cblxuICAgICRzY29wZS52YWxpZGF0ZUxvYW5EZXRhaWxzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvL2NvbnNvbGUuaW5mbygkc2NvcGUuYW1vdW50Lm9wdGlvbnMuZmxvb3IsJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucmVxdWVzdC5hbW91bnQgLCRzY29wZS5hbW91bnQub3B0aW9ucy5jZWlsKVxuICAgICAgICBcbiAgICAgICAgaWYodHlwZW9mICRzY29wZS5hcHBsaWNhdGlvbi5mb3JtID09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiAkc2NvcGUuYW1vdW50Lm9wdGlvbnMgPT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mICRzY29wZS50ZXJtLm9wdGlvbnMgPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGxvYW5BbXRSZW1vdmVDb21tYSgkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5yZXF1ZXN0LmFtb3VudCkgPCBwYXJzZUludCgkc2NvcGUuYW1vdW50Lm9wdGlvbnMuZmxvb3IpIHx8IGxvYW5BbXRSZW1vdmVDb21tYSgkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5yZXF1ZXN0LmFtb3VudCkgPiBwYXJzZUludCgkc2NvcGUuYW1vdW50Lm9wdGlvbnMuY2VpbCkpIHtcbiAgICAgICAgICByZXR1cm4gXCJpbnYtYW10XCI7XG4gICAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucmVxdWVzdC50ZXJtIDwgcGFyc2VJbnQoJHNjb3BlLnRlcm0ub3B0aW9ucy5mbG9vcikgfHwgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucmVxdWVzdC50ZXJtID4gcGFyc2VJbnQoJHNjb3BlLnRlcm0ub3B0aW9ucy5jZWlsKSkge1xuICAgICAgICAgIHJldHVybiBcImludi10ZXJtXCI7XG4gICAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucmVxdWVzdC50ZXJtIDwgcGFyc2VJbnQoJHNjb3BlLnRlcm0ub3B0aW9ucy5mbG9vcikgfHwgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucmVxdWVzdC50ZXJtID4gcGFyc2VJbnQoJHNjb3BlLmFwcGxpY2F0aW9uLnRlcm0pKSB7XG4gICAgICAgICAgcmV0dXJuIFwiaW52LXRlcm1cIjtcbiAgICAgICAgfSBcbiAgICAgIH07XG5cbiAgICAgICRzY29wZS5jb25maXJtRGV0YWlscyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdwcm9jZXNzaW5nJyk7XG4gICAgICAgICAgICBsZXQgd2VidXJsID0gJGxvY2F0aW9uLmFic1VybCgpO1xuICAgICAgICAgICAgaWYod2VidXJsLnNwbGl0KCdyZWZJZD0nKSAmJiB3ZWJ1cmwuc3BsaXQoJ3JlZklkPScpWzFdICYmIHdlYnVybC5zcGxpdCgncmVmSWQ9JylbMV0uc3BsaXQoXCImXCIpKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS52ZXJpZnkubG9hbklkID0gd2VidXJsLnNwbGl0KCdyZWZJZD0nKVsxXS5zcGxpdChcIiZcIilbMF07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwiUmVmZXJlbmNlIElEIG5vdCBkZWZpbmVkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0udmVyaWZ5LnVybCA9IHdlYnVybDtcbiAgICAgICAgICAgICRzY29wZS5sb2Fuc0FwaS5jb25maXJtRGV0YWlscygkc2NvcGUuYXBwbGljYXRpb24uZm9ybS52ZXJpZnksIFxuICAgICAgICAgICAgZnVuY3Rpb24gKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgICAgIGFtb3VudDogZGF0YS5hbW91bnQsXG4gICAgICAgICAgICAgICAgICAgIHRlcm06IGRhdGEudGVybSxcbiAgICAgICAgICAgICAgICAgICAgYXByOiBkYXRhLmFwcixcbiAgICAgICAgICAgICAgICAgICAgbW9udGhsaWVzOiBkYXRhLm1vbnRobHlSZXBheW1lbnQsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiBkYXRhLnRvdGFsQW1vdW50LFxuICAgICAgICAgICAgICAgICAgICBhcHBsaWNhbnQgOiBkYXRhLmZ1bGxOYW1lXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdsb2FuRGV0YWlscycpO1xuICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlQ29uZnVzZWQgPSBlcnI7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNldEFjdGl2ZVN0ZXAoJ21pc21hdGNoRGV0YWlsJyk7XG4gICAgICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmJlbmVmaXRDVSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdwcm9jZXNzaW5nJyk7XG4gICAgICAgICAgICBsZXQgd2VidXJsID0gJGxvY2F0aW9uLmFic1VybCgpO1xuICAgICAgICAgICAgaWYod2VidXJsLnNwbGl0KCdyZWZJZD0nKSAmJiB3ZWJ1cmwuc3BsaXQoJ3JlZklkPScpWzFdICYmIHdlYnVybC5zcGxpdCgncmVmSWQ9JylbMV0uc3BsaXQoXCImXCIpKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS52ZXJpZnkubG9hbklkID0gd2VidXJsLnNwbGl0KCdyZWZJZD0nKVsxXS5zcGxpdChcIiZcIilbMF07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwiUmVmZXJlbmNlIElEIG5vdCBkZWZpbmVkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0udmVyaWZ5LnVybCA9IHdlYnVybDtcbiAgICAgICAgICAgICRzY29wZS5sb2Fuc0FwaS5jb25maXJtRGV0YWlscygkc2NvcGUuYXBwbGljYXRpb24uZm9ybS52ZXJpZnksIFxuICAgICAgICAgICAgZnVuY3Rpb24gKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgICAgIGFtb3VudDogZGF0YS5hbW91bnQsXG4gICAgICAgICAgICAgICAgICAgIHRlcm06IGRhdGEudGVybSxcbiAgICAgICAgICAgICAgICAgICAgYXByOiBkYXRhLmFwcixcbiAgICAgICAgICAgICAgICAgICAgbW9udGhsaWVzOiBkYXRhLm1vbnRobHlSZXBheW1lbnQsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiBkYXRhLnRvdGFsQW1vdW50LFxuICAgICAgICAgICAgICAgICAgICBhcHBsaWNhbnQgOiBkYXRhLmZ1bGxOYW1lXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdiZW5lZml0Q3JlZGl0VW5pb24nKTtcbiAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZUNvbmZ1c2VkID0gZXJyO1xuICAgICAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdtaXNtYXRjaERldGFpbCcpO1xuICAgICAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5zYXZlRGV0YWlscyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGxldCBjdUlkID0gYW5ndWxhci5lbGVtZW50KCdbZGF0YS1jdWlkXScpLmRhdGEoJ2N1aWQnKTtcbiAgICAgICAgbGV0IHZhbGlkYXRpb24gPSBsb2FuQXBwbGljYXRpb25TZXJ2aWNlLnZhbGlkYXRvci52YWxpZGF0ZUJhbmtEZXRhaWxzKCk7XG4gICAgICAgIGlmICh2YWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdwcm9jZXNzaW5nJyk7XG4gICAgICAgICAgICBpZihjdUlkID09ICdCUy0wMDAxJykgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0udmVyaWZ5LmN1RWxpZ2liaWxpdHkgID0gXCJ0cnVlXCI7XG4gICAgICAgICAgICAkc2NvcGUubG9hbnNBcGkuc2F2ZURldGFpbHMoJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0udmVyaWZ5LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb25cbiAgICAgICAgICAgICAgICAgLnNldElkKCRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnZlcmlmeS5sb2FuSWQpO1xuICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uYW1vdW50ID0gJHNjb3BlLnJlc3VsdC5hbW91bnQ7IFxuICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24udGVybSA9ICRzY29wZS5yZXN1bHQudGVybTsgXG4gICAgICAgICAgICAgICAgICRzY29wZS5hY2NlcHRBcHBsaWNhdGlvbigpO1xuICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlQ29uZnVzZWQgPSBlcnIuZGVzY3JpcHRpb247XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNldEFjdGl2ZVN0ZXAoJ21pc21hdGNoQmFua0RldGFpbCcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgIH07XG4gICAgXG5cbiAgICAkc2NvcGUuc2hvd0RlYnVnSW5mb3JtYXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBpbmZvcm1hdGlvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhcHBsaWNhdGlvbkZvcm1EYXRhJykgfHwgbnVsbDtcbiAgICAgICAgVUlraXQubW9kYWwuYWxlcnQoYFxuICAgICAgICAgICAgPHRleHRhcmVhIHN0eWxlPVwid2lkdGg6IDEwMCU7IGhlaWdodDogNTBweDsgYmFja2dyb3VuZDogYmxhY2s7IGNvbG9yOiB3aGl0ZTtcIj4keyBpbmZvcm1hdGlvbiB9PC90ZXh0YXJlYT5cbiAgICAgICAgICAgIDxwPlBsZWFzZSBjb3B5L3Bhc3RlIGFsbCB0aGUgdGV4dCBmcm9tIGFib3ZlLjwvcD5cbiAgICAgICAgYCk7XG4gICAgfVxuXG4gICAgJHNjb3BlLmdldE15UXVvdGUgPSBmdW5jdGlvbih1cmwpe1xuICAgICAgICBzYXZlU2xpZGVySW5mb3JtYXRpb24oKTtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB1cmw7XG4gICAgfVxuXG4gICAgJHNjb3BlLm5vRW1wbG95ZXIgPSBmdW5jdGlvbigpe1xuICAgICAgICBVSWtpdC5tb2RhbC5jb25maXJtKGBcbiAgICAgICAgICAgIDxwPlNvcnJ5IGJ1dCB3ZSBjYW4gb25seSBsZW5kIHRvIHBlb3BsZSBpbiBmdWxsdGltZSBlbXBsb3ltZW50LjwvcD5gLCB7XG4gICAgICAgICAgICBsYWJlbHM6IHtcbiAgICAgICAgICAgICAgICBjYW5jZWw6ICcnLFxuICAgICAgICAgICAgICAgIG9rOiBcIk9rXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGhpc3RvcnkuYmFjaygpO1xuICAgICAgICAgIHNjb3BlLiRhcHBseSgpXG4gICAgICAgIH0pO1xuICAgIH1cbn1dKS5maWx0ZXIoJ2hpZ2hsaWdodCcsWyckc2NlJywgZnVuY3Rpb24gKCRzY2UpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGlucHV0LCBxdWVyeSkge1xuICAgICAgaWYgKHF1ZXJ5ID09PSAnJyB8fCBxdWVyeSA9PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICB9IGVsc2UgaWYgKHF1ZXJ5Lmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgIH1cbiAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKGlucHV0LnRvVXBwZXJDYXNlKCkucmVwbGFjZShSZWdFeHAoJygnKyBxdWVyeS50b1VwcGVyQ2FzZSgpICsgJyknLCAnZycpLCAnPGIgY2xhc3M9XCJoaWdoX2xpZ2h0XCI+JDE8L2I+JykpO1xuICAgIH1cbiAgfV0pXG4uZmlsdGVyKCdoaWdobGlnaHQyJyxbJyRzY2UnLCBmdW5jdGlvbiAoJHNjZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoaW5wdXQsIHF1ZXJ5KSB7XG4gICAgICBpZiAocXVlcnkgPT09ICcnIHx8IHF1ZXJ5ID09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbChpbnB1dCk7XG4gICAgICB9IGVsc2UgaWYgKHF1ZXJ5Lmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbChpbnB1dCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbChpbnB1dC50b1VwcGVyQ2FzZSgpLnJlcGxhY2UoUmVnRXhwKCcoJysgcXVlcnkudG9VcHBlckNhc2UoKSArICcpJywgJ2cnKSwgJzxiIGNsYXNzPVwiaGlnaF9saWdodFwiPiQxPC9iPicpKTtcbiAgICB9XG4gIH1dKVxuXG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0aGVtZS1hc3NldHMvanMvX2FwcGxpY2F0aW9ucy9fbG9hbi1jb250cm9sbGVyLmpzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");
},function(module,exports){eval("myCommunityBank.factory('cuLoansApiFactory', ['baseApiFactory', '$http', '$sce', function(baseApiFactory, $http, $sce){\n\n    var self = this;\n    var apiKey = baseApiFactory.apiKey;\n\n    var ihub = baseApiFactory.ihub;\n    var culoans = baseApiFactory.culoans;\n\n    self.aggrUrl = baseApiFactory.aggrUrl;\n    self.aggrCode = baseApiFactory.aggrCode;\n    self.brandid = baseApiFactory.brandid;\n\n    self.enableSandbox = baseApiFactory.enableSandbox;\n    self.disableSandbox = baseApiFactory.disableSandbox;\n\n    self.getSafeEsignUrl = baseApiFactory.getSafeEsignUrl;\n    self.getApiRequestUrl = baseApiFactory.getApiRequestUrl;\n    self.getApiRequestHeaders = baseApiFactory.getApiRequestHeaders;\n\n    self.lookupPostcode = baseApiFactory.lookupPostcode;\n    self.formatPostCodeResponse = baseApiFactory.formatPostCodeResponse;\n\n    self.syncMeta = baseApiFactory.syncMeta;\n    self.getSalutations = baseApiFactory.getSalutations;\n    self.getNationalities = baseApiFactory.getNationalities;\n    self.getSecurityQuestions = baseApiFactory.getSecurityQuestions;\n\n    self.products = null;\n\n    self.getProducts = function () {\n        return self.products;\n    };\n\n    self.fetchProducts = function (success, fail) {\n        return baseApiFactory.getApi('loanproducts', {\n            aggrCode: self.aggrCode\n        }, function (data) {\n            self.products = data.loanProducts;\n            if (success) {\n                return success(self.products);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.employerList = null;\n\n    self.getemployerList = function () {\n        return self.employerList;\n    };\n    \n    self.occupationList = null;\n\n    self.getoccupationList = function () {\n        return self.occupationList;\n    };\n\n    self.businessList = null;\n\n    self.getbusinessList = function () {\n        return self.businessList;\n    };\n\n    self.associationList = null;\n\n    self.getassociationList = function () {\n        return self.associationList;\n    };\n    \n    self.fetchEmployerList = function (success, fail) {\n        return baseApiFactory.getApi('employers', {}, function (data) {\n        \n            self.employerList = data;\n            if (success) {\n                return success(self.employerList);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.fetchEmployerList();\n    \n    self.fetchOccupationList = function (success, fail) {\n        return baseApiFactory.getApiFiles('employers/occupation', {}, function (data) {\n            self.occupationList = data.occupation;\n            if (success) {\n                return success(self.occupationList);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.fetchOccupationList();\n\n    self.fetchBusinessList = function (success, fail) {\n        return baseApiFactory.getApiFiles('employers/business', {}, function (data) {\n        \n            self.businessList = data;\n            if (success) {\n                return success(self.businessList);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.fetchBusinessList();\n\n    self.fetchAssociationList = function (success, fail) {\n        return baseApiFactory.getApi('association', {}, function (data) {\n        \n            self.associationList = data.Association;\n            if (success) {\n                return success(self.associationList );\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.fetchAssociationList();\n\n\n    self.charityList = null;\n\n    self.getcharityList = function () {\n        return self.charityList;\n    };\n\n\n     self.fetchCharityList = function (success, fail) {\n        return baseApiFactory.getApiFiles('association/commonbond', {}, function (data) {\n        \n            self.charityList = data;\n            if (success) {\n                return success(self.charityList);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.fetchCharityList();\n\n    self.startApplication = function (product, success, fail) {\n        return baseApiFactory.postApi('loanapplications', {\n            aggregator: self.aggrCode,\n            aggr_url: self.aggrUrl,\n             brandid: self.brandid,\n            loanProductID: product.loanProductId,\n            state: 'IN_PROGRESS'\n        }, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n\n    };\n\n    self.syncApplication = function(appData, success, fail) {\n\n        appData.aggrUrl = self.aggrUrl;\n        appData.aggrCode = self.aggrCode;\n        appData.aggregator = self.aggrCode;\n        appData.brandid = self.brandid;\n\n        return baseApiFactory.putApi('loanapplications', appData, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.submitApplication = function(app, success, fail) {\n\n        var appData = app.prepareForApi();\n        appData.state = 'SUBMITTED';\n        appData.aggrUrl = self.aggrUrl;\n        appData.aggrCode = self.aggrCode;\n        appData.aggregator = self.aggrCode;\n        appData.brandid = self.brandid;\n\n        return baseApiFactory.putApi('loanapplications', appData, function (data) {\n\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.acceptApplication = function(app, success, fail) {\n\n        var appData = {\n            loanApplicationId: app.getId(),\n            state: 'ACCEPTED' ,\n            amount: app.amount,\n            term : app.term\n        };\n\n        return baseApiFactory.putApi('loanapplications', appData, function (data) {\n\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.confirmDetails = function(obj, success, fail) {\n\n        \n        return baseApiFactory.postApiFiles('loanapplications/confirmdetails', obj, function (data) {\n\n            if (success) {\n                \n                //alert(\"Your mail id send successfully\");\n                return success(data);\n                \n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n    self.confirmDetailsUpload = function(obj, success, fail) {\n         return baseApiFactory.postApiFiles('loanapplications/confirmuploaddetails', obj, function (data) {\n              if (success) {\n                        return success(data);       \n                    }\n                }, function (err) {\n                    if (fail) {\n                        return fail(err);\n                    }\n                });\n            };\n\n    self.saveDetails = function(obj, success, fail) {\n\n        \n        return baseApiFactory.postApiFiles('loanapplications/savedetails', obj, function (data) {\n\n            if (success) {\n                \n                return success(data);\n                \n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n\n    self.referApplication = function(obj, success, fail) {\n\n        \n        return baseApiFactory.postApiFiles('loanapplications/applyreferred', obj, function (data) {\n\n            if (success) {\n                \n                //alert(\"Your mail id send successfully\");\n                return success(data);\n                \n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.generateAgreement = function (app, success, fail) {\n\n        var appData = {\n            loanApplicationId: app.getId(),\n            state: 'GEN_AGREEMENT'\n        };\n\n        return baseApiFactory.putApi('loanapplications', appData, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    return self;\n}]);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy90aGVtZS1hc3NldHMvanMvX2FwcGxpY2F0aW9ucy9fbG9hbi1mYWN0b3J5LmpzPzAzZGIiXSwic291cmNlc0NvbnRlbnQiOlsibXlDb21tdW5pdHlCYW5rLmZhY3RvcnkoJ2N1TG9hbnNBcGlGYWN0b3J5JywgWydiYXNlQXBpRmFjdG9yeScsICckaHR0cCcsICckc2NlJywgZnVuY3Rpb24oYmFzZUFwaUZhY3RvcnksICRodHRwLCAkc2NlKXtcblxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIGNvbnN0IGFwaUtleSA9IGJhc2VBcGlGYWN0b3J5LmFwaUtleTtcblxuICAgIGNvbnN0IGlodWIgPSBiYXNlQXBpRmFjdG9yeS5paHViO1xuICAgIGNvbnN0IGN1bG9hbnMgPSBiYXNlQXBpRmFjdG9yeS5jdWxvYW5zO1xuXG4gICAgc2VsZi5hZ2dyVXJsID0gYmFzZUFwaUZhY3RvcnkuYWdnclVybDtcbiAgICBzZWxmLmFnZ3JDb2RlID0gYmFzZUFwaUZhY3RvcnkuYWdnckNvZGU7XG4gICAgc2VsZi5icmFuZGlkID0gYmFzZUFwaUZhY3RvcnkuYnJhbmRpZDtcblxuICAgIHNlbGYuZW5hYmxlU2FuZGJveCA9IGJhc2VBcGlGYWN0b3J5LmVuYWJsZVNhbmRib3g7XG4gICAgc2VsZi5kaXNhYmxlU2FuZGJveCA9IGJhc2VBcGlGYWN0b3J5LmRpc2FibGVTYW5kYm94O1xuXG4gICAgc2VsZi5nZXRTYWZlRXNpZ25VcmwgPSBiYXNlQXBpRmFjdG9yeS5nZXRTYWZlRXNpZ25Vcmw7XG4gICAgc2VsZi5nZXRBcGlSZXF1ZXN0VXJsID0gYmFzZUFwaUZhY3RvcnkuZ2V0QXBpUmVxdWVzdFVybDtcbiAgICBzZWxmLmdldEFwaVJlcXVlc3RIZWFkZXJzID0gYmFzZUFwaUZhY3RvcnkuZ2V0QXBpUmVxdWVzdEhlYWRlcnM7XG5cbiAgICBzZWxmLmxvb2t1cFBvc3Rjb2RlID0gYmFzZUFwaUZhY3RvcnkubG9va3VwUG9zdGNvZGU7XG4gICAgc2VsZi5mb3JtYXRQb3N0Q29kZVJlc3BvbnNlID0gYmFzZUFwaUZhY3RvcnkuZm9ybWF0UG9zdENvZGVSZXNwb25zZTtcblxuICAgIHNlbGYuc3luY01ldGEgPSBiYXNlQXBpRmFjdG9yeS5zeW5jTWV0YTtcbiAgICBzZWxmLmdldFNhbHV0YXRpb25zID0gYmFzZUFwaUZhY3RvcnkuZ2V0U2FsdXRhdGlvbnM7XG4gICAgc2VsZi5nZXROYXRpb25hbGl0aWVzID0gYmFzZUFwaUZhY3RvcnkuZ2V0TmF0aW9uYWxpdGllcztcbiAgICBzZWxmLmdldFNlY3VyaXR5UXVlc3Rpb25zID0gYmFzZUFwaUZhY3RvcnkuZ2V0U2VjdXJpdHlRdWVzdGlvbnM7XG5cbiAgICBzZWxmLnByb2R1Y3RzID0gbnVsbDtcblxuICAgIHNlbGYuZ2V0UHJvZHVjdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLnByb2R1Y3RzO1xuICAgIH07XG5cbiAgICBzZWxmLmZldGNoUHJvZHVjdHMgPSBmdW5jdGlvbiAoc3VjY2VzcywgZmFpbCkge1xuICAgICAgICByZXR1cm4gYmFzZUFwaUZhY3RvcnkuZ2V0QXBpKCdsb2FucHJvZHVjdHMnLCB7XG4gICAgICAgICAgICBhZ2dyQ29kZTogc2VsZi5hZ2dyQ29kZVxuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgc2VsZi5wcm9kdWN0cyA9IGRhdGEubG9hblByb2R1Y3RzO1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhzZWxmLnByb2R1Y3RzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgc2VsZi5lbXBsb3llckxpc3QgPSBudWxsO1xuXG4gICAgc2VsZi5nZXRlbXBsb3llckxpc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmVtcGxveWVyTGlzdDtcbiAgICB9O1xuICAgIFxuICAgIHNlbGYub2NjdXBhdGlvbkxpc3QgPSBudWxsO1xuXG4gICAgc2VsZi5nZXRvY2N1cGF0aW9uTGlzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYub2NjdXBhdGlvbkxpc3Q7XG4gICAgfTtcblxuICAgIHNlbGYuYnVzaW5lc3NMaXN0ID0gbnVsbDtcblxuICAgIHNlbGYuZ2V0YnVzaW5lc3NMaXN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2VsZi5idXNpbmVzc0xpc3Q7XG4gICAgfTtcblxuICAgIHNlbGYuYXNzb2NpYXRpb25MaXN0ID0gbnVsbDtcblxuICAgIHNlbGYuZ2V0YXNzb2NpYXRpb25MaXN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2VsZi5hc3NvY2lhdGlvbkxpc3Q7XG4gICAgfTtcbiAgICBcbiAgICBzZWxmLmZldGNoRW1wbG95ZXJMaXN0ID0gZnVuY3Rpb24gKHN1Y2Nlc3MsIGZhaWwpIHtcbiAgICAgICAgcmV0dXJuIGJhc2VBcGlGYWN0b3J5LmdldEFwaSgnZW1wbG95ZXJzJywge30sIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIFxuICAgICAgICAgICAgc2VsZi5lbXBsb3llckxpc3QgPSBkYXRhO1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhzZWxmLmVtcGxveWVyTGlzdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHNlbGYuZmV0Y2hFbXBsb3llckxpc3QoKTtcbiAgICBcbiAgICBzZWxmLmZldGNoT2NjdXBhdGlvbkxpc3QgPSBmdW5jdGlvbiAoc3VjY2VzcywgZmFpbCkge1xuICAgICAgICByZXR1cm4gYmFzZUFwaUZhY3RvcnkuZ2V0QXBpRmlsZXMoJ2VtcGxveWVycy9vY2N1cGF0aW9uJywge30sIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBzZWxmLm9jY3VwYXRpb25MaXN0ID0gZGF0YS5vY2N1cGF0aW9uO1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhzZWxmLm9jY3VwYXRpb25MaXN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgc2VsZi5mZXRjaE9jY3VwYXRpb25MaXN0KCk7XG5cbiAgICBzZWxmLmZldGNoQnVzaW5lc3NMaXN0ID0gZnVuY3Rpb24gKHN1Y2Nlc3MsIGZhaWwpIHtcbiAgICAgICAgcmV0dXJuIGJhc2VBcGlGYWN0b3J5LmdldEFwaUZpbGVzKCdlbXBsb3llcnMvYnVzaW5lc3MnLCB7fSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgXG4gICAgICAgICAgICBzZWxmLmJ1c2luZXNzTGlzdCA9IGRhdGE7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzKHNlbGYuYnVzaW5lc3NMaXN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgc2VsZi5mZXRjaEJ1c2luZXNzTGlzdCgpO1xuXG4gICAgc2VsZi5mZXRjaEFzc29jaWF0aW9uTGlzdCA9IGZ1bmN0aW9uIChzdWNjZXNzLCBmYWlsKSB7XG4gICAgICAgIHJldHVybiBiYXNlQXBpRmFjdG9yeS5nZXRBcGkoJ2Fzc29jaWF0aW9uJywge30sIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIFxuICAgICAgICAgICAgc2VsZi5hc3NvY2lhdGlvbkxpc3QgPSBkYXRhLkFzc29jaWF0aW9uO1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhzZWxmLmFzc29jaWF0aW9uTGlzdCApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBpZiAoZmFpbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBzZWxmLmZldGNoQXNzb2NpYXRpb25MaXN0KCk7XG5cblxuICAgIHNlbGYuY2hhcml0eUxpc3QgPSBudWxsO1xuXG4gICAgc2VsZi5nZXRjaGFyaXR5TGlzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuY2hhcml0eUxpc3Q7XG4gICAgfTtcblxuXG4gICAgIHNlbGYuZmV0Y2hDaGFyaXR5TGlzdCA9IGZ1bmN0aW9uIChzdWNjZXNzLCBmYWlsKSB7XG4gICAgICAgIHJldHVybiBiYXNlQXBpRmFjdG9yeS5nZXRBcGlGaWxlcygnYXNzb2NpYXRpb24vY29tbW9uYm9uZCcsIHt9LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBcbiAgICAgICAgICAgIHNlbGYuY2hhcml0eUxpc3QgPSBkYXRhO1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhzZWxmLmNoYXJpdHlMaXN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgc2VsZi5mZXRjaENoYXJpdHlMaXN0KCk7XG5cbiAgICBzZWxmLnN0YXJ0QXBwbGljYXRpb24gPSBmdW5jdGlvbiAocHJvZHVjdCwgc3VjY2VzcywgZmFpbCkge1xuICAgICAgICByZXR1cm4gYmFzZUFwaUZhY3RvcnkucG9zdEFwaSgnbG9hbmFwcGxpY2F0aW9ucycsIHtcbiAgICAgICAgICAgIGFnZ3JlZ2F0b3I6IHNlbGYuYWdnckNvZGUsXG4gICAgICAgICAgICBhZ2dyX3VybDogc2VsZi5hZ2dyVXJsLFxuICAgICAgICAgICAgIGJyYW5kaWQ6IHNlbGYuYnJhbmRpZCxcbiAgICAgICAgICAgIGxvYW5Qcm9kdWN0SUQ6IHByb2R1Y3QubG9hblByb2R1Y3RJZCxcbiAgICAgICAgICAgIHN0YXRlOiAnSU5fUFJPR1JFU1MnXG4gICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBpZiAoZmFpbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgfTtcblxuICAgIHNlbGYuc3luY0FwcGxpY2F0aW9uID0gZnVuY3Rpb24oYXBwRGF0YSwgc3VjY2VzcywgZmFpbCkge1xuXG4gICAgICAgIGFwcERhdGEuYWdnclVybCA9IHNlbGYuYWdnclVybDtcbiAgICAgICAgYXBwRGF0YS5hZ2dyQ29kZSA9IHNlbGYuYWdnckNvZGU7XG4gICAgICAgIGFwcERhdGEuYWdncmVnYXRvciA9IHNlbGYuYWdnckNvZGU7XG4gICAgICAgIGFwcERhdGEuYnJhbmRpZCA9IHNlbGYuYnJhbmRpZDtcblxuICAgICAgICByZXR1cm4gYmFzZUFwaUZhY3RvcnkucHV0QXBpKCdsb2FuYXBwbGljYXRpb25zJywgYXBwRGF0YSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHNlbGYuc3VibWl0QXBwbGljYXRpb24gPSBmdW5jdGlvbihhcHAsIHN1Y2Nlc3MsIGZhaWwpIHtcblxuICAgICAgICBsZXQgYXBwRGF0YSA9IGFwcC5wcmVwYXJlRm9yQXBpKCk7XG4gICAgICAgIGFwcERhdGEuc3RhdGUgPSAnU1VCTUlUVEVEJztcbiAgICAgICAgYXBwRGF0YS5hZ2dyVXJsID0gc2VsZi5hZ2dyVXJsO1xuICAgICAgICBhcHBEYXRhLmFnZ3JDb2RlID0gc2VsZi5hZ2dyQ29kZTtcbiAgICAgICAgYXBwRGF0YS5hZ2dyZWdhdG9yID0gc2VsZi5hZ2dyQ29kZTtcbiAgICAgICAgYXBwRGF0YS5icmFuZGlkID0gc2VsZi5icmFuZGlkO1xuXG4gICAgICAgIHJldHVybiBiYXNlQXBpRmFjdG9yeS5wdXRBcGkoJ2xvYW5hcHBsaWNhdGlvbnMnLCBhcHBEYXRhLCBmdW5jdGlvbiAoZGF0YSkge1xuXG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBpZiAoZmFpbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBzZWxmLmFjY2VwdEFwcGxpY2F0aW9uID0gZnVuY3Rpb24oYXBwLCBzdWNjZXNzLCBmYWlsKSB7XG5cbiAgICAgICAgbGV0IGFwcERhdGEgPSB7XG4gICAgICAgICAgICBsb2FuQXBwbGljYXRpb25JZDogYXBwLmdldElkKCksXG4gICAgICAgICAgICBzdGF0ZTogJ0FDQ0VQVEVEJyAsXG4gICAgICAgICAgICBhbW91bnQ6IGFwcC5hbW91bnQsXG4gICAgICAgICAgICB0ZXJtIDogYXBwLnRlcm1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gYmFzZUFwaUZhY3RvcnkucHV0QXBpKCdsb2FuYXBwbGljYXRpb25zJywgYXBwRGF0YSwgZnVuY3Rpb24gKGRhdGEpIHtcblxuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgc2VsZi5jb25maXJtRGV0YWlscyA9IGZ1bmN0aW9uKG9iaiwgc3VjY2VzcywgZmFpbCkge1xuXG4gICAgICAgIFxuICAgICAgICByZXR1cm4gYmFzZUFwaUZhY3RvcnkucG9zdEFwaUZpbGVzKCdsb2FuYXBwbGljYXRpb25zL2NvbmZpcm1kZXRhaWxzJywgb2JqLCBmdW5jdGlvbiAoZGF0YSkge1xuXG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vYWxlcnQoXCJZb3VyIG1haWwgaWQgc2VuZCBzdWNjZXNzZnVsbHlcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBzZWxmLmNvbmZpcm1EZXRhaWxzVXBsb2FkID0gZnVuY3Rpb24ob2JqLCBzdWNjZXNzLCBmYWlsKSB7XG4gICAgICAgICByZXR1cm4gYmFzZUFwaUZhY3RvcnkucG9zdEFwaUZpbGVzKCdsb2FuYXBwbGljYXRpb25zL2NvbmZpcm11cGxvYWRkZXRhaWxzJywgb2JqLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MoZGF0YSk7ICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgIHNlbGYuc2F2ZURldGFpbHMgPSBmdW5jdGlvbihvYmosIHN1Y2Nlc3MsIGZhaWwpIHtcblxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGJhc2VBcGlGYWN0b3J5LnBvc3RBcGlGaWxlcygnbG9hbmFwcGxpY2F0aW9ucy9zYXZlZGV0YWlscycsIG9iaiwgZnVuY3Rpb24gKGRhdGEpIHtcblxuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhkYXRhKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG5cbiAgICBzZWxmLnJlZmVyQXBwbGljYXRpb24gPSBmdW5jdGlvbihvYmosIHN1Y2Nlc3MsIGZhaWwpIHtcblxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGJhc2VBcGlGYWN0b3J5LnBvc3RBcGlGaWxlcygnbG9hbmFwcGxpY2F0aW9ucy9hcHBseXJlZmVycmVkJywgb2JqLCBmdW5jdGlvbiAoZGF0YSkge1xuXG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vYWxlcnQoXCJZb3VyIG1haWwgaWQgc2VuZCBzdWNjZXNzZnVsbHlcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHNlbGYuZ2VuZXJhdGVBZ3JlZW1lbnQgPSBmdW5jdGlvbiAoYXBwLCBzdWNjZXNzLCBmYWlsKSB7XG5cbiAgICAgICAgbGV0IGFwcERhdGEgPSB7XG4gICAgICAgICAgICBsb2FuQXBwbGljYXRpb25JZDogYXBwLmdldElkKCksXG4gICAgICAgICAgICBzdGF0ZTogJ0dFTl9BR1JFRU1FTlQnXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGJhc2VBcGlGYWN0b3J5LnB1dEFwaSgnbG9hbmFwcGxpY2F0aW9ucycsIGFwcERhdGEsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBpZiAoZmFpbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4gc2VsZjtcbn1dKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0aGVtZS1hc3NldHMvanMvX2FwcGxpY2F0aW9ucy9fbG9hbi1mYWN0b3J5LmpzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=")},function(module,exports){eval('myCommunityBank.service(\'loanApplicationService\', [\'baseApplicationService\', function (baseApplicationService) {\n\n    var self = this;\n    var $scope = {};\n\n    self.attachScope = function(_scope) {\n        _scope.meta = self.meta;\n        _scope.form = self.form;\n        $scope = _scope;\n        return this;\n    };\n\n    self.getDOB = baseApplicationService.getDOB;\n    self.getCuId = baseApplicationService.getCuId;\n    self.setCuId = baseApplicationService.setCuId;\n    self.getState = baseApplicationService.getState;\n    self.getNewAddress = baseApplicationService.getNewAddress;\n    self.getAnnualIncome = baseApplicationService.getAnnualIncome;\n    self.getPassportExpiry = baseApplicationService.getPassportExpiry;\n\n    self.setId = function (id) {\n        self.form.request._loanApplicationId = id;\n        return this;\n    };\n\n    self.getId = function () {\n        if (self.form.request._loanApplicationId) {\n            return self.form.request._loanApplicationId;\n        } else {\n            return null;\n        }\n    };\n\n    \n\n    baseApplicationService.getId = self.getId;\n    baseApplicationService.setId = self.setId;\n\n    self.getAmount = function () {\n        return $scope.form.request.amount;\n    };\n\n    self.getTerm = function () {\n        return $scope.form.request.term;\n    };\n\n    self.getCreditHistory = function () {\n        return $scope.form.request.creditHistory;\n    };\n\n    self.getLoanUse = function () {\n        return $scope.form.request.loanUse;\n    };\n\n    self.getLoanUseIfOthers = function () {\n        return $scope.form.request.loanUseIfOthers;\n    };\n\n    self.getAPR = function () {\n        if ($scope.suggestedProduct) {\n            return parseFloat($scope.suggestedProduct.excellentApr);\n        } else {\n            return \'-\';\n        }\n    };\n\n    self.getRate = function () {\n        if ($scope.suggestedProduct) {\n            return $scope.suggestedProduct.excellentRate;\n        } else {\n            return \'-\';\n        }\n    };\n\n    self.getProductId = function () {\n        if ($scope.suggestedProduct) {\n            return $scope.suggestedProduct.loanProductId;\n        } else {\n            return null;\n        }\n    };\n\n    \n\n    self.getProductName = function () {\n        if ($scope.suggestedProduct) {\n            return $scope.suggestedProduct.productName;\n        } else {\n            return \'-\';\n        }\n    };\n\n\n    self.prepareTosData = baseApplicationService.prepareTosData;\n    self.prepareAddresses = baseApplicationService.prepareAddresses;\n    self.prepareBankDetails = baseApplicationService.prepareBankDetails;\n    self.prepareSecurityData = baseApplicationService.prepareSecurityData;\n    self.preparePersonalData = baseApplicationService.preparePersonalData;\n    self.prepareOddMandatoryFields = baseApplicationService.prepareOddMandatoryFields;\n\n    self.prepareForApi = function () {\n        var data = {\n            cuId: self.getCuId(),\n            term: self.getTerm(),\n            state: self.getState(),\n            loanAmount: self.getAmount(),\n            excellentRate: self.getRate(),\n            existingLoanApr: self.getAPR(),\n            loanApplicationId: self.getId(),\n            LoanApplicationID: self.getId(),\n            loanPurpose: self.getProductName(),\n            loanProductID: self.getProductId(),\n            loanUse : self.getLoanUse(),\n            loanUseIfOthers : self.getLoanUseIfOthers(),\n            creditHistory : self.getCreditHistory(),\n        };\n        angular.extend(\n            data,\n            self.prepareTosData(),\n            self.prepareAddresses(),\n            self.prepareBankDetails(),\n            self.preparePersonalData(),\n            self.prepareSecurityData()\n        );\n        // strip empty values as api cant handle\n        _.each(data, function removeEmpty(value, key) {\n            if (!value && value !== 0) {\n                delete data[key];\n            }\n        });\n\n        angular.extend(data, self.prepareOddMandatoryFields());\n\n        saveBackup();\n        return data;\n    };\n\n    self.calculateMonthlyPayment = function (amount, term, interest) {\n        // This formula was provided from the client, so no idea how it works.\n        if (isNaN(interest)) {\n            return \'\';\n        }\n\n        interest = interest * .01;\n        var monthlyRate = Math.pow((interest * 100.0 / 1200.0 + 1.0), term) * (interest * 100.0 / 1200.0) / (Math.pow((interest * 100.0 / 1200.0 + 1.0), term) - 1) * amount;\n        var monthlyRateRounded = (Math.round(monthlyRate * 100) / 100);\n        return monthlyRateRounded;\n    }\n\n    self.calculatePayableInterest = function (amount, term, interest) {\n        return self.calculateTotalRepayment() - amount;\n    };\n\n    self.calculateTotalRepayment = function (amount, term, interest) {\n        if (isNaN(interest)) {\n            return \'\';\n        }\n\n        var monthlyPayment = self.calculateMonthlyPayment(amount, term, interest);\n        var totalPayment = monthlyPayment * term;\n\n        return totalPayment;\n    };\n\n    self.monthlyRepayments = function (product) {\n        if (!product) {\n            return \'\';\n        }\n\n        return self.calculateMonthlyPayment(self.getAmount(), self.getTerm(), self.getRate());\n    };\n\n    self.totalRepayment = function (product) {\n        if (!product) {\n            return \'\';\n        }\n\n        return self.calculateTotalRepayment(self.getAmount(), self.getTerm(), self.getRate());\n    };\n    \n    self.cachedYears = null;\n    self.meta = baseApplicationService.meta;\n\n    self.form = baseApplicationService.form;\n\n    self.validator = {\n        errors: [],\n        success: false,\n        validateBankDetails: function validateBankDetails() {\n            self.validator.success = false;\n            self.validator.errors = [];\n            var data = baseApplicationService.form.verify;\n\n            if(!data.sortCode){\n                self.validator.errors.push("Please make sure you\'ve entered your Sort Code.");\n            }\n            if(!data.accountNumber){\n                self.validator.errors.push("Please make sure you\'ve entered your Account Number.");\n            }\n            if(!data.cuEligibility && angular.element(\'[data-cuid]\').data(\'cuid\') != \'BS-0001\'){\n                self.validator.errors.push("Please confirm your Eligibility for membership to the Credit Union.");\n            }\n            if (self.validator.errors.length == 0) {\n               \n                self.validator.success = true;\n            }\n            return self.validator;\n        },\n        go: function go() {\n\n            self.validator.success = false;\n            self.validator.errors = [];\n\n            var data = self.prepareForApi();\n            // Annual Income\n            if (isNaN(data.income)) {\n                self.validator.errors.push("Please make sure you\'ve entered your annual income.");\n            } else {\n                var num = parseFloat(data.income);\n                if(num < 18000 && data.cuId != \'C-0002\'){\n                    self.validator.errors.push("Sorry but we can only lend to people with annual income above 18000.");\n                }\n                else if (num < 1) {\n                    self.validator.errors.push("Please make sure you\'ve entered your annual income accurately.");\n                }\n            }\n\n           \n\n            // Bank account type\n            if (!data.bankAccountType) {\n                self.validator.errors.push("Please make sure you\'ve picked your bank account type. (a)");\n            } else {\n                if (data.bankAccountType !== \'CURRENT\' && data.bankAccountType !== \'SAVINGS\') {\n                    self.validator.errors.push("Please make sure you\'ve picked a valid bank account type (b)");\n                }\n            }\n\n            // Bank account usage\n            if (!data.bankAccountUsage) {\n                self.validator.errors.push("Please make sure you\'ve picked your bank account type. (c)");\n            } else {\n                if (data.bankAccountUsage !== \'PERSONAL\' && data.bankAccountUsage !== \'BUSINESS\') {\n                    self.validator.errors.push("Please make sure you\'ve picked a valid bank account type. (d)");\n                }\n            }\n\n            // Address details\n            if(!data.address) {\n                self.validator.errors.push("Please make sure you\'ve entered your address.");\n            }\n\n            /*if (!data.buildingNumber) {\n                self.validator.errors.push("Please make sure you\'ve entered a building name or number.");\n            }*/\n\n            if (!data.city) {\n                self.validator.errors.push("Please make sure you\'ve entered a town or city.");\n            }\n\n            if (!data.street) {\n                self.validator.errors.push("Please make sure you\'ve entered a street or road.");\n            }\n\n            // Postcode details\n            if (!data.postcode) {\n                self.validator.errors.push("Please make sure you\'ve entered a postcode.");\n            } else if (data.postcode.length > 8 || data.postcode.length < 5) {\n                self.validator.errors.push("Please make sure you\'ve entered your postcode correctly.");\n            }\n\n            // Loan Purpose\n            if (!data.loanUse) {\n                 self.validator.errors.push("Please make sure you\'ve entered your purpose of loan.");\n            }\n            if (data.loanUse == \'Other\' && !data.loanUseIfOthers) {\n                 self.validator.errors.push("Please make sure you\'ve entered the specific loan purpose.");\n            }\n\n            // Personal details\n            if (!data.title) {\n                self.validator.errors.push("Please make sure you\'ve entered your title.");\n            }\n\n            if (!data.firstName) {\n                self.validator.errors.push("Please make sure you\'ve entered your first name.");\n            }\n\n            if (!data.lastName) {\n                self.validator.errors.push("Please make sure you\'ve entered your last name.");\n            }\n\n            if (!data.birthDate) {\n                self.validator.errors.push("Please make sure you\'ve entered your date of birth.");\n            } else{\n                var today = new Date();\n                var month = parseInt(self.form.personal.dob.month.number -1);\n                var day = parseInt(self.form.personal.dob.day);\n                var year = parseInt(self.form.personal.dob.year);\n            var result = newDate(year+18,month,day)<=today;\n                if(!result){\n                    self.validator.errors.push("You are not completed 18 year.");\n                }\n            }\n            \n            \n\n            \n            // Email address\n            if (!data.eMail) {\n                self.validator.errors.push("Please make sure you\'ve entered your email address.");\n            } else {\n                var re = /^(([^<>()\\[\\]\\.,;:\\s@\\"]+(\\.[^<>()\\[\\]\\.,;:\\s@\\"]+)*)|(\\".+\\"))@(([^<>()[\\]\\.,;:\\s@\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\"]{2,})$/i;\n                if (!re.test(data.eMail)) {\n                    self.validator.errors.push("Please make sure you\'ve entered a valid email.");\n                }\n            }\n\n            // Confirm Email address\n            if (!data.confirmEmail) {\n                self.validator.errors.push("Please make sure you\'ve entered your confirm email address.");\n            } else {\n                var re$1 = /^(([^<>()\\[\\]\\.,;:\\s@\\"]+(\\.[^<>()\\[\\]\\.,;:\\s@\\"]+)*)|(\\".+\\"))@(([^<>()[\\]\\.,;:\\s@\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\"]{2,})$/i;\n                if (!re$1.test(data.confirmEmail)) {\n                    self.validator.errors.push("Please make sure you\'ve entered a valid email.");\n                }\n            }\n\n            if (data.confirmEmail != data.eMail){\n                self.validator.errors.push("Please make sure you\'ve entered your confirm email address same as email address.");\n            }\n\n            // Phone number\n            if (!data.phoneNumber) {\n                self.validator.errors.push("Please make sure you\'ve entered your phone number.");\n            } else if (isNaN(data.phoneNumber)) {\n                self.validator.errors.push("Please make sure you\'ve entered a valid phone number.");\n            }\n\n            // Employer Status\n            var allowedEmp = ["ce", "se", "te", "em", "re"];\n\n            var mandEmploDetails = ["se", "em"];\n            \n            if (!data.employmentStatus) {\n                self.validator.errors.push("Please make sure you\'ve entered your employer status.");\n            } else {\n                if(baseApplicationService.getCuId() != \'C-0002\') {\n                    if(allowedEmp.indexOf(data.employmentStatus)==-1){\n                        self.validator.errors.push("Only Employed and Self Employed status allowed.");\n                    }\n                }\n            }\n            \n            \n            \n            \n            \n\n            // Employer\n            if(baseApplicationService.getCuId() == \'C-0002\') {\n                \n            } else{\n                if(mandEmploDetails.indexOf($scope.application.form.personal.employmentStatus)>-1){\n                    if(!data.employmentSector){\n                        self.validator.errors.push("Please make sure you\'ve entered your business/sector.");\n                    } \n                    if(!data.employmentPosition){\n                        self.validator.errors.push("Please make sure you\'ve entered your occupation/job title.");\n                    }\n                    if (!data.employerName) {\n                        self.validator.errors.push("Please make sure you\'ve entered your employers name.");\n                    } \n                }\n            }\n            \n\n            // Privacy Policy\n            if (!data.privacyAgreementAgreed && baseApplicationService.getCuId() == \'BS-0001\') {\n                self.validator.errors.push("To continue you must agree to our privacy policy.");\n            }\n            \n            if(!data.cuEligibility && baseApplicationService.getCuId() == \'BS-0001\'){\n                self.validator.errors.push("Please confirm your Eligibility for membership to the Credit Union.");\n            }\n\n            // Loan Amount\n            if (!data.loanAmount) {\n                self.validator.errors.push("Please make sure you\'ve entered an amount to borrow.");\n            } else {\n                var num$1 = parseFloat(data.loanAmount);\n                if (num$1 < $scope.amount.options.floor || num$1 > $scope.amount.options.ceil) {\n                    self.validator.errors.push("Please make sure you\'ve picked a valid amount to borrow.");\n                }\n            }\n\n            // Loan Term\n            if (!data.term) {\n                self.validator.errors.push("Please make sure you\'ve picked a borrowing term.");\n            } else {\n                var num$2 = parseFloat(data.term);\n                if (num$2 < $scope.term.options.floor || num$2 > $scope.term.options.ceil) {\n                    self.validator.errors.push("Please make sure you\'ve picked a valid borrowing repayment term.");\n                }\n            }\n\n            // Api loan id\n            if(!data.LoanApplicationID) {\n                self.validator.errors.push("Sorry something went wrong, please refresh and try again. (a)");\n            } else {\n                if (isNaN(data.LoanApplicationID)) {\n                    self.validator.errors.push("Sorry something went wrong, please refresh and try again. (b)");\n                }\n            }\n\n            if(!data.loanApplicationId) {\n                self.validator.errors.push("Sorry something went wrong, please refresh and try again. (c)");\n            } else {\n                if (isNaN(data.loanApplicationId)) {\n                    self.validator.errors.push("Sorry something went wrong, please refresh and try again. (d)");\n                }\n            }\n\n            // They have a suggested product?\n            if(!data.loanProductID) {\n                self.validator.errors.push("Sorry something went wrong, please refresh and try again. (c)");\n            }\n\n            // Make sure they have a nationality\n            if (!data.nationality) {\n                self.validator.errors.push("Please make sure you\'ve picked your nationality.");\n            } else {\n\n                // If they\'re not british, we need all their details\n                if (data.nationality !== \'British\') {\n\n                    if (!data.passportIdNumber) {\n                        self.validator.errors.push("Please make sure you\'ve entered your passport number.");\n                    }\n\n                    // We also make sure their passport has not expired\n                    if (!data.passportValidUntil) {\n                        self.validator.errors.push("Please make sure you\'ve entered your passport expiry.");\n                    } else {\n                        var parts = data.passportValidUntil.split(\'/\');\n\n                        if (parts.length !== 3) {\n                            self.validator.errors.push("Please make sure you\'ve entered your passport expiry correctly.");\n                        } else {\n                            var now = Date.now();\n                            var expires = Date.parse(((parts[2]) + "-" + (parts[1]) + "-" + (parts[0])));\n                            if (now > expires) {\n                                self.validator.errors.push("Sorry your passport has expired, we can only acccept non-British applicants with valid passports.");\n                            }\n                        }\n                    }\n\n                    // And they stated their issuing authority\n                    if (!data.passportIssuingAuthority) {\n                        self.validator.errors.push("Please make sure you\'ve entered your passports issuing authority.");\n                    }\n                }\n            }\n\n            if (!data.securityQuestion) {\n                self.validator.errors.push("Please make sure you\'ve picked a security question.");\n            }\n\n            if (!data.securityQuestionAnswer) {\n                self.validator.errors.push("Please make sure you\'ve entered your security answer.");\n            } else {\n                if (data.securityQuestionAnswer.length > 50) {\n                    self.validator.errors.push("Please make sure your security answer is less than 50 characters.");\n                }\n            }\n\n            if (data.state !== \'IN_PROGRESS\') {\n                self.validator.errors.push("Sorry we\'ve already processed your application. If you have not received your result please phone us.");\n            }\n\n            if (self.validator.errors.length == 0) {\n                self.validator.success = true;\n            }\n\n            return self.validator;\n        }\n    };\n}]);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy90aGVtZS1hc3NldHMvanMvX2FwcGxpY2F0aW9ucy9fbG9hbi1zZXJ2aWNlLmpzP2U1MDQiXSwic291cmNlc0NvbnRlbnQiOlsibXlDb21tdW5pdHlCYW5rLnNlcnZpY2UoJ2xvYW5BcHBsaWNhdGlvblNlcnZpY2UnLCBbJ2Jhc2VBcHBsaWNhdGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoYmFzZUFwcGxpY2F0aW9uU2VydmljZSkge1xuXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgbGV0ICRzY29wZSA9IHt9O1xuXG4gICAgc2VsZi5hdHRhY2hTY29wZSA9IGZ1bmN0aW9uKF9zY29wZSkge1xuICAgICAgICBfc2NvcGUubWV0YSA9IHNlbGYubWV0YTtcbiAgICAgICAgX3Njb3BlLmZvcm0gPSBzZWxmLmZvcm07XG4gICAgICAgICRzY29wZSA9IF9zY29wZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIHNlbGYuZ2V0RE9CID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5nZXRET0I7XG4gICAgc2VsZi5nZXRDdUlkID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5nZXRDdUlkO1xuICAgIHNlbGYuc2V0Q3VJZCA9IGJhc2VBcHBsaWNhdGlvblNlcnZpY2Uuc2V0Q3VJZDtcbiAgICBzZWxmLmdldFN0YXRlID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5nZXRTdGF0ZTtcbiAgICBzZWxmLmdldE5ld0FkZHJlc3MgPSBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLmdldE5ld0FkZHJlc3M7XG4gICAgc2VsZi5nZXRBbm51YWxJbmNvbWUgPSBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLmdldEFubnVhbEluY29tZTtcbiAgICBzZWxmLmdldFBhc3Nwb3J0RXhwaXJ5ID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5nZXRQYXNzcG9ydEV4cGlyeTtcblxuICAgIHNlbGYuc2V0SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgc2VsZi5mb3JtLnJlcXVlc3QuX2xvYW5BcHBsaWNhdGlvbklkID0gaWQ7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBzZWxmLmdldElkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoc2VsZi5mb3JtLnJlcXVlc3QuX2xvYW5BcHBsaWNhdGlvbklkKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5mb3JtLnJlcXVlc3QuX2xvYW5BcHBsaWNhdGlvbklkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgXG5cbiAgICBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLmdldElkID0gc2VsZi5nZXRJZDtcbiAgICBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLnNldElkID0gc2VsZi5zZXRJZDtcblxuICAgIHNlbGYuZ2V0QW1vdW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm0ucmVxdWVzdC5hbW91bnQ7XG4gICAgfTtcblxuICAgIHNlbGYuZ2V0VGVybSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtLnJlcXVlc3QudGVybTtcbiAgICB9O1xuXG4gICAgc2VsZi5nZXRDcmVkaXRIaXN0b3J5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm0ucmVxdWVzdC5jcmVkaXRIaXN0b3J5O1xuICAgIH07XG5cbiAgICBzZWxmLmdldExvYW5Vc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAkc2NvcGUuZm9ybS5yZXF1ZXN0LmxvYW5Vc2U7XG4gICAgfTtcblxuICAgIHNlbGYuZ2V0TG9hblVzZUlmT3RoZXJzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm0ucmVxdWVzdC5sb2FuVXNlSWZPdGhlcnM7XG4gICAgfTtcblxuICAgIHNlbGYuZ2V0QVBSID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoJHNjb3BlLnN1Z2dlc3RlZFByb2R1Y3QpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KCRzY29wZS5zdWdnZXN0ZWRQcm9kdWN0LmV4Y2VsbGVudEFwcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gJy0nO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHNlbGYuZ2V0UmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCRzY29wZS5zdWdnZXN0ZWRQcm9kdWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnN1Z2dlc3RlZFByb2R1Y3QuZXhjZWxsZW50UmF0ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAnLSc7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgc2VsZi5nZXRQcm9kdWN0SWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgkc2NvcGUuc3VnZ2VzdGVkUHJvZHVjdCkge1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zdWdnZXN0ZWRQcm9kdWN0LmxvYW5Qcm9kdWN0SWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBcblxuICAgIHNlbGYuZ2V0UHJvZHVjdE5hbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgkc2NvcGUuc3VnZ2VzdGVkUHJvZHVjdCkge1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zdWdnZXN0ZWRQcm9kdWN0LnByb2R1Y3ROYW1lO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICctJztcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIHNlbGYucHJlcGFyZVRvc0RhdGEgPSBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLnByZXBhcmVUb3NEYXRhO1xuICAgIHNlbGYucHJlcGFyZUFkZHJlc3NlcyA9IGJhc2VBcHBsaWNhdGlvblNlcnZpY2UucHJlcGFyZUFkZHJlc3NlcztcbiAgICBzZWxmLnByZXBhcmVCYW5rRGV0YWlscyA9IGJhc2VBcHBsaWNhdGlvblNlcnZpY2UucHJlcGFyZUJhbmtEZXRhaWxzO1xuICAgIHNlbGYucHJlcGFyZVNlY3VyaXR5RGF0YSA9IGJhc2VBcHBsaWNhdGlvblNlcnZpY2UucHJlcGFyZVNlY3VyaXR5RGF0YTtcbiAgICBzZWxmLnByZXBhcmVQZXJzb25hbERhdGEgPSBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLnByZXBhcmVQZXJzb25hbERhdGE7XG4gICAgc2VsZi5wcmVwYXJlT2RkTWFuZGF0b3J5RmllbGRzID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5wcmVwYXJlT2RkTWFuZGF0b3J5RmllbGRzO1xuXG4gICAgc2VsZi5wcmVwYXJlRm9yQXBpID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgIGN1SWQ6IHNlbGYuZ2V0Q3VJZCgpLFxuICAgICAgICAgICAgdGVybTogc2VsZi5nZXRUZXJtKCksXG4gICAgICAgICAgICBzdGF0ZTogc2VsZi5nZXRTdGF0ZSgpLFxuICAgICAgICAgICAgbG9hbkFtb3VudDogc2VsZi5nZXRBbW91bnQoKSxcbiAgICAgICAgICAgIGV4Y2VsbGVudFJhdGU6IHNlbGYuZ2V0UmF0ZSgpLFxuICAgICAgICAgICAgZXhpc3RpbmdMb2FuQXByOiBzZWxmLmdldEFQUigpLFxuICAgICAgICAgICAgbG9hbkFwcGxpY2F0aW9uSWQ6IHNlbGYuZ2V0SWQoKSxcbiAgICAgICAgICAgIExvYW5BcHBsaWNhdGlvbklEOiBzZWxmLmdldElkKCksXG4gICAgICAgICAgICBsb2FuUHVycG9zZTogc2VsZi5nZXRQcm9kdWN0TmFtZSgpLFxuICAgICAgICAgICAgbG9hblByb2R1Y3RJRDogc2VsZi5nZXRQcm9kdWN0SWQoKSxcbiAgICAgICAgICAgIGxvYW5Vc2UgOiBzZWxmLmdldExvYW5Vc2UoKSxcbiAgICAgICAgICAgIGxvYW5Vc2VJZk90aGVycyA6IHNlbGYuZ2V0TG9hblVzZUlmT3RoZXJzKCksXG4gICAgICAgICAgICBjcmVkaXRIaXN0b3J5IDogc2VsZi5nZXRDcmVkaXRIaXN0b3J5KCksXG4gICAgICAgIH07XG4gICAgICAgIGFuZ3VsYXIuZXh0ZW5kKFxuICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgICAgIHNlbGYucHJlcGFyZVRvc0RhdGEoKSxcbiAgICAgICAgICAgIHNlbGYucHJlcGFyZUFkZHJlc3NlcygpLFxuICAgICAgICAgICAgc2VsZi5wcmVwYXJlQmFua0RldGFpbHMoKSxcbiAgICAgICAgICAgIHNlbGYucHJlcGFyZVBlcnNvbmFsRGF0YSgpLFxuICAgICAgICAgICAgc2VsZi5wcmVwYXJlU2VjdXJpdHlEYXRhKClcbiAgICAgICAgKTtcbiAgICAgICAgLy8gc3RyaXAgZW1wdHkgdmFsdWVzIGFzIGFwaSBjYW50IGhhbmRsZVxuICAgICAgICBfLmVhY2goZGF0YSwgZnVuY3Rpb24gcmVtb3ZlRW1wdHkodmFsdWUsIGtleSkge1xuICAgICAgICAgICAgaWYgKCF2YWx1ZSAmJiB2YWx1ZSAhPT0gMCkge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhW2tleV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGRhdGEsIHNlbGYucHJlcGFyZU9kZE1hbmRhdG9yeUZpZWxkcygpKTtcblxuICAgICAgICBzYXZlQmFja3VwKCk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH07XG5cbiAgICBzZWxmLmNhbGN1bGF0ZU1vbnRobHlQYXltZW50ID0gZnVuY3Rpb24gKGFtb3VudCwgdGVybSwgaW50ZXJlc3QpIHtcbiAgICAgICAgLy8gVGhpcyBmb3JtdWxhIHdhcyBwcm92aWRlZCBmcm9tIHRoZSBjbGllbnQsIHNvIG5vIGlkZWEgaG93IGl0IHdvcmtzLlxuICAgICAgICBpZiAoaXNOYU4oaW50ZXJlc3QpKSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cblxuICAgICAgICBpbnRlcmVzdCA9IGludGVyZXN0ICogLjAxO1xuICAgICAgICBsZXQgbW9udGhseVJhdGUgPSBNYXRoLnBvdygoaW50ZXJlc3QgKiAxMDAuMCAvIDEyMDAuMCArIDEuMCksIHRlcm0pICogKGludGVyZXN0ICogMTAwLjAgLyAxMjAwLjApIC8gKE1hdGgucG93KChpbnRlcmVzdCAqIDEwMC4wIC8gMTIwMC4wICsgMS4wKSwgdGVybSkgLSAxKSAqIGFtb3VudDtcbiAgICAgICAgbGV0IG1vbnRobHlSYXRlUm91bmRlZCA9IChNYXRoLnJvdW5kKG1vbnRobHlSYXRlICogMTAwKSAvIDEwMCk7XG4gICAgICAgIHJldHVybiBtb250aGx5UmF0ZVJvdW5kZWQ7XG4gICAgfVxuXG4gICAgc2VsZi5jYWxjdWxhdGVQYXlhYmxlSW50ZXJlc3QgPSBmdW5jdGlvbiAoYW1vdW50LCB0ZXJtLCBpbnRlcmVzdCkge1xuICAgICAgICByZXR1cm4gc2VsZi5jYWxjdWxhdGVUb3RhbFJlcGF5bWVudCgpIC0gYW1vdW50O1xuICAgIH07XG5cbiAgICBzZWxmLmNhbGN1bGF0ZVRvdGFsUmVwYXltZW50ID0gZnVuY3Rpb24gKGFtb3VudCwgdGVybSwgaW50ZXJlc3QpIHtcbiAgICAgICAgaWYgKGlzTmFOKGludGVyZXN0KSkge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG1vbnRobHlQYXltZW50ID0gc2VsZi5jYWxjdWxhdGVNb250aGx5UGF5bWVudChhbW91bnQsIHRlcm0sIGludGVyZXN0KTtcbiAgICAgICAgbGV0IHRvdGFsUGF5bWVudCA9IG1vbnRobHlQYXltZW50ICogdGVybTtcblxuICAgICAgICByZXR1cm4gdG90YWxQYXltZW50O1xuICAgIH07XG5cbiAgICBzZWxmLm1vbnRobHlSZXBheW1lbnRzID0gZnVuY3Rpb24gKHByb2R1Y3QpIHtcbiAgICAgICAgaWYgKCFwcm9kdWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2VsZi5jYWxjdWxhdGVNb250aGx5UGF5bWVudChzZWxmLmdldEFtb3VudCgpLCBzZWxmLmdldFRlcm0oKSwgc2VsZi5nZXRSYXRlKCkpO1xuICAgIH07XG5cbiAgICBzZWxmLnRvdGFsUmVwYXltZW50ID0gZnVuY3Rpb24gKHByb2R1Y3QpIHtcbiAgICAgICAgaWYgKCFwcm9kdWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2VsZi5jYWxjdWxhdGVUb3RhbFJlcGF5bWVudChzZWxmLmdldEFtb3VudCgpLCBzZWxmLmdldFRlcm0oKSwgc2VsZi5nZXRSYXRlKCkpO1xuICAgIH07XG4gICAgXG4gICAgc2VsZi5jYWNoZWRZZWFycyA9IG51bGw7XG4gICAgc2VsZi5tZXRhID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5tZXRhO1xuXG4gICAgc2VsZi5mb3JtID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5mb3JtO1xuXG4gICAgc2VsZi52YWxpZGF0b3IgPSB7XG4gICAgICAgIGVycm9yczogW10sXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICB2YWxpZGF0ZUJhbmtEZXRhaWxzKCkge1xuICAgICAgICAgICAgc2VsZi52YWxpZGF0b3Iuc3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzID0gW107XG4gICAgICAgICAgICBsZXQgZGF0YSA9IGJhc2VBcHBsaWNhdGlvblNlcnZpY2UuZm9ybS52ZXJpZnk7XG5cbiAgICAgICAgICAgIGlmKCFkYXRhLnNvcnRDb2RlKXtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBTb3J0IENvZGUuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIWRhdGEuYWNjb3VudE51bWJlcil7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIHlvdXIgQWNjb3VudCBOdW1iZXIuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIWRhdGEuY3VFbGlnaWJpbGl0eSAmJiBhbmd1bGFyLmVsZW1lbnQoJ1tkYXRhLWN1aWRdJykuZGF0YSgnY3VpZCcpICE9ICdCUy0wMDAxJyl7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgY29uZmlybSB5b3VyIEVsaWdpYmlsaXR5IGZvciBtZW1iZXJzaGlwIHRvIHRoZSBDcmVkaXQgVW5pb24uXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlbGYudmFsaWRhdG9yLmVycm9ycy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3Iuc3VjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc2VsZi52YWxpZGF0b3I7XG4gICAgICAgIH0sXG4gICAgICAgIGdvKCkge1xuXG4gICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMgPSBbXTtcblxuICAgICAgICAgICAgbGV0IGRhdGEgPSBzZWxmLnByZXBhcmVGb3JBcGkoKTtcbiAgICAgICAgICAgIC8vIEFubnVhbCBJbmNvbWVcbiAgICAgICAgICAgIGlmIChpc05hTihkYXRhLmluY29tZSkpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBhbm51YWwgaW5jb21lLlwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IG51bSA9IHBhcnNlRmxvYXQoZGF0YS5pbmNvbWUpO1xuICAgICAgICAgICAgICAgIGlmKG51bSA8IDE4MDAwICYmIGRhdGEuY3VJZCAhPSAnQy0wMDAyJyl7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiU29ycnkgYnV0IHdlIGNhbiBvbmx5IGxlbmQgdG8gcGVvcGxlIHdpdGggYW5udWFsIGluY29tZSBhYm92ZSDCozE4MDAwLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobnVtIDwgMSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBhbm51YWwgaW5jb21lIGFjY3VyYXRlbHkuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICBcblxuICAgICAgICAgICAgLy8gQmFuayBhY2NvdW50IHR5cGVcbiAgICAgICAgICAgIGlmICghZGF0YS5iYW5rQWNjb3VudFR5cGUpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIHBpY2tlZCB5b3VyIGJhbmsgYWNjb3VudCB0eXBlLiAoYSlcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLmJhbmtBY2NvdW50VHlwZSAhPT0gJ0NVUlJFTlQnICYmIGRhdGEuYmFua0FjY291bnRUeXBlICE9PSAnU0FWSU5HUycpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBwaWNrZWQgYSB2YWxpZCBiYW5rIGFjY291bnQgdHlwZSAoYilcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBCYW5rIGFjY291bnQgdXNhZ2VcbiAgICAgICAgICAgIGlmICghZGF0YS5iYW5rQWNjb3VudFVzYWdlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBwaWNrZWQgeW91ciBiYW5rIGFjY291bnQgdHlwZS4gKGMpXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5iYW5rQWNjb3VudFVzYWdlICE9PSAnUEVSU09OQUwnICYmIGRhdGEuYmFua0FjY291bnRVc2FnZSAhPT0gJ0JVU0lORVNTJykge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIHBpY2tlZCBhIHZhbGlkIGJhbmsgYWNjb3VudCB0eXBlLiAoZClcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBZGRyZXNzIGRldGFpbHNcbiAgICAgICAgICAgIGlmKCFkYXRhLmFkZHJlc3MpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBhZGRyZXNzLlwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyppZiAoIWRhdGEuYnVpbGRpbmdOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgYSBidWlsZGluZyBuYW1lIG9yIG51bWJlci5cIik7XG4gICAgICAgICAgICB9Ki9cblxuICAgICAgICAgICAgaWYgKCFkYXRhLmNpdHkpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgYSB0b3duIG9yIGNpdHkuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWRhdGEuc3RyZWV0KSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIGEgc3RyZWV0IG9yIHJvYWQuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBQb3N0Y29kZSBkZXRhaWxzXG4gICAgICAgICAgICBpZiAoIWRhdGEucG9zdGNvZGUpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgYSBwb3N0Y29kZS5cIik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEucG9zdGNvZGUubGVuZ3RoID4gOCB8fCBkYXRhLnBvc3Rjb2RlLmxlbmd0aCA8IDUpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBwb3N0Y29kZSBjb3JyZWN0bHkuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMb2FuIFB1cnBvc2VcbiAgICAgICAgICAgIGlmICghZGF0YS5sb2FuVXNlKSB7XG4gICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIHB1cnBvc2Ugb2YgbG9hbi5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGF0YS5sb2FuVXNlID09ICdPdGhlcicgJiYgIWRhdGEubG9hblVzZUlmT3RoZXJzKSB7XG4gICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB0aGUgc3BlY2lmaWMgbG9hbiBwdXJwb3NlLlwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUGVyc29uYWwgZGV0YWlsc1xuICAgICAgICAgICAgaWYgKCFkYXRhLnRpdGxlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIHlvdXIgdGl0bGUuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWRhdGEuZmlyc3ROYW1lKSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIHlvdXIgZmlyc3QgbmFtZS5cIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghZGF0YS5sYXN0TmFtZSkge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIGxhc3QgbmFtZS5cIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghZGF0YS5iaXJ0aERhdGUpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBkYXRlIG9mIGJpcnRoLlwiKTtcbiAgICAgICAgICAgIH0gZWxzZXtcbiAgICAgICAgICAgICAgICBsZXQgdG9kYXkgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgIGxldCBtb250aCA9IHBhcnNlSW50KHNlbGYuZm9ybS5wZXJzb25hbC5kb2IubW9udGgubnVtYmVyIC0xKTtcbiAgICAgICAgICAgICAgICBsZXQgZGF5ID0gcGFyc2VJbnQoc2VsZi5mb3JtLnBlcnNvbmFsLmRvYi5kYXkpO1xuICAgICAgICAgICAgICAgIGxldCB5ZWFyID0gcGFyc2VJbnQoc2VsZi5mb3JtLnBlcnNvbmFsLmRvYi55ZWFyKTtcbsKgwqDCoMKgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG5ld8KgRGF0ZSh5ZWFyKzE4LMKgbW9udGgswqBkYXkpwqA8PcKgdG9kYXk7XG4gICAgICAgICAgICAgICAgaWYoIXJlc3VsdCl7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiWW91IGFyZSBub3QgY29tcGxldGVkIDE4IHllYXIuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgXG5cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gRW1haWwgYWRkcmVzc1xuICAgICAgICAgICAgaWYgKCFkYXRhLmVNYWlsKSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIHlvdXIgZW1haWwgYWRkcmVzcy5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCByZSA9IC9eKChbXjw+KClcXFtcXF1cXC4sOzpcXHNAXFxcIl0rKFxcLltePD4oKVxcW1xcXVxcLiw7Olxcc0BcXFwiXSspKil8KFxcXCIuK1xcXCIpKUAoKFtePD4oKVtcXF1cXC4sOzpcXHNAXFxcIl0rXFwuKStbXjw+KClbXFxdXFwuLDs6XFxzQFxcXCJdezIsfSkkL2k7XG4gICAgICAgICAgICAgICAgaWYgKCFyZS50ZXN0KGRhdGEuZU1haWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCBhIHZhbGlkIGVtYWlsLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENvbmZpcm0gRW1haWwgYWRkcmVzc1xuICAgICAgICAgICAgaWYgKCFkYXRhLmNvbmZpcm1FbWFpbCkge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIGNvbmZpcm0gZW1haWwgYWRkcmVzcy5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCByZSA9IC9eKChbXjw+KClcXFtcXF1cXC4sOzpcXHNAXFxcIl0rKFxcLltePD4oKVxcW1xcXVxcLiw7Olxcc0BcXFwiXSspKil8KFxcXCIuK1xcXCIpKUAoKFtePD4oKVtcXF1cXC4sOzpcXHNAXFxcIl0rXFwuKStbXjw+KClbXFxdXFwuLDs6XFxzQFxcXCJdezIsfSkkL2k7XG4gICAgICAgICAgICAgICAgaWYgKCFyZS50ZXN0KGRhdGEuY29uZmlybUVtYWlsKSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgYSB2YWxpZCBlbWFpbC5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZGF0YS5jb25maXJtRW1haWwgIT0gZGF0YS5lTWFpbCl7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIHlvdXIgY29uZmlybSBlbWFpbCBhZGRyZXNzIHNhbWUgYXMgZW1haWwgYWRkcmVzcy5cIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFBob25lIG51bWJlclxuICAgICAgICAgICAgaWYgKCFkYXRhLnBob25lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIHlvdXIgcGhvbmUgbnVtYmVyLlwiKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNOYU4oZGF0YS5waG9uZU51bWJlcikpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgYSB2YWxpZCBwaG9uZSBudW1iZXIuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBFbXBsb3llciBTdGF0dXNcbiAgICAgICAgICAgIHZhciBhbGxvd2VkRW1wID0gW1wiY2VcIiwgXCJzZVwiLCBcInRlXCIsIFwiZW1cIiwgXCJyZVwiXTtcblxuICAgICAgICAgICAgdmFyIG1hbmRFbXBsb0RldGFpbHMgPSBbXCJzZVwiLCBcImVtXCJdO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoIWRhdGEuZW1wbG95bWVudFN0YXR1cykge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIGVtcGxveWVyIHN0YXR1cy5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmKGJhc2VBcHBsaWNhdGlvblNlcnZpY2UuZ2V0Q3VJZCgpICE9ICdDLTAwMDInKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGFsbG93ZWRFbXAuaW5kZXhPZihkYXRhLmVtcGxveW1lbnRTdGF0dXMpPT0tMSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIk9ubHkgRW1wbG95ZWQgYW5kIFNlbGYgRW1wbG95ZWQgc3RhdHVzIGFsbG93ZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBcblxuICAgICAgICAgICAgLy8gRW1wbG95ZXJcbiAgICAgICAgICAgIGlmKGJhc2VBcHBsaWNhdGlvblNlcnZpY2UuZ2V0Q3VJZCgpID09ICdDLTAwMDInKSB7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICAgICAgaWYobWFuZEVtcGxvRGV0YWlscy5pbmRleE9mKCRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnBlcnNvbmFsLmVtcGxveW1lbnRTdGF0dXMpPi0xKXtcbiAgICAgICAgICAgICAgICAgICAgaWYoIWRhdGEuZW1wbG95bWVudFNlY3Rvcil7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBidXNpbmVzcy9zZWN0b3IuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IFxuICAgICAgICAgICAgICAgICAgICBpZighZGF0YS5lbXBsb3ltZW50UG9zaXRpb24pe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIHlvdXIgb2NjdXBhdGlvbi9qb2IgdGl0bGUuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghZGF0YS5lbXBsb3llck5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIGVtcGxveWVycyBuYW1lLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcblxuICAgICAgICAgICAgLy8gUHJpdmFjeSBQb2xpY3lcbiAgICAgICAgICAgIGlmICghZGF0YS5wcml2YWN5QWdyZWVtZW50QWdyZWVkICYmIGJhc2VBcHBsaWNhdGlvblNlcnZpY2UuZ2V0Q3VJZCgpID09ICdCUy0wMDAxJykge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiVG8gY29udGludWUgeW91IG11c3QgYWdyZWUgdG8gb3VyIHByaXZhY3kgcG9saWN5LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYoIWRhdGEuY3VFbGlnaWJpbGl0eSAmJiBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLmdldEN1SWQoKSA9PSAnQlMtMDAwMScpe1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIGNvbmZpcm0geW91ciBFbGlnaWJpbGl0eSBmb3IgbWVtYmVyc2hpcCB0byB0aGUgQ3JlZGl0IFVuaW9uLlwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTG9hbiBBbW91bnRcbiAgICAgICAgICAgIGlmICghZGF0YS5sb2FuQW1vdW50KSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIGFuIGFtb3VudCB0byBib3Jyb3cuXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgbnVtID0gcGFyc2VGbG9hdChkYXRhLmxvYW5BbW91bnQpO1xuICAgICAgICAgICAgICAgIGlmIChudW0gPCAkc2NvcGUuYW1vdW50Lm9wdGlvbnMuZmxvb3IgfHwgbnVtID4gJHNjb3BlLmFtb3VudC5vcHRpb25zLmNlaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBwaWNrZWQgYSB2YWxpZCBhbW91bnQgdG8gYm9ycm93LlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIExvYW4gVGVybVxuICAgICAgICAgICAgaWYgKCFkYXRhLnRlcm0pIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIHBpY2tlZCBhIGJvcnJvd2luZyB0ZXJtLlwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IG51bSA9IHBhcnNlRmxvYXQoZGF0YS50ZXJtKTtcbiAgICAgICAgICAgICAgICBpZiAobnVtIDwgJHNjb3BlLnRlcm0ub3B0aW9ucy5mbG9vciB8fCBudW0gPiAkc2NvcGUudGVybS5vcHRpb25zLmNlaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBwaWNrZWQgYSB2YWxpZCBib3Jyb3dpbmcgcmVwYXltZW50IHRlcm0uXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQXBpIGxvYW4gaWRcbiAgICAgICAgICAgIGlmKCFkYXRhLkxvYW5BcHBsaWNhdGlvbklEKSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJTb3JyeSBzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHJlZnJlc2ggYW5kIHRyeSBhZ2Fpbi4gKGEpXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4oZGF0YS5Mb2FuQXBwbGljYXRpb25JRCkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJTb3JyeSBzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHJlZnJlc2ggYW5kIHRyeSBhZ2Fpbi4gKGIpXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoIWRhdGEubG9hbkFwcGxpY2F0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlNvcnJ5IHNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgcmVmcmVzaCBhbmQgdHJ5IGFnYWluLiAoYylcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChpc05hTihkYXRhLmxvYW5BcHBsaWNhdGlvbklkKSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlNvcnJ5IHNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgcmVmcmVzaCBhbmQgdHJ5IGFnYWluLiAoZClcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUaGV5IGhhdmUgYSBzdWdnZXN0ZWQgcHJvZHVjdD9cbiAgICAgICAgICAgIGlmKCFkYXRhLmxvYW5Qcm9kdWN0SUQpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlNvcnJ5IHNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgcmVmcmVzaCBhbmQgdHJ5IGFnYWluLiAoYylcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGV5IGhhdmUgYSBuYXRpb25hbGl0eVxuICAgICAgICAgICAgaWYgKCFkYXRhLm5hdGlvbmFsaXR5KSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBwaWNrZWQgeW91ciBuYXRpb25hbGl0eS5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgLy8gSWYgdGhleSdyZSBub3QgYnJpdGlzaCwgd2UgbmVlZCBhbGwgdGhlaXIgZGV0YWlsc1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLm5hdGlvbmFsaXR5ICE9PSAnQnJpdGlzaCcpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEucGFzc3BvcnRJZE51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIHlvdXIgcGFzc3BvcnQgbnVtYmVyLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIGFsc28gbWFrZSBzdXJlIHRoZWlyIHBhc3Nwb3J0IGhhcyBub3QgZXhwaXJlZFxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEucGFzc3BvcnRWYWxpZFVudGlsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBwYXNzcG9ydCBleHBpcnkuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBhcnRzID0gZGF0YS5wYXNzcG9ydFZhbGlkVW50aWwuc3BsaXQoJy8nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCAhPT0gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIHBhc3Nwb3J0IGV4cGlyeSBjb3JyZWN0bHkuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZXhwaXJlcyA9IERhdGUucGFyc2UoYCR7cGFydHNbMl19LSR7cGFydHNbMV19LSR7cGFydHNbMF19YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vdyA+IGV4cGlyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJTb3JyeSB5b3VyIHBhc3Nwb3J0IGhhcyBleHBpcmVkLCB3ZSBjYW4gb25seSBhY2NjZXB0IG5vbi1Ccml0aXNoIGFwcGxpY2FudHMgd2l0aCB2YWxpZCBwYXNzcG9ydHMuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIEFuZCB0aGV5IHN0YXRlZCB0aGVpciBpc3N1aW5nIGF1dGhvcml0eVxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEucGFzc3BvcnRJc3N1aW5nQXV0aG9yaXR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBwYXNzcG9ydHMgaXNzdWluZyBhdXRob3JpdHkuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWRhdGEuc2VjdXJpdHlRdWVzdGlvbikge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgcGlja2VkIGEgc2VjdXJpdHkgcXVlc3Rpb24uXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWRhdGEuc2VjdXJpdHlRdWVzdGlvbkFuc3dlcikge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIHNlY3VyaXR5IGFuc3dlci5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLnNlY3VyaXR5UXVlc3Rpb25BbnN3ZXIubGVuZ3RoID4gNTApIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdXIgc2VjdXJpdHkgYW5zd2VyIGlzIGxlc3MgdGhhbiA1MCBjaGFyYWN0ZXJzLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkYXRhLnN0YXRlICE9PSAnSU5fUFJPR1JFU1MnKSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJTb3JyeSB3ZSd2ZSBhbHJlYWR5IHByb2Nlc3NlZCB5b3VyIGFwcGxpY2F0aW9uLiBJZiB5b3UgaGF2ZSBub3QgcmVjZWl2ZWQgeW91ciByZXN1bHQgcGxlYXNlIHBob25lIHVzLlwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNlbGYudmFsaWRhdG9yLmVycm9ycy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLnN1Y2Nlc3MgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gc2VsZi52YWxpZGF0b3I7XG4gICAgICAgIH1cbiAgICB9O1xufV0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHRoZW1lLWFzc2V0cy9qcy9fYXBwbGljYXRpb25zL19sb2FuLXNlcnZpY2UuanMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9');
},function(module,exports){eval("myCommunityBank.controller('savingsApplicationController', ['$scope', 'cuSavingsApiFactory','cuLoansApiFactory', '$filter', 'savingsApplicationService','baseApplicationService', '$timeout','$window','$location',  function($scope, cuSavingsApiFactory,cuLoansApiFactory, $filter, savingsApplicationService,baseApplicationService, $timeout,$window,$location){\n    /* Here we setup the whole controller ready to do stuff! */\n    $scope.step = 'apply';\n    $scope.savingsApi = cuSavingsApiFactory;\n    $scope.loansApi = cuLoansApiFactory;\n    $scope.globalErrorMessage = null;\n    $scope.savingDetail = false;\n    if(angular.element('[data-cuid]').data('cuid') == 'BS-0001' ) {\n        $scope.savingDetail = true;\n    }\n    \n    var metaConfig = (function () {\n        var el = angular.element('[data-meta]');\n\n        var config = {\n            titles: true,\n            security: true,\n            nationalities: true,\n            purposes : true,\n            empstatuss:  true,\n            creditratings:  true,\n        };\n\n        if (el.length) {\n            var mods = el.data('meta').split(',');\n            _.each(mods, function (m) {\n                var item = m.split(':');\n                config[item[0].trim()] = item[1].trim() === 'true';\n            })\n        }\n\n        return config;\n    })();\n\n    $scope.result = {\n        union: '',\n        status: 'REJT',\n        esign: null\n    };\n\n    $scope.application = savingsApplicationService.attachScope($scope);\n    $scope.savingsApi.syncMeta($scope.meta, metaConfig);\n\n    $window.onclick = function(e) {\n        if(e.target.className.split(\" \").indexOf(\"clickoutside\") < 0)\n        {\n            $scope.parentObj.businesschoiceSelected = false;\n            $scope.parentObj.occupationchoiceSelected = false;\n            $scope.parentObj.employerchoiceSelected = false;\n            $scope.parentObj.associationchoiceSelected = false;\n        }\n    }\n\n    $scope.loansApi.fetchBusinessList(function (data){\n        $scope.businessList = data;\n    }, function (err) {\n        UIkit.notification({\n            message: err,\n            status: 'danger',\n            pos: 'bottom-right'\n        });\n    });\n\n    $scope.loansApi.fetchOccupationList(function (data){\n        $scope.occupationList = data;\n    }, function (err) {\n        UIkit.notification({\n            message: err,\n            status: 'danger',\n            pos: 'bottom-right'\n        });\n    });\n\n    $scope.loansApi.fetchAssociationList(function (data){\n      $scope.associationList = [];\n      for(var i in data)  {\n        $scope.associationList.push(data[i]);\n      }\n    }, function (err) {\n        UIkit.notification({\n            message: err,\n            status: 'danger',\n            pos: 'bottom-right'\n        });\n    });\n\n    $scope.loansApi.fetchEmployerList(function (data){  \n        $scope.employerList = data;   \n    }, function (err) {\n        UIkit.notification({\n            message: err,\n            status: 'danger',\n            pos: 'bottom-right'\n        });\n    });\n\n    $scope.parentObj = {};\n    $scope.parentObj.businesschoiceSelected= true;\n    $scope.setBusiness = function(val){\n      console.info(val);\n      $scope.application.form.personal.employmentSector = val;\n      $scope.parentObj.businesschoiceSelected= false;\n    }\n  \n    $scope.parentObj.occupationchoiceSelected= true;\n    $scope.setOccupation = function(val){\n      console.info(val);\n      $scope.application.form.personal.employmentPosition = val;\n      $scope.parentObj.occupationchoiceSelected= false;\n    }\n\n    $scope.parentObj.associationchoiceSelected= false;\n    $scope.setAssociation = function(val){\n      console.info(val);\n      $scope.application.form.personal.association = val;\n      $scope.parentObj.associationchoiceSelected= false;\n    }\n\n    $scope.parentObj.employerchoiceSelected= true;\n    $scope.setEmployerName = function(val){\n      console.info(val);\n      $scope.application.form.personal.employer = val;\n      $scope.parentObj.employerchoiceSelected= false;\n    }\n\n    /**\n     * Upload document\n     */\n    $scope.uploadFile = function () {\n        $scope.processDropzone();\n    };\n\n    $scope.reset = function () {\n        $scope.resetDropzone();\n    };\n\n    function loadApplication () {\n        if ($scope.application.getId()) {\n            continueApplication();\n        } else {\n            startApplication();\n        }\n    };\n\n    function continueApplication () {\n\n        var appData = {\n            savingsProductId: angular.element('[data-product]').data('product'),\n            cuId: angular.element('[data-cuid]').data('cuid'),\n        };\n\n        $scope.application.setProductId(appData.savingsProductId).setCuId(appData.cuId);\n    };\n\n    function startApplication () {\n\n        var appData = {\n            savingsProductId: angular.element('[data-product]').data('product'),\n            cuId: angular.element('[data-cuid]').data('cuid'),\n        };\n\n        $scope.savingsApi.startApplication(appData, function (data) {\n\n            $scope.application\n                .setId(data.SavingsApplicationID)\n                .setProductId(appData.savingsProductId)\n                .setCuId(appData.cuId);\n\n                window.saveBackup();\n        }, function (err) {\n            console.error(err);\n        });\n    };\n\n    function saveApplicationInformation () {\n\n        var constructedApplicationData = $scope.application.prepareForApi();\n\n        $scope.savingsApi.syncApplication(constructedApplicationData, function (data) {\n            // console.log(data);\n        }, function (err) {\n            console.error(err);\n        });\n    };\n\n    /* We're now ready to start doing stuff with the form */\n\n    $scope.isActiveStep = function (step) {\n        return $scope.step == step;\n    };\n\n    $scope.setActiveStep = function (step) {\n        $scope.step = step;\n\n        $timeout(function () {\n            var el = jQuery('.application-section, .processing-step');\n\n            if (el.length) {\n\n                var offset = el.eq(0).position().top - 15;\n\n                jQuery('html, body').animate({\n                    scrollTop: offset\n                });\n            }\n        }, 150);\n\n        return $scope.step;\n    };\n\n    $scope.submitApplication = function () {\n\n        var validation = savingsApplicationService.validator.go();\n        $scope.globalErrorMessage = null;\n        if (validation.success) {\n            $scope.setActiveStep('processing');\n\n            $scope.savingsApi.submitApplication($scope.application, function (data) {\n\n                $scope.result = {\n                    union: data.allocatedCU,\n                    status: data.status,\n                    esign: null\n                };\n\n                if ($scope.result.status === 'APPR' || $scope.result.status === 'ARST') {\n                    $scope.setActiveStep('accepted');\n                } else if ($scope.result.status === 'CAPR') {\n                    $scope.setActiveStep('conditionallyapproved');\n                } else {\n                    $scope.setActiveStep('rejected');\n                }\n            }, function (err) {\n                $scope.globalErrorMessage = err;\n                $scope.setActiveStep('error');\n                console.error(err);\n            });\n        }\n    };\n\n    $scope.submitEmail = function(){\n        $scope.setActiveStep('processing');\n        \n            $scope.savingsApi.submitEmail($scope.application.form.personal.email, function (data) {\n                \n             }, function (err) {\n                $scope.globalErrorMessage = err;\n                $scope.setActiveStep('error');\n                console.error(err);\n            });\n    };\n\n    $scope.goToAgreement = function () {\n        $scope.setActiveStep('generatingagreement');\n        $scope.globalErrorMessage = null;\n\n        $scope.savingsApi.generateAgreement($scope.application, function (data) {\n            if (data && data.esignUrl) {\n                $scope.result.esign = $scope.savingsApi.getSafeEsignUrl(data.esignUrl);\n                $scope.setActiveStep('sign');\n            } else {\n                $scope.setActiveStep('sign');\n            }\n        }, function (err) {\n            $scope.globalErrorMessage = err;\n            $scope.setActiveStep('error');\n            console.error(err);\n        });\n    };\n\n    $scope.confirmSignature = function () {\n        UIkit.modal.confirm(\"\\n            <h3>Warning! Before you continue</h3>\\n            <p>Please make sure you've clicked the blue 'Click to Sign' button on the previous agreement document.</p>\\n            <p>If you continue now without clicking this button, your application will not be complete and you will need to start again.</p>\", {\n            labels: {\n                cancel: 'Back to agreement',\n                ok: \"Continue\"\n            }\n        }).then(function() {\n            window.pruneBackup();\n            $scope.$apply(function () {\n                $scope.setActiveStep('confirmation');\n            });\n        });\n    };\n\n    $scope.lookupAddress = function (address) {\n        address.cant_find = false;\n\n        $scope.savingsApi.lookupPostcode(address.postcode, function (data) {\n            address.city = data.generic.city;\n            address.street = data.generic.street;\n            address.postcode = data.generic.postcode;\n            address.suggestions = data.suggestions;\n\n            return $scope.updateApplication();\n        }, function (err) {\n            address.cant_find = true;\n            UIkit.notification({\n                message: err,\n                status: 'danger',\n                pos: 'bottom-right'\n            });\n        });\n    };\n\n    $scope.addressThreeYearToggle = function (address) {\n        if (address.less_than_three_years) {\n            $scope.application.form.addresses.push(savingsApplicationService.getNewAddress());\n        } else {\n            var index = $scope.application.form.addresses.indexOf(address);\n            $scope.application.form.addresses.splice(index + 1, 1);\n        }\n    };\n\n    $scope.updateApplication = function () {\n        saveApplicationInformation();\n    };\n\n    $scope.contentYes= 'no';\n    $scope.changeEmployerStaus = function (){\n        var allowedEmp = ['em','se','ce','te','ot'];\n            if(allowedEmp.indexOf($scope.application.form.personal.employmentStatus)>-1){\n                $scope.contentYes= 'yes';\n            } else {\n                $scope.contentYes= 'no';\n            }\n    }\n    $scope.checkMandatory = function(){\n        var notallowedEmp = ['st','re','hm','un'];\n        if(notallowedEmp.indexOf($scope.application.form.personal.employmentStatus)>-1){\n            if($scope.application.form.personal.relativeinmycb == 'no'){\n                return 'required';\n            }\n            else\n                return false; \n        } else {\n            return false;\n        }\n    }\n\n    $scope.checkRequired = function(){\n        if($scope.application.form.personal.relativeinmycb == 'no'){\n            return 'required';\n        }\n        else\n            return false;\n    }\n\n    $scope.showDebugInformation = function () {\n        var information = localStorage.getItem('applicationFormData') || null;\n        UIkit.modal.alert((\"\\n            <textarea style=\\\"width: 100%; height: 50px; background: black; color: white;\\\">\" + information + \"</textarea>\\n            <p>Please copy/paste all the text from above.</p>\\n        \"));\n    };\n\n    loadApplication();\n\n    $scope.confirmDetails = function(){\n        $scope.setActiveStep('processing');\n            var weburl = $location.absUrl(); \n            $scope.application.form.verify.url = weburl;\n            $scope.loansApi.confirmDetailsUpload($scope.application.form.verify, \n            function (data) {\n                $scope.savingsApi.setAuthTokenUpload(data.authToken);\n                $scope.savingsApi.setApplicationID(data.loanId);\n                $scope.result = {\n                    fullName: data.fullName,\n                    amount: data.amount,\n                };\n                $scope.setActiveStep('loanDetails');\n             }, function (err) {\n                $scope.errorMessageConfused = err;\n                $scope.setActiveStep('mismatchDetail');\n            });\n    };\n\n}]).filter('highlight',['$sce', function ($sce) {\n    return function (input, query) {\n      if (query === '' || query == null) {\n          return \"\";\n      } else if (query.length < 1) {\n          return \"\";\n      }\n      return $sce.trustAsHtml(input.toUpperCase().replace(RegExp('('+ query.toUpperCase() + ')', 'g'), '<b class=\"high_light\">$1</b>'));\n    }\n  }])\n.filter('highlight2',['$sce', function ($sce) {\n    return function (input, query) {\n      if (query === '' || query == null) {\n          return $sce.trustAsHtml(input);\n      } else if (query.length < 1) {\n          return $sce.trustAsHtml(input);\n      }\n      return $sce.trustAsHtml(input.toUpperCase().replace(RegExp('('+ query.toUpperCase() + ')', 'g'), '<b class=\"high_light\">$1</b>'));\n    }\n  }])\n  .directive('dropzone', ['cuSavingsApiFactory', function (cuSavingsApiFactory) {\n    return {\n        restrict: 'C',\n        link: function (scope, element, attrs) {\n\n            var config = {\n                url: 'https://file-applicationculoans.culoans.co.uk/cuplatformfiles/loanapplications/saveapplicantdocuments/'+cuSavingsApiFactory.getApplicationID(),\n                maxFilesize: 15,\n                paramName: \"file\",\n                maxThumbnailFilesize: 3,\n                parallelUploads: 1,\n                acceptedFiles: \".jpeg,.jpg,.png,.gif,.bmp,.pdf,.xls,.xlsx,.doc,.docx,.msg\",\n                autoProcessQueue: true,\n                headers: {\n                    'X-API-KEY': '8ab7c59b5843653401584365625a0000',\n                    'X-Auth-Token': cuSavingsApiFactory.getAuthTokenUpload(),\n                    \"Cache-Control\": \"\",\n                    \"X-Requested-With\" : \"\"\n                }\n            };\n\n            \n\n            var dropzone = new Dropzone(element[0], config);\n\n            dropzone.on(\"addedfile\", function(file) {\n                dropzone.options.url  = 'https://file-applicationculoans.culoans.co.uk/cuplatformfiles/loanapplications/saveapplicantdocuments/'+cuSavingsApiFactory.getApplicationID();\n                dropzone.options.headers =  {\n                    'X-API-KEY': '8ab7c59b5843653401584365625a0000',\n                    'X-Auth-Token': cuSavingsApiFactory.getAuthTokenUpload(),\n                    \"Cache-Control\": \"\",\n                    \"X-Requested-With\" : \"\"\n                }\n            });\n\n            scope.processDropzone = function () {\n                \n                dropzone.options.autoProcessQueue=true;\n                dropzone.processQueue();\n            };\n\n            scope.resetDropzone = function () {\n                dropzone.removeAllFiles();\n            }\n        }\n    }\n}])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy90aGVtZS1hc3NldHMvanMvX2FwcGxpY2F0aW9ucy9fc2F2aW5ncy1jb250cm9sbGVyLmpzPzI5MTgiXSwic291cmNlc0NvbnRlbnQiOlsibXlDb21tdW5pdHlCYW5rLmNvbnRyb2xsZXIoJ3NhdmluZ3NBcHBsaWNhdGlvbkNvbnRyb2xsZXInLCBbJyRzY29wZScsICdjdVNhdmluZ3NBcGlGYWN0b3J5JywnY3VMb2Fuc0FwaUZhY3RvcnknLCAnJGZpbHRlcicsICdzYXZpbmdzQXBwbGljYXRpb25TZXJ2aWNlJywnYmFzZUFwcGxpY2F0aW9uU2VydmljZScsICckdGltZW91dCcsJyR3aW5kb3cnLCckbG9jYXRpb24nLCAgZnVuY3Rpb24oJHNjb3BlLCBjdVNhdmluZ3NBcGlGYWN0b3J5LGN1TG9hbnNBcGlGYWN0b3J5LCAkZmlsdGVyLCBzYXZpbmdzQXBwbGljYXRpb25TZXJ2aWNlLGJhc2VBcHBsaWNhdGlvblNlcnZpY2UsICR0aW1lb3V0LCR3aW5kb3csJGxvY2F0aW9uKXtcbiAgICAvKiBIZXJlIHdlIHNldHVwIHRoZSB3aG9sZSBjb250cm9sbGVyIHJlYWR5IHRvIGRvIHN0dWZmISAqL1xuICAgICRzY29wZS5zdGVwID0gJ2FwcGx5JztcbiAgICAkc2NvcGUuc2F2aW5nc0FwaSA9IGN1U2F2aW5nc0FwaUZhY3Rvcnk7XG4gICAgJHNjb3BlLmxvYW5zQXBpID0gY3VMb2Fuc0FwaUZhY3Rvcnk7XG4gICAgJHNjb3BlLmdsb2JhbEVycm9yTWVzc2FnZSA9IG51bGw7XG4gICAgJHNjb3BlLnNhdmluZ0RldGFpbCA9IGZhbHNlO1xuICAgIGlmKGFuZ3VsYXIuZWxlbWVudCgnW2RhdGEtY3VpZF0nKS5kYXRhKCdjdWlkJykgPT0gJ0JTLTAwMDEnICkge1xuICAgICAgICAkc2NvcGUuc2F2aW5nRGV0YWlsID0gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgbGV0IG1ldGFDb25maWcgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgZWwgPSBhbmd1bGFyLmVsZW1lbnQoJ1tkYXRhLW1ldGFdJyk7XG5cbiAgICAgICAgbGV0IGNvbmZpZyA9IHtcbiAgICAgICAgICAgIHRpdGxlczogdHJ1ZSxcbiAgICAgICAgICAgIHNlY3VyaXR5OiB0cnVlLFxuICAgICAgICAgICAgbmF0aW9uYWxpdGllczogdHJ1ZSxcbiAgICAgICAgICAgIHB1cnBvc2VzIDogdHJ1ZSxcbiAgICAgICAgICAgIGVtcHN0YXR1c3M6ICB0cnVlLFxuICAgICAgICAgICAgY3JlZGl0cmF0aW5nczogIHRydWUsXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGVsLmxlbmd0aCkge1xuICAgICAgICAgICAgbGV0IG1vZHMgPSBlbC5kYXRhKCdtZXRhJykuc3BsaXQoJywnKTtcbiAgICAgICAgICAgIF8uZWFjaChtb2RzLCBmdW5jdGlvbiAobSkge1xuICAgICAgICAgICAgICAgIGxldCBpdGVtID0gbS5zcGxpdCgnOicpO1xuICAgICAgICAgICAgICAgIGNvbmZpZ1tpdGVtWzBdLnRyaW0oKV0gPSBpdGVtWzFdLnRyaW0oKSA9PT0gJ3RydWUnO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb25maWc7XG4gICAgfSkoKTtcblxuICAgICRzY29wZS5yZXN1bHQgPSB7XG4gICAgICAgIHVuaW9uOiAnJyxcbiAgICAgICAgc3RhdHVzOiAnUkVKVCcsXG4gICAgICAgIGVzaWduOiBudWxsXG4gICAgfTtcblxuICAgICRzY29wZS5hcHBsaWNhdGlvbiA9IHNhdmluZ3NBcHBsaWNhdGlvblNlcnZpY2UuYXR0YWNoU2NvcGUoJHNjb3BlKTtcbiAgICAkc2NvcGUuc2F2aW5nc0FwaS5zeW5jTWV0YSgkc2NvcGUubWV0YSwgbWV0YUNvbmZpZyk7XG5cbiAgICAkd2luZG93Lm9uY2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmKGUudGFyZ2V0LmNsYXNzTmFtZS5zcGxpdChcIiBcIikuaW5kZXhPZihcImNsaWNrb3V0c2lkZVwiKSA8IDApXG4gICAgICAgIHtcbiAgICAgICAgICAgICRzY29wZS5wYXJlbnRPYmouYnVzaW5lc3NjaG9pY2VTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLnBhcmVudE9iai5vY2N1cGF0aW9uY2hvaWNlU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICRzY29wZS5wYXJlbnRPYmouZW1wbG95ZXJjaG9pY2VTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLnBhcmVudE9iai5hc3NvY2lhdGlvbmNob2ljZVNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkc2NvcGUubG9hbnNBcGkuZmV0Y2hCdXNpbmVzc0xpc3QoZnVuY3Rpb24gKGRhdGEpe1xuICAgICAgICAkc2NvcGUuYnVzaW5lc3NMaXN0ID0gZGF0YTtcbiAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIFVJa2l0Lm5vdGlmaWNhdGlvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiBlcnIsXG4gICAgICAgICAgICBzdGF0dXM6ICdkYW5nZXInLFxuICAgICAgICAgICAgcG9zOiAnYm90dG9tLXJpZ2h0J1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgICRzY29wZS5sb2Fuc0FwaS5mZXRjaE9jY3VwYXRpb25MaXN0KGZ1bmN0aW9uIChkYXRhKXtcbiAgICAgICAgJHNjb3BlLm9jY3VwYXRpb25MaXN0ID0gZGF0YTtcbiAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIFVJa2l0Lm5vdGlmaWNhdGlvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiBlcnIsXG4gICAgICAgICAgICBzdGF0dXM6ICdkYW5nZXInLFxuICAgICAgICAgICAgcG9zOiAnYm90dG9tLXJpZ2h0J1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgICRzY29wZS5sb2Fuc0FwaS5mZXRjaEFzc29jaWF0aW9uTGlzdChmdW5jdGlvbiAoZGF0YSl7XG4gICAgICAkc2NvcGUuYXNzb2NpYXRpb25MaXN0ID0gW107XG4gICAgICBmb3IodmFyIGkgaW4gZGF0YSkgIHtcbiAgICAgICAgJHNjb3BlLmFzc29jaWF0aW9uTGlzdC5wdXNoKGRhdGFbaV0pO1xuICAgICAgfVxuICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgVUlraXQubm90aWZpY2F0aW9uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycixcbiAgICAgICAgICAgIHN0YXR1czogJ2RhbmdlcicsXG4gICAgICAgICAgICBwb3M6ICdib3R0b20tcmlnaHQnXG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLmxvYW5zQXBpLmZldGNoRW1wbG95ZXJMaXN0KGZ1bmN0aW9uIChkYXRhKXsgIFxuICAgICAgICAkc2NvcGUuZW1wbG95ZXJMaXN0ID0gZGF0YTsgICBcbiAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIFVJa2l0Lm5vdGlmaWNhdGlvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiBlcnIsXG4gICAgICAgICAgICBzdGF0dXM6ICdkYW5nZXInLFxuICAgICAgICAgICAgcG9zOiAnYm90dG9tLXJpZ2h0J1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgICRzY29wZS5wYXJlbnRPYmogPSB7fTtcbiAgICAkc2NvcGUucGFyZW50T2JqLmJ1c2luZXNzY2hvaWNlU2VsZWN0ZWQ9IHRydWU7XG4gICAgJHNjb3BlLnNldEJ1c2luZXNzID0gZnVuY3Rpb24odmFsKXtcbiAgICAgIGNvbnNvbGUuaW5mbyh2YWwpO1xuICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0ucGVyc29uYWwuZW1wbG95bWVudFNlY3RvciA9IHZhbDtcbiAgICAgICRzY29wZS5wYXJlbnRPYmouYnVzaW5lc3NjaG9pY2VTZWxlY3RlZD0gZmFsc2U7XG4gICAgfVxuICBcbiAgICAkc2NvcGUucGFyZW50T2JqLm9jY3VwYXRpb25jaG9pY2VTZWxlY3RlZD0gdHJ1ZTtcbiAgICAkc2NvcGUuc2V0T2NjdXBhdGlvbiA9IGZ1bmN0aW9uKHZhbCl7XG4gICAgICBjb25zb2xlLmluZm8odmFsKTtcbiAgICAgICRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnBlcnNvbmFsLmVtcGxveW1lbnRQb3NpdGlvbiA9IHZhbDtcbiAgICAgICRzY29wZS5wYXJlbnRPYmoub2NjdXBhdGlvbmNob2ljZVNlbGVjdGVkPSBmYWxzZTtcbiAgICB9XG5cbiAgICAkc2NvcGUucGFyZW50T2JqLmFzc29jaWF0aW9uY2hvaWNlU2VsZWN0ZWQ9IGZhbHNlO1xuICAgICRzY29wZS5zZXRBc3NvY2lhdGlvbiA9IGZ1bmN0aW9uKHZhbCl7XG4gICAgICBjb25zb2xlLmluZm8odmFsKTtcbiAgICAgICRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnBlcnNvbmFsLmFzc29jaWF0aW9uID0gdmFsO1xuICAgICAgJHNjb3BlLnBhcmVudE9iai5hc3NvY2lhdGlvbmNob2ljZVNlbGVjdGVkPSBmYWxzZTtcbiAgICB9XG5cbiAgICAkc2NvcGUucGFyZW50T2JqLmVtcGxveWVyY2hvaWNlU2VsZWN0ZWQ9IHRydWU7XG4gICAgJHNjb3BlLnNldEVtcGxveWVyTmFtZSA9IGZ1bmN0aW9uKHZhbCl7XG4gICAgICBjb25zb2xlLmluZm8odmFsKTtcbiAgICAgICRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnBlcnNvbmFsLmVtcGxveWVyID0gdmFsO1xuICAgICAgJHNjb3BlLnBhcmVudE9iai5lbXBsb3llcmNob2ljZVNlbGVjdGVkPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGxvYWQgZG9jdW1lbnRcbiAgICAgKi9cbiAgICAkc2NvcGUudXBsb2FkRmlsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJHNjb3BlLnByb2Nlc3NEcm9wem9uZSgpO1xuICAgIH07XG5cbiAgICAkc2NvcGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRzY29wZS5yZXNldERyb3B6b25lKCk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGxvYWRBcHBsaWNhdGlvbiAoKSB7XG4gICAgICAgIGlmICgkc2NvcGUuYXBwbGljYXRpb24uZ2V0SWQoKSkge1xuICAgICAgICAgICAgY29udGludWVBcHBsaWNhdGlvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RhcnRBcHBsaWNhdGlvbigpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGNvbnRpbnVlQXBwbGljYXRpb24gKCkge1xuXG4gICAgICAgIGxldCBhcHBEYXRhID0ge1xuICAgICAgICAgICAgc2F2aW5nc1Byb2R1Y3RJZDogYW5ndWxhci5lbGVtZW50KCdbZGF0YS1wcm9kdWN0XScpLmRhdGEoJ3Byb2R1Y3QnKSxcbiAgICAgICAgICAgIGN1SWQ6IGFuZ3VsYXIuZWxlbWVudCgnW2RhdGEtY3VpZF0nKS5kYXRhKCdjdWlkJyksXG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLnNldFByb2R1Y3RJZChhcHBEYXRhLnNhdmluZ3NQcm9kdWN0SWQpLnNldEN1SWQoYXBwRGF0YS5jdUlkKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gc3RhcnRBcHBsaWNhdGlvbiAoKSB7XG5cbiAgICAgICAgbGV0IGFwcERhdGEgPSB7XG4gICAgICAgICAgICBzYXZpbmdzUHJvZHVjdElkOiBhbmd1bGFyLmVsZW1lbnQoJ1tkYXRhLXByb2R1Y3RdJykuZGF0YSgncHJvZHVjdCcpLFxuICAgICAgICAgICAgY3VJZDogYW5ndWxhci5lbGVtZW50KCdbZGF0YS1jdWlkXScpLmRhdGEoJ2N1aWQnKSxcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuc2F2aW5nc0FwaS5zdGFydEFwcGxpY2F0aW9uKGFwcERhdGEsIGZ1bmN0aW9uIChkYXRhKSB7XG5cbiAgICAgICAgICAgICRzY29wZS5hcHBsaWNhdGlvblxuICAgICAgICAgICAgICAgIC5zZXRJZChkYXRhLlNhdmluZ3NBcHBsaWNhdGlvbklEKVxuICAgICAgICAgICAgICAgIC5zZXRQcm9kdWN0SWQoYXBwRGF0YS5zYXZpbmdzUHJvZHVjdElkKVxuICAgICAgICAgICAgICAgIC5zZXRDdUlkKGFwcERhdGEuY3VJZCk7XG5cbiAgICAgICAgICAgICAgICB3aW5kb3cuc2F2ZUJhY2t1cCgpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBzYXZlQXBwbGljYXRpb25JbmZvcm1hdGlvbiAoKSB7XG5cbiAgICAgICAgbGV0IGNvbnN0cnVjdGVkQXBwbGljYXRpb25EYXRhID0gJHNjb3BlLmFwcGxpY2F0aW9uLnByZXBhcmVGb3JBcGkoKTtcblxuICAgICAgICAkc2NvcGUuc2F2aW5nc0FwaS5zeW5jQXBwbGljYXRpb24oY29uc3RydWN0ZWRBcHBsaWNhdGlvbkRhdGEsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLyogV2UncmUgbm93IHJlYWR5IHRvIHN0YXJ0IGRvaW5nIHN0dWZmIHdpdGggdGhlIGZvcm0gKi9cblxuICAgICRzY29wZS5pc0FjdGl2ZVN0ZXAgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgICByZXR1cm4gJHNjb3BlLnN0ZXAgPT0gc3RlcDtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNldEFjdGl2ZVN0ZXAgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgICAkc2NvcGUuc3RlcCA9IHN0ZXA7XG5cbiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbGV0IGVsID0galF1ZXJ5KCcuYXBwbGljYXRpb24tc2VjdGlvbiwgLnByb2Nlc3Npbmctc3RlcCcpO1xuXG4gICAgICAgICAgICBpZiAoZWwubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0ID0gZWwuZXEoMCkucG9zaXRpb24oKS50b3AgLSAxNTtcblxuICAgICAgICAgICAgICAgIGpRdWVyeSgnaHRtbCwgYm9keScpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IG9mZnNldFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAxNTApO1xuXG4gICAgICAgIHJldHVybiAkc2NvcGUuc3RlcDtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnN1Ym1pdEFwcGxpY2F0aW9uID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIGxldCB2YWxpZGF0aW9uID0gc2F2aW5nc0FwcGxpY2F0aW9uU2VydmljZS52YWxpZGF0b3IuZ28oKTtcbiAgICAgICAgJHNjb3BlLmdsb2JhbEVycm9yTWVzc2FnZSA9IG51bGw7XG4gICAgICAgIGlmICh2YWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdwcm9jZXNzaW5nJyk7XG5cbiAgICAgICAgICAgICRzY29wZS5zYXZpbmdzQXBpLnN1Ym1pdEFwcGxpY2F0aW9uKCRzY29wZS5hcHBsaWNhdGlvbiwgZnVuY3Rpb24gKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgICAgIHVuaW9uOiBkYXRhLmFsbG9jYXRlZENVLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IGRhdGEuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBlc2lnbjogbnVsbFxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnJlc3VsdC5zdGF0dXMgPT09ICdBUFBSJyB8fCAkc2NvcGUucmVzdWx0LnN0YXR1cyA9PT0gJ0FSU1QnKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdhY2NlcHRlZCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLnJlc3VsdC5zdGF0dXMgPT09ICdDQVBSJykge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0QWN0aXZlU3RlcCgnY29uZGl0aW9uYWxseWFwcHJvdmVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNldEFjdGl2ZVN0ZXAoJ3JlamVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICRzY29wZS5nbG9iYWxFcnJvck1lc3NhZ2UgPSBlcnI7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNldEFjdGl2ZVN0ZXAoJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLnN1Ym1pdEVtYWlsID0gZnVuY3Rpb24oKXtcbiAgICAgICAgJHNjb3BlLnNldEFjdGl2ZVN0ZXAoJ3Byb2Nlc3NpbmcnKTtcbiAgICAgICAgXG4gICAgICAgICAgICAkc2NvcGUuc2F2aW5nc0FwaS5zdWJtaXRFbWFpbCgkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5wZXJzb25hbC5lbWFpbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmdsb2JhbEVycm9yTWVzc2FnZSA9IGVycjtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2V0QWN0aXZlU3RlcCgnZXJyb3InKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmdvVG9BZ3JlZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdnZW5lcmF0aW5nYWdyZWVtZW50Jyk7XG4gICAgICAgICRzY29wZS5nbG9iYWxFcnJvck1lc3NhZ2UgPSBudWxsO1xuXG4gICAgICAgICRzY29wZS5zYXZpbmdzQXBpLmdlbmVyYXRlQWdyZWVtZW50KCRzY29wZS5hcHBsaWNhdGlvbiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEuZXNpZ25VcmwpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0LmVzaWduID0gJHNjb3BlLnNhdmluZ3NBcGkuZ2V0U2FmZUVzaWduVXJsKGRhdGEuZXNpZ25VcmwpO1xuICAgICAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdzaWduJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdzaWduJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICRzY29wZS5nbG9iYWxFcnJvck1lc3NhZ2UgPSBlcnI7XG4gICAgICAgICAgICAkc2NvcGUuc2V0QWN0aXZlU3RlcCgnZXJyb3InKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5jb25maXJtU2lnbmF0dXJlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBVSWtpdC5tb2RhbC5jb25maXJtKGBcbiAgICAgICAgICAgIDxoMz5XYXJuaW5nISBCZWZvcmUgeW91IGNvbnRpbnVlPC9oMz5cbiAgICAgICAgICAgIDxwPlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGNsaWNrZWQgdGhlIGJsdWUgJ0NsaWNrIHRvIFNpZ24nIGJ1dHRvbiBvbiB0aGUgcHJldmlvdXMgYWdyZWVtZW50IGRvY3VtZW50LjwvcD5cbiAgICAgICAgICAgIDxwPklmIHlvdSBjb250aW51ZSBub3cgd2l0aG91dCBjbGlja2luZyB0aGlzIGJ1dHRvbiwgeW91ciBhcHBsaWNhdGlvbiB3aWxsIG5vdCBiZSBjb21wbGV0ZSBhbmQgeW91IHdpbGwgbmVlZCB0byBzdGFydCBhZ2Fpbi48L3A+YCwge1xuICAgICAgICAgICAgbGFiZWxzOiB7XG4gICAgICAgICAgICAgICAgY2FuY2VsOiAnQmFjayB0byBhZ3JlZW1lbnQnLFxuICAgICAgICAgICAgICAgIG9rOiBcIkNvbnRpbnVlXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHdpbmRvdy5wcnVuZUJhY2t1cCgpO1xuICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNldEFjdGl2ZVN0ZXAoJ2NvbmZpcm1hdGlvbicpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUubG9va3VwQWRkcmVzcyA9IGZ1bmN0aW9uIChhZGRyZXNzKSB7XG4gICAgICAgIGFkZHJlc3MuY2FudF9maW5kID0gZmFsc2U7XG5cbiAgICAgICAgJHNjb3BlLnNhdmluZ3NBcGkubG9va3VwUG9zdGNvZGUoYWRkcmVzcy5wb3N0Y29kZSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGFkZHJlc3MuY2l0eSA9IGRhdGEuZ2VuZXJpYy5jaXR5O1xuICAgICAgICAgICAgYWRkcmVzcy5zdHJlZXQgPSBkYXRhLmdlbmVyaWMuc3RyZWV0O1xuICAgICAgICAgICAgYWRkcmVzcy5wb3N0Y29kZSA9IGRhdGEuZ2VuZXJpYy5wb3N0Y29kZTtcbiAgICAgICAgICAgIGFkZHJlc3Muc3VnZ2VzdGlvbnMgPSBkYXRhLnN1Z2dlc3Rpb25zO1xuXG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnVwZGF0ZUFwcGxpY2F0aW9uKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGFkZHJlc3MuY2FudF9maW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIFVJa2l0Lm5vdGlmaWNhdGlvbih7XG4gICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyLFxuICAgICAgICAgICAgICAgIHN0YXR1czogJ2RhbmdlcicsXG4gICAgICAgICAgICAgICAgcG9zOiAnYm90dG9tLXJpZ2h0J1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuYWRkcmVzc1RocmVlWWVhclRvZ2dsZSA9IGZ1bmN0aW9uIChhZGRyZXNzKSB7XG4gICAgICAgIGlmIChhZGRyZXNzLmxlc3NfdGhhbl90aHJlZV95ZWFycykge1xuICAgICAgICAgICAgJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0uYWRkcmVzc2VzLnB1c2goc2F2aW5nc0FwcGxpY2F0aW9uU2VydmljZS5nZXROZXdBZGRyZXNzKCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gJHNjb3BlLmFwcGxpY2F0aW9uLmZvcm0uYWRkcmVzc2VzLmluZGV4T2YoYWRkcmVzcyk7XG4gICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS5hZGRyZXNzZXMuc3BsaWNlKGluZGV4ICsgMSwgMSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLnVwZGF0ZUFwcGxpY2F0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBzYXZlQXBwbGljYXRpb25JbmZvcm1hdGlvbigpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuY29udGVudFllcz0gJ25vJztcbiAgICAkc2NvcGUuY2hhbmdlRW1wbG95ZXJTdGF1cyA9IGZ1bmN0aW9uICgpe1xuICAgICAgICB2YXIgYWxsb3dlZEVtcCA9IFsnZW0nLCdzZScsJ2NlJywndGUnLCdvdCddO1xuICAgICAgICAgICAgaWYoYWxsb3dlZEVtcC5pbmRleE9mKCRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnBlcnNvbmFsLmVtcGxveW1lbnRTdGF0dXMpPi0xKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29udGVudFllcz0gJ3llcyc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRzY29wZS5jb250ZW50WWVzPSAnbm8nO1xuICAgICAgICAgICAgfVxuICAgIH1cbiAgICAkc2NvcGUuY2hlY2tNYW5kYXRvcnkgPSBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgbm90YWxsb3dlZEVtcCA9IFsnc3QnLCdyZScsJ2htJywndW4nXTtcbiAgICAgICAgaWYobm90YWxsb3dlZEVtcC5pbmRleE9mKCRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnBlcnNvbmFsLmVtcGxveW1lbnRTdGF0dXMpPi0xKXtcbiAgICAgICAgICAgIGlmKCRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnBlcnNvbmFsLnJlbGF0aXZlaW5teWNiID09ICdubycpe1xuICAgICAgICAgICAgICAgIHJldHVybiAncmVxdWlyZWQnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkc2NvcGUuY2hlY2tSZXF1aXJlZCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmKCRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnBlcnNvbmFsLnJlbGF0aXZlaW5teWNiID09ICdubycpe1xuICAgICAgICAgICAgcmV0dXJuICdyZXF1aXJlZCc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgICRzY29wZS5zaG93RGVidWdJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IGluZm9ybWF0aW9uID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FwcGxpY2F0aW9uRm9ybURhdGEnKSB8fCBudWxsO1xuICAgICAgICBVSWtpdC5tb2RhbC5hbGVydChgXG4gICAgICAgICAgICA8dGV4dGFyZWEgc3R5bGU9XCJ3aWR0aDogMTAwJTsgaGVpZ2h0OiA1MHB4OyBiYWNrZ3JvdW5kOiBibGFjazsgY29sb3I6IHdoaXRlO1wiPiR7IGluZm9ybWF0aW9uIH08L3RleHRhcmVhPlxuICAgICAgICAgICAgPHA+UGxlYXNlIGNvcHkvcGFzdGUgYWxsIHRoZSB0ZXh0IGZyb20gYWJvdmUuPC9wPlxuICAgICAgICBgKTtcbiAgICB9O1xuXG4gICAgbG9hZEFwcGxpY2F0aW9uKCk7XG5cbiAgICAkc2NvcGUuY29uZmlybURldGFpbHMgPSBmdW5jdGlvbigpe1xuICAgICAgICAkc2NvcGUuc2V0QWN0aXZlU3RlcCgncHJvY2Vzc2luZycpO1xuICAgICAgICAgICAgbGV0IHdlYnVybCA9ICRsb2NhdGlvbi5hYnNVcmwoKTsgXG4gICAgICAgICAgICAkc2NvcGUuYXBwbGljYXRpb24uZm9ybS52ZXJpZnkudXJsID0gd2VidXJsO1xuICAgICAgICAgICAgJHNjb3BlLmxvYW5zQXBpLmNvbmZpcm1EZXRhaWxzVXBsb2FkKCRzY29wZS5hcHBsaWNhdGlvbi5mb3JtLnZlcmlmeSwgXG4gICAgICAgICAgICBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5zYXZpbmdzQXBpLnNldEF1dGhUb2tlblVwbG9hZChkYXRhLmF1dGhUb2tlbik7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNhdmluZ3NBcGkuc2V0QXBwbGljYXRpb25JRChkYXRhLmxvYW5JZCk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgZnVsbE5hbWU6IGRhdGEuZnVsbE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGFtb3VudDogZGF0YS5hbW91bnQsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2V0QWN0aXZlU3RlcCgnbG9hbkRldGFpbHMnKTtcbiAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZUNvbmZ1c2VkID0gZXJyO1xuICAgICAgICAgICAgICAgICRzY29wZS5zZXRBY3RpdmVTdGVwKCdtaXNtYXRjaERldGFpbCcpO1xuICAgICAgICAgICAgfSk7XG4gICAgfTtcblxufV0pLmZpbHRlcignaGlnaGxpZ2h0JyxbJyRzY2UnLCBmdW5jdGlvbiAoJHNjZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoaW5wdXQsIHF1ZXJ5KSB7XG4gICAgICBpZiAocXVlcnkgPT09ICcnIHx8IHF1ZXJ5ID09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgIH0gZWxzZSBpZiAocXVlcnkubGVuZ3RoIDwgMSkge1xuICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgfVxuICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWwoaW5wdXQudG9VcHBlckNhc2UoKS5yZXBsYWNlKFJlZ0V4cCgnKCcrIHF1ZXJ5LnRvVXBwZXJDYXNlKCkgKyAnKScsICdnJyksICc8YiBjbGFzcz1cImhpZ2hfbGlnaHRcIj4kMTwvYj4nKSk7XG4gICAgfVxuICB9XSlcbi5maWx0ZXIoJ2hpZ2hsaWdodDInLFsnJHNjZScsIGZ1bmN0aW9uICgkc2NlKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCwgcXVlcnkpIHtcbiAgICAgIGlmIChxdWVyeSA9PT0gJycgfHwgcXVlcnkgPT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKGlucHV0KTtcbiAgICAgIH0gZWxzZSBpZiAocXVlcnkubGVuZ3RoIDwgMSkge1xuICAgICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKGlucHV0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKGlucHV0LnRvVXBwZXJDYXNlKCkucmVwbGFjZShSZWdFeHAoJygnKyBxdWVyeS50b1VwcGVyQ2FzZSgpICsgJyknLCAnZycpLCAnPGIgY2xhc3M9XCJoaWdoX2xpZ2h0XCI+JDE8L2I+JykpO1xuICAgIH1cbiAgfV0pXG4gIC5kaXJlY3RpdmUoJ2Ryb3B6b25lJywgWydjdVNhdmluZ3NBcGlGYWN0b3J5JywgZnVuY3Rpb24gKGN1U2F2aW5nc0FwaUZhY3RvcnkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0MnLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG5cbiAgICAgICAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9maWxlLWFwcGxpY2F0aW9uY3Vsb2Fucy5jdWxvYW5zLmNvLnVrL2N1cGxhdGZvcm1maWxlcy9sb2FuYXBwbGljYXRpb25zL3NhdmVhcHBsaWNhbnRkb2N1bWVudHMvJytjdVNhdmluZ3NBcGlGYWN0b3J5LmdldEFwcGxpY2F0aW9uSUQoKSxcbiAgICAgICAgICAgICAgICBtYXhGaWxlc2l6ZTogMTUsXG4gICAgICAgICAgICAgICAgcGFyYW1OYW1lOiBcImZpbGVcIixcbiAgICAgICAgICAgICAgICBtYXhUaHVtYm5haWxGaWxlc2l6ZTogMyxcbiAgICAgICAgICAgICAgICBwYXJhbGxlbFVwbG9hZHM6IDEsXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRGaWxlczogXCIuanBlZywuanBnLC5wbmcsLmdpZiwuYm1wLC5wZGYsLnhscywueGxzeCwuZG9jLC5kb2N4LC5tc2dcIixcbiAgICAgICAgICAgICAgICBhdXRvUHJvY2Vzc1F1ZXVlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ1gtQVBJLUtFWSc6ICc4YWI3YzU5YjU4NDM2NTM0MDE1ODQzNjU2MjVhMDAwMCcsXG4gICAgICAgICAgICAgICAgICAgICdYLUF1dGgtVG9rZW4nOiBjdVNhdmluZ3NBcGlGYWN0b3J5LmdldEF1dGhUb2tlblVwbG9hZCgpLFxuICAgICAgICAgICAgICAgICAgICBcIkNhY2hlLUNvbnRyb2xcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJYLVJlcXVlc3RlZC1XaXRoXCIgOiBcIlwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgXG5cbiAgICAgICAgICAgIHZhciBkcm9wem9uZSA9IG5ldyBEcm9wem9uZShlbGVtZW50WzBdLCBjb25maWcpO1xuXG4gICAgICAgICAgICBkcm9wem9uZS5vbihcImFkZGVkZmlsZVwiLCBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgICAgICAgZHJvcHpvbmUub3B0aW9ucy51cmwgID0gJ2h0dHBzOi8vZmlsZS1hcHBsaWNhdGlvbmN1bG9hbnMuY3Vsb2Fucy5jby51ay9jdXBsYXRmb3JtZmlsZXMvbG9hbmFwcGxpY2F0aW9ucy9zYXZlYXBwbGljYW50ZG9jdW1lbnRzLycrY3VTYXZpbmdzQXBpRmFjdG9yeS5nZXRBcHBsaWNhdGlvbklEKCk7XG4gICAgICAgICAgICAgICAgZHJvcHpvbmUub3B0aW9ucy5oZWFkZXJzID0gIHtcbiAgICAgICAgICAgICAgICAgICAgJ1gtQVBJLUtFWSc6ICc4YWI3YzU5YjU4NDM2NTM0MDE1ODQzNjU2MjVhMDAwMCcsXG4gICAgICAgICAgICAgICAgICAgICdYLUF1dGgtVG9rZW4nOiBjdVNhdmluZ3NBcGlGYWN0b3J5LmdldEF1dGhUb2tlblVwbG9hZCgpLFxuICAgICAgICAgICAgICAgICAgICBcIkNhY2hlLUNvbnRyb2xcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJYLVJlcXVlc3RlZC1XaXRoXCIgOiBcIlwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNjb3BlLnByb2Nlc3NEcm9wem9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBkcm9wem9uZS5vcHRpb25zLmF1dG9Qcm9jZXNzUXVldWU9dHJ1ZTtcbiAgICAgICAgICAgICAgICBkcm9wem9uZS5wcm9jZXNzUXVldWUoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLnJlc2V0RHJvcHpvbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZHJvcHpvbmUucmVtb3ZlQWxsRmlsZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1dKVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHRoZW1lLWFzc2V0cy9qcy9fYXBwbGljYXRpb25zL19zYXZpbmdzLWNvbnRyb2xsZXIuanMiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");
},function(module,exports){eval("myCommunityBank.factory('cuSavingsApiFactory', ['baseApiFactory', '$http', '$sce', function(baseApiFactory, $http, $sce){\n\n    var self = this;\n    var apiKey = baseApiFactory.apiKey;\n\n    var ihub = baseApiFactory.ihub;\n    var culoans = baseApiFactory.culoans;\n\n    self.aggrUrl = baseApiFactory.aggrUrl;\n    self.aggrCode = baseApiFactory.aggrCode;\n    self.brandid = baseApiFactory.brandid;\n\n    self.enableSandbox = baseApiFactory.enableSandbox;\n    self.disableSandbox = baseApiFactory.disableSandbox;\n\n    self.getSafeEsignUrl = baseApiFactory.getSafeEsignUrl;\n    self.getApiRequestUrl = baseApiFactory.getApiRequestUrl;\n    self.getApiRequestHeaders = baseApiFactory.getApiRequestHeaders;\n\n    self.lookupPostcode = baseApiFactory.lookupPostcode;\n    self.formatPostCodeResponse = baseApiFactory.formatPostCodeResponse;\n\n    self.syncMeta = baseApiFactory.syncMeta;\n    self.getSalutations = baseApiFactory.getSalutations;\n    self.getNationalities = baseApiFactory.getNationalities;\n    self.getSecurityQuestions = baseApiFactory.getSecurityQuestions;\n\n    self.startApplication = function (appData, success, fail) {\n        return baseApiFactory.postApi('savingsapplications', {\n            aggregator: self.aggrCode,\n            aggr_url: self.aggrUrl,\n            brandid: self.brandid,            \n            savingsProductId: appData.savingsProductId,\n            cuId: appData.cuId,\n            state: 'IN_PROGRESS'\n        }, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n    self.syncApplication = function(appData, success, fail) {\n\n        appData.aggrUrl = self.aggrUrl;\n        appData.aggrCode = self.aggrCode;\n        appData.aggregator = self.aggrCode;\n         appData.brandid = self.brandid;\n\n        return baseApiFactory.putApi('savingsapplications', appData, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n    self.employerList = null;\n    \n        self.getemployerList = function () {\n            return self.employerList;\n        };\n    self.occupationList = null;\n    \n    self.getoccupationList = function () {\n            return self.occupationList;\n        };\n    \n    self.businessList = null;\n    \n    self.getbusinessList = function () {\n            return self.businessList;\n        };\n    \n    self.associationList = null;\n    \n    self.getassociationList = function () {\n            return self.associationList;\n        };\n\n    self.submitApplication = function(app, success, fail) {\n\n        var appData = app.prepareForApi();\n        appData.state = 'SUBMITTED';\n        appData.aggrUrl = self.aggrUrl;\n        appData.aggrCode = self.aggrCode;\n        appData.aggregator = self.aggrCode;\n        appData.brandid = self.brandid;\n\n        return baseApiFactory.putApi('savingsapplications', appData, function (data) {\n\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n self.submitEmail = function(app, success, fail) {\n        var email = app;\n        return baseApiFactory.postApiFiles('savingsapplications/sendemails', {'email':email}, function (data) {\n\n            if (success) {\n                alert(\"Your mail id send successfully\");\n                return success(data);\n                \n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n\n\n    self.acceptApplication = function(){\n        var appData = {\n            \"state\": \"ACCEPTED\",\n            \"amount\": $scope.loan.loanAmount,\n            \"term\": $scope.loan.term,\n            \"loanApplicationId\": $scope.loan.loanApplicationId\n        }\n\n        return baseApiFactory.putApi('savingsapplications', appData, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    }\n\n    self.generateAgreement = function (app, success, fail) {\n\n        var appData = {\n            cuId: app.getCuId(),\n            state: 'GEN_AGREEMENT',\n            savingsApplicationId: app.getId()\n        };\n\n        return baseApiFactory.putApi('savingsapplications', appData, function (data) {\n            if (success) {\n                return success(data);\n            }\n        }, function (err) {\n            if (fail) {\n                return fail(err);\n            }\n        });\n    };\n    self.authTokenUpload = null;\n    self.setAuthTokenUpload =  function(token) {\n        self.authTokenUpload = token;\n    }\n    \n    self.getAuthTokenUpload =  function() {\n        return self.authTokenUpload;\n    }\n    \n    self.applicationID = null;\n    \n    self.setApplicationID =  function(token) {\n        self.applicationID = token;\n    }\n    \n    self.getApplicationID =  function() {\n        return self.applicationID;\n    }\n\n    return self;\n}]);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy90aGVtZS1hc3NldHMvanMvX2FwcGxpY2F0aW9ucy9fc2F2aW5ncy1mYWN0b3J5LmpzPzdhYmMiXSwic291cmNlc0NvbnRlbnQiOlsibXlDb21tdW5pdHlCYW5rLmZhY3RvcnkoJ2N1U2F2aW5nc0FwaUZhY3RvcnknLCBbJ2Jhc2VBcGlGYWN0b3J5JywgJyRodHRwJywgJyRzY2UnLCBmdW5jdGlvbihiYXNlQXBpRmFjdG9yeSwgJGh0dHAsICRzY2Upe1xuXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgY29uc3QgYXBpS2V5ID0gYmFzZUFwaUZhY3RvcnkuYXBpS2V5O1xuXG4gICAgY29uc3QgaWh1YiA9IGJhc2VBcGlGYWN0b3J5LmlodWI7XG4gICAgY29uc3QgY3Vsb2FucyA9IGJhc2VBcGlGYWN0b3J5LmN1bG9hbnM7XG5cbiAgICBzZWxmLmFnZ3JVcmwgPSBiYXNlQXBpRmFjdG9yeS5hZ2dyVXJsO1xuICAgIHNlbGYuYWdnckNvZGUgPSBiYXNlQXBpRmFjdG9yeS5hZ2dyQ29kZTtcbiAgICBzZWxmLmJyYW5kaWQgPSBiYXNlQXBpRmFjdG9yeS5icmFuZGlkO1xuXG4gICAgc2VsZi5lbmFibGVTYW5kYm94ID0gYmFzZUFwaUZhY3RvcnkuZW5hYmxlU2FuZGJveDtcbiAgICBzZWxmLmRpc2FibGVTYW5kYm94ID0gYmFzZUFwaUZhY3RvcnkuZGlzYWJsZVNhbmRib3g7XG5cbiAgICBzZWxmLmdldFNhZmVFc2lnblVybCA9IGJhc2VBcGlGYWN0b3J5LmdldFNhZmVFc2lnblVybDtcbiAgICBzZWxmLmdldEFwaVJlcXVlc3RVcmwgPSBiYXNlQXBpRmFjdG9yeS5nZXRBcGlSZXF1ZXN0VXJsO1xuICAgIHNlbGYuZ2V0QXBpUmVxdWVzdEhlYWRlcnMgPSBiYXNlQXBpRmFjdG9yeS5nZXRBcGlSZXF1ZXN0SGVhZGVycztcblxuICAgIHNlbGYubG9va3VwUG9zdGNvZGUgPSBiYXNlQXBpRmFjdG9yeS5sb29rdXBQb3N0Y29kZTtcbiAgICBzZWxmLmZvcm1hdFBvc3RDb2RlUmVzcG9uc2UgPSBiYXNlQXBpRmFjdG9yeS5mb3JtYXRQb3N0Q29kZVJlc3BvbnNlO1xuXG4gICAgc2VsZi5zeW5jTWV0YSA9IGJhc2VBcGlGYWN0b3J5LnN5bmNNZXRhO1xuICAgIHNlbGYuZ2V0U2FsdXRhdGlvbnMgPSBiYXNlQXBpRmFjdG9yeS5nZXRTYWx1dGF0aW9ucztcbiAgICBzZWxmLmdldE5hdGlvbmFsaXRpZXMgPSBiYXNlQXBpRmFjdG9yeS5nZXROYXRpb25hbGl0aWVzO1xuICAgIHNlbGYuZ2V0U2VjdXJpdHlRdWVzdGlvbnMgPSBiYXNlQXBpRmFjdG9yeS5nZXRTZWN1cml0eVF1ZXN0aW9ucztcblxuICAgIHNlbGYuc3RhcnRBcHBsaWNhdGlvbiA9IGZ1bmN0aW9uIChhcHBEYXRhLCBzdWNjZXNzLCBmYWlsKSB7XG4gICAgICAgIHJldHVybiBiYXNlQXBpRmFjdG9yeS5wb3N0QXBpKCdzYXZpbmdzYXBwbGljYXRpb25zJywge1xuICAgICAgICAgICAgYWdncmVnYXRvcjogc2VsZi5hZ2dyQ29kZSxcbiAgICAgICAgICAgIGFnZ3JfdXJsOiBzZWxmLmFnZ3JVcmwsXG4gICAgICAgICAgICBicmFuZGlkOiBzZWxmLmJyYW5kaWQsICAgICAgICAgICAgXG4gICAgICAgICAgICBzYXZpbmdzUHJvZHVjdElkOiBhcHBEYXRhLnNhdmluZ3NQcm9kdWN0SWQsXG4gICAgICAgICAgICBjdUlkOiBhcHBEYXRhLmN1SWQsXG4gICAgICAgICAgICBzdGF0ZTogJ0lOX1BST0dSRVNTJ1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcyhkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgaWYgKGZhaWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgc2VsZi5zeW5jQXBwbGljYXRpb24gPSBmdW5jdGlvbihhcHBEYXRhLCBzdWNjZXNzLCBmYWlsKSB7XG5cbiAgICAgICAgYXBwRGF0YS5hZ2dyVXJsID0gc2VsZi5hZ2dyVXJsO1xuICAgICAgICBhcHBEYXRhLmFnZ3JDb2RlID0gc2VsZi5hZ2dyQ29kZTtcbiAgICAgICAgYXBwRGF0YS5hZ2dyZWdhdG9yID0gc2VsZi5hZ2dyQ29kZTtcbiAgICAgICAgIGFwcERhdGEuYnJhbmRpZCA9IHNlbGYuYnJhbmRpZDtcblxuICAgICAgICByZXR1cm4gYmFzZUFwaUZhY3RvcnkucHV0QXBpKCdzYXZpbmdzYXBwbGljYXRpb25zJywgYXBwRGF0YSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBzZWxmLmVtcGxveWVyTGlzdCA9IG51bGw7XG4gICAgXG4gICAgICAgIHNlbGYuZ2V0ZW1wbG95ZXJMaXN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHNlbGYuZW1wbG95ZXJMaXN0O1xuICAgICAgICB9O1xuICAgIHNlbGYub2NjdXBhdGlvbkxpc3QgPSBudWxsO1xuICAgIFxuICAgIHNlbGYuZ2V0b2NjdXBhdGlvbkxpc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5vY2N1cGF0aW9uTGlzdDtcbiAgICAgICAgfTtcbiAgICBcbiAgICBzZWxmLmJ1c2luZXNzTGlzdCA9IG51bGw7XG4gICAgXG4gICAgc2VsZi5nZXRidXNpbmVzc0xpc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5idXNpbmVzc0xpc3Q7XG4gICAgICAgIH07XG4gICAgXG4gICAgc2VsZi5hc3NvY2lhdGlvbkxpc3QgPSBudWxsO1xuICAgIFxuICAgIHNlbGYuZ2V0YXNzb2NpYXRpb25MaXN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHNlbGYuYXNzb2NpYXRpb25MaXN0O1xuICAgICAgICB9O1xuXG4gICAgc2VsZi5zdWJtaXRBcHBsaWNhdGlvbiA9IGZ1bmN0aW9uKGFwcCwgc3VjY2VzcywgZmFpbCkge1xuXG4gICAgICAgIGxldCBhcHBEYXRhID0gYXBwLnByZXBhcmVGb3JBcGkoKTtcbiAgICAgICAgYXBwRGF0YS5zdGF0ZSA9ICdTVUJNSVRURUQnO1xuICAgICAgICBhcHBEYXRhLmFnZ3JVcmwgPSBzZWxmLmFnZ3JVcmw7XG4gICAgICAgIGFwcERhdGEuYWdnckNvZGUgPSBzZWxmLmFnZ3JDb2RlO1xuICAgICAgICBhcHBEYXRhLmFnZ3JlZ2F0b3IgPSBzZWxmLmFnZ3JDb2RlO1xuICAgICAgICBhcHBEYXRhLmJyYW5kaWQgPSBzZWxmLmJyYW5kaWQ7XG5cbiAgICAgICAgcmV0dXJuIGJhc2VBcGlGYWN0b3J5LnB1dEFwaSgnc2F2aW5nc2FwcGxpY2F0aW9ucycsIGFwcERhdGEsIGZ1bmN0aW9uIChkYXRhKSB7XG5cbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuIHNlbGYuc3VibWl0RW1haWwgPSBmdW5jdGlvbihhcHAsIHN1Y2Nlc3MsIGZhaWwpIHtcbiAgICAgICAgdmFyIGVtYWlsID0gYXBwO1xuICAgICAgICByZXR1cm4gYmFzZUFwaUZhY3RvcnkucG9zdEFwaUZpbGVzKCdzYXZpbmdzYXBwbGljYXRpb25zL3NlbmRlbWFpbHMnLCB7J2VtYWlsJzplbWFpbH0sIGZ1bmN0aW9uIChkYXRhKSB7XG5cbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJZb3VyIG1haWwgaWQgc2VuZCBzdWNjZXNzZnVsbHlcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuXG4gICAgc2VsZi5hY2NlcHRBcHBsaWNhdGlvbiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGxldCBhcHBEYXRhID0ge1xuICAgICAgICAgICAgXCJzdGF0ZVwiOiBcIkFDQ0VQVEVEXCIsXG4gICAgICAgICAgICBcImFtb3VudFwiOiAkc2NvcGUubG9hbi5sb2FuQW1vdW50LFxuICAgICAgICAgICAgXCJ0ZXJtXCI6ICRzY29wZS5sb2FuLnRlcm0sXG4gICAgICAgICAgICBcImxvYW5BcHBsaWNhdGlvbklkXCI6ICRzY29wZS5sb2FuLmxvYW5BcHBsaWNhdGlvbklkXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYmFzZUFwaUZhY3RvcnkucHV0QXBpKCdzYXZpbmdzYXBwbGljYXRpb25zJywgYXBwRGF0YSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChmYWlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2VsZi5nZW5lcmF0ZUFncmVlbWVudCA9IGZ1bmN0aW9uIChhcHAsIHN1Y2Nlc3MsIGZhaWwpIHtcblxuICAgICAgICBsZXQgYXBwRGF0YSA9IHtcbiAgICAgICAgICAgIGN1SWQ6IGFwcC5nZXRDdUlkKCksXG4gICAgICAgICAgICBzdGF0ZTogJ0dFTl9BR1JFRU1FTlQnLFxuICAgICAgICAgICAgc2F2aW5nc0FwcGxpY2F0aW9uSWQ6IGFwcC5nZXRJZCgpXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGJhc2VBcGlGYWN0b3J5LnB1dEFwaSgnc2F2aW5nc2FwcGxpY2F0aW9ucycsIGFwcERhdGEsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZXNzKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBpZiAoZmFpbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgc2VsZi5hdXRoVG9rZW5VcGxvYWQgPSBudWxsO1xuICAgIHNlbGYuc2V0QXV0aFRva2VuVXBsb2FkID0gIGZ1bmN0aW9uKHRva2VuKSB7XG4gICAgICAgIHNlbGYuYXV0aFRva2VuVXBsb2FkID0gdG9rZW47XG4gICAgfVxuICAgIFxuICAgIHNlbGYuZ2V0QXV0aFRva2VuVXBsb2FkID0gIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gc2VsZi5hdXRoVG9rZW5VcGxvYWQ7XG4gICAgfVxuICAgIFxuICAgIHNlbGYuYXBwbGljYXRpb25JRCA9IG51bGw7XG4gICAgXG4gICAgc2VsZi5zZXRBcHBsaWNhdGlvbklEID0gIGZ1bmN0aW9uKHRva2VuKSB7XG4gICAgICAgIHNlbGYuYXBwbGljYXRpb25JRCA9IHRva2VuO1xuICAgIH1cbiAgICBcbiAgICBzZWxmLmdldEFwcGxpY2F0aW9uSUQgPSAgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmFwcGxpY2F0aW9uSUQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlbGY7XG59XSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gdGhlbWUtYXNzZXRzL2pzL19hcHBsaWNhdGlvbnMvX3NhdmluZ3MtZmFjdG9yeS5qcyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=")},function(module,exports){eval('myCommunityBank.service(\'savingsApplicationService\', [\'baseApplicationService\', function (baseApplicationService) {\n\n    var self = this;\n    var $scope = {};\n\n    self.attachScope = function(_scope) {\n        _scope.meta = self.meta;\n        _scope.form = self.form;\n        _scope.product = self.product;\n        $scope = _scope;\n        return this;\n    };\n\n    self.getDOB = baseApplicationService.getDOB;\n    self.getCuId = baseApplicationService.getCuId;\n    self.setCuId = baseApplicationService.setCuId;\n    self.getState = baseApplicationService.getState;\n    self.getNewAddress = baseApplicationService.getNewAddress;\n    self.getAnnualIncome = baseApplicationService.getAnnualIncome;\n    self.getPassportExpiry = baseApplicationService.getPassportExpiry;\n\n    self.setId = function (id) {\n        self.form.request._savingApplicationId = id;\n        return this;\n    };\n\n    self.getId = function () {\n        if (self.form.request._savingApplicationId) {\n            return self.form.request._savingApplicationId;\n        } else {\n            return null;\n        }\n    };\n\n    baseApplicationService.getId = self.getId;\n    baseApplicationService.setId = self.setId;\n\n    self.getProductId = function () {\n        return self.product.id;\n    };\n\n    self.setProductId = function (productId) {\n        self.product.id = productId;\n        return this;\n    };\n\n    self.prepareTosData = baseApplicationService.prepareTosData;\n    self.prepareAddresses = baseApplicationService.prepareAddresses;\n    self.prepareBankDetails = baseApplicationService.prepareBankDetails;\n    self.prepareSecurityData = baseApplicationService.prepareSecurityData;\n    self.preparePersonalData = baseApplicationService.preparePersonalData;\n    self.prepareOddMandatoryFields = baseApplicationService.prepareOddMandatoryFields;\n\n    self.prepareForApi = function () {\n\n        var data = {\n            cuId: self.getCuId(),\n            state: self.getState(),\n            savingsApplicationId: self.getId(),\n            SavingsApplicationID: self.getId(),\n            savingsProductID: self.getProductId(),\n            savingsProductId: self.getProductId()\n        };\n\n        angular.extend(\n            data,\n            self.prepareTosData(),\n            self.prepareAddresses(),\n            self.prepareBankDetails(),\n            self.preparePersonalData(),\n            self.prepareSecurityData()\n        );\n        \n        data.income = "99999";\n\n        // strip empty values as api cant handle\n        _.each(data, function removeEmpty(value, key) {\n            if (!value && value !== 0) {\n                delete data[key];\n            }\n        });\n\n        angular.extend(data, self.prepareOddMandatoryFields());\n\n        saveBackup();\n\n        return data;\n    };\n\n    self.cachedYears = null;\n    self.meta = baseApplicationService.meta;\n\n    self.form = baseApplicationService.form;\n    self.product = baseApplicationService.product;\n\n    self.validator = {\n        errors: [],\n        success: false,\n        go: function go() {\n\n            self.validator.success = false;\n            self.validator.errors = [];\n\n            var data = self.prepareForApi();\n\n           \n\n            // Bank Account Number\n            if (!data.bankAccountNumber) {\n                self.validator.errors.push("Please make sure you\'ve entered your bank account number correctly.");\n            } else if((data.bankAccountNumber + \'\').length !== 8) {\n                self.validator.errors.push("Please check your bank account number length as it looks incorrect.");\n            }\n\n            // Bank Sort Code\n            if (!data.bankSortCode) {\n                self.validator.errors.push("Please make sure you\'ve entered your bank sort code.");\n            } else if ((data.bankSortCode + \'\').length != 6 && (data.bankSortCode + \'\').length != 8) {\n                self.validator.errors.push("Please make sure you\'ve entered your bank sort code correctly");\n            }\n\n            // Bank account type\n            if (!data.bankAccountType) {\n                self.validator.errors.push("Please make sure you\'ve picked your bank account type. (a)");\n            } else {\n                if (data.bankAccountType !== \'CURRENT\' && data.bankAccountType !== \'SAVINGS\') {\n                    self.validator.errors.push("Please make sure you\'ve picked a valid bank account type (b)");\n                }\n            }\n\n            // Bank account usage\n            if (!data.bankAccountUsage) {\n                self.validator.errors.push("Please make sure you\'ve picked your bank account type. (c)");\n            } else {\n                if (data.bankAccountUsage !== \'PERSONAL\' && data.bankAccountUsage !== \'BUSINESS\') {\n                    self.validator.errors.push("Please make sure you\'ve picked a valid bank account type. (d)");\n                }\n            }\n\n            // Address details\n            if(!data.address) {\n                self.validator.errors.push("Please make sure you\'ve entered your address.");\n            }\n\n           /* if (!data.buildingNumber) {\n                self.validator.errors.push("Please make sure you\'ve entered a building name or number.");\n            }*/\n\n            if (!data.city) {\n                self.validator.errors.push("Please make sure you\'ve entered a town or city.");\n            }\n\n            if (!data.street) {\n                self.validator.errors.push("Please make sure you\'ve entered a street or road.");\n            }\n\n            // Postcode details\n            if (!data.postcode) {\n                self.validator.errors.push("Please make sure you\'ve entered a postcode.");\n            } else if (data.postcode.length > 8 || data.postcode.length < 5) {\n                self.validator.errors.push("Please make sure you\'ve entered your postcode correctly.");\n            }\n\n            // Personal details\n            if (!data.title) {\n                self.validator.errors.push("Please make sure you\'ve entered your title.");\n            }\n\n            if (!data.firstName) {\n                self.validator.errors.push("Please make sure you\'ve entered your first name.");\n            }\n\n            if (!data.lastName) {\n                self.validator.errors.push("Please make sure you\'ve entered your last name.");\n            }\n\n            if (!data.birthDate) {\n                self.validator.errors.push("Please make sure you\'ve entered your date of birth.");\n            }\n\n            // Email address\n            if (!data.eMail) {\n                self.validator.errors.push("Please make sure you\'ve entered your email address.");\n            } else {\n                var re = /^(([^<>()\\[\\]\\.,;:\\s@\\"]+(\\.[^<>()\\[\\]\\.,;:\\s@\\"]+)*)|(\\".+\\"))@(([^<>()[\\]\\.,;:\\s@\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\"]{2,})$/i;\n                if (!re.test(data.eMail)) {\n                    self.validator.errors.push("Please make sure you\'ve entered a valid email.");\n                }\n            }\n\n            // Phone number\n            if (!data.phoneNumber) {\n                self.validator.errors.push("Please make sure you\'ve entered your phone number.");\n            } else if (isNaN(data.phoneNumber)) {\n                self.validator.errors.push("Please make sure you\'ve entered a valid phone number.");\n            }\n            // Employer Status\n            if(baseApplicationService.getCuId() == \'BS-0001\') {\n                if (!data.employmentStatus) {\n                    self.validator.errors.push("Please make sure you\'ve entered your employer status.");\n                    } \n    \n                // Employer\n                var allowedEmp = [\'em\', \'se\',\'ce\',\'te\',\'un\',\'ot\'];\n                if(!data.relativeinmycb){\n                    self.validator.errors.push("Please make sure you\'ve entered your relative information.");\n                    }\n                if(data.relativeinmycb == \'yes\'){\n                    if(!data.relativeMembershipId){\n                        self.validator.errors.push("Please make sure you\'ve entered your relative membership Id.");\n                        }\n                    }\n                    else{\n                        console.info("Yes ", data.relativeinmycb);\n                    if(allowedEmp.indexOf(data.employmentStatus)>-1){\n                        if(!data.employmentSector){\n                            self.validator.errors.push("Please make sure you\'ve entered your business/sector.");\n                            } \n                        if(!data.employmentPosition){\n                            self.validator.errors.push("Please make sure you\'ve entered your occupation/job title.");\n                            }\n                        if(!data.employerName){\n                            self.validator.errors.push("Please make sure you\'ve entered your Employer name.");\n                            }\n                        }\n                    if(!(allowedEmp.indexOf(data.employmentStatus)>-1)){\n                        if(!data.association){\n                            self.validator.errors.push("Please make sure you\'ve entered your association.");\n                            }\n                        }\n                    }\n                \n                }\n\n            // Privacy Policy\n            if (!data.privacyAgreementAgreed && baseApplicationService.getCuId() == \'BS-0001\') {\n                self.validator.errors.push("To continue you must agree to our privacy policy.");\n            }\n\n\n            // Api loan id\n            if(!data.SavingsApplicationID) {\n                self.validator.errors.push("Sorry something went wrong, please refresh and try again. (a)");\n            } else {\n                if (isNaN(data.SavingsApplicationID)) {\n                    self.validator.errors.push("Sorry something went wrong, please refresh and try again. (b)");\n                }\n            }\n\n            if(!data.savingsApplicationId) {\n                self.validator.errors.push("Sorry something went wrong, please refresh and try again. (c)");\n            } else {\n                if (isNaN(data.savingsApplicationId)) {\n                    self.validator.errors.push("Sorry something went wrong, please refresh and try again. (d)");\n                }\n            }\n\n            // They have a cu id?\n            if(!data.cuId) {\n                self.validator.errors.push("Sorry something went wrong, please refresh and try again. (d)");\n            }\n\n            // They have a product id\n            if(!data.cuId) {\n                self.validator.errors.push("Sorry something went wrong, please refresh and try again. (e)");\n            }\n\n            // Make sure they have a nationality\n            if (!data.nationality) {\n                self.validator.errors.push("Please make sure you\'ve picked your nationality.");\n            } else {\n\n                // If they\'re not british, we need all their details\n                if (data.nationality !== \'British\') {\n\n                    if (!data.passportIdNumber) {\n                        self.validator.errors.push("Please make sure you\'ve entered your passport number.");\n                    }\n\n                    // We also make sure their passport has not expired\n                    if (!data.passportValidUntil) {\n                        self.validator.errors.push("Please make sure you\'ve entered your passport expiry.");\n                    } else {\n                        var parts = data.passportValidUntil.split(\'/\');\n\n                        if (parts.length !== 3) {\n                            self.validator.errors.push("Please make sure you\'ve entered your passport expiry correctly.");\n                        } else {\n                            var now = Date.now();\n                            var expires = Date.parse(((parts[2]) + "-" + (parts[1]) + "-" + (parts[0])));\n                            if (now > expires) {\n                                self.validator.errors.push("Sorry your passport has expired, we can only acccept non-British applicants with valid passports.");\n                            }\n                        }\n                    }\n\n                    // And they stated their issuing authority\n                    if (!data.passportIssuingAuthority) {\n                        self.validator.errors.push("Please make sure you\'ve entered your passports issuing authority.");\n                    }\n                }\n            }\n\n            if (!data.securityQuestion) {\n                self.validator.errors.push("Please make sure you\'ve picked a security question.");\n            }\n\n            if (!data.securityQuestionAnswer) {\n                self.validator.errors.push("Please make sure you\'ve entered your security answer.");\n            } else {\n                if (data.securityQuestionAnswer.length > 50) {\n                    self.validator.errors.push("Please make sure your security answer is less than 50 characters.");\n                }\n            }\n\n            if (data.state !== \'IN_PROGRESS\') {\n                self.validator.errors.push("Sorry we\'ve already processed your application. If you have not received your result please phone us.");\n            }\n            \n           if(!data.cuEligibility){\n                if(self.getCuId() != \'BS-0001\'){\n                    self.validator.errors.push("Please confirm your Eligibility for membership to the Credit Union.");\n                } else {\n                    self.validator.errors.push("Please confirm your consent to allow us to verify your ID and Eligibility.");\n                }     \n            }\n\n            if (self.validator.errors.length == 0) {\n                self.validator.success = true;\n            }\n\n            return self.validator;\n        }\n    };\n}]);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy90aGVtZS1hc3NldHMvanMvX2FwcGxpY2F0aW9ucy9fc2F2aW5ncy1zZXJ2aWNlLmpzP2M0OTUiXSwic291cmNlc0NvbnRlbnQiOlsibXlDb21tdW5pdHlCYW5rLnNlcnZpY2UoJ3NhdmluZ3NBcHBsaWNhdGlvblNlcnZpY2UnLCBbJ2Jhc2VBcHBsaWNhdGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoYmFzZUFwcGxpY2F0aW9uU2VydmljZSkge1xuXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgbGV0ICRzY29wZSA9IHt9O1xuXG4gICAgc2VsZi5hdHRhY2hTY29wZSA9IGZ1bmN0aW9uKF9zY29wZSkge1xuICAgICAgICBfc2NvcGUubWV0YSA9IHNlbGYubWV0YTtcbiAgICAgICAgX3Njb3BlLmZvcm0gPSBzZWxmLmZvcm07XG4gICAgICAgIF9zY29wZS5wcm9kdWN0ID0gc2VsZi5wcm9kdWN0O1xuICAgICAgICAkc2NvcGUgPSBfc2NvcGU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBzZWxmLmdldERPQiA9IGJhc2VBcHBsaWNhdGlvblNlcnZpY2UuZ2V0RE9CO1xuICAgIHNlbGYuZ2V0Q3VJZCA9IGJhc2VBcHBsaWNhdGlvblNlcnZpY2UuZ2V0Q3VJZDtcbiAgICBzZWxmLnNldEN1SWQgPSBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLnNldEN1SWQ7XG4gICAgc2VsZi5nZXRTdGF0ZSA9IGJhc2VBcHBsaWNhdGlvblNlcnZpY2UuZ2V0U3RhdGU7XG4gICAgc2VsZi5nZXROZXdBZGRyZXNzID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5nZXROZXdBZGRyZXNzO1xuICAgIHNlbGYuZ2V0QW5udWFsSW5jb21lID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5nZXRBbm51YWxJbmNvbWU7XG4gICAgc2VsZi5nZXRQYXNzcG9ydEV4cGlyeSA9IGJhc2VBcHBsaWNhdGlvblNlcnZpY2UuZ2V0UGFzc3BvcnRFeHBpcnk7XG5cbiAgICBzZWxmLnNldElkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHNlbGYuZm9ybS5yZXF1ZXN0Ll9zYXZpbmdBcHBsaWNhdGlvbklkID0gaWQ7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBzZWxmLmdldElkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoc2VsZi5mb3JtLnJlcXVlc3QuX3NhdmluZ0FwcGxpY2F0aW9uSWQpIHtcbiAgICAgICAgICAgIHJldHVybiBzZWxmLmZvcm0ucmVxdWVzdC5fc2F2aW5nQXBwbGljYXRpb25JZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGJhc2VBcHBsaWNhdGlvblNlcnZpY2UuZ2V0SWQgPSBzZWxmLmdldElkO1xuICAgIGJhc2VBcHBsaWNhdGlvblNlcnZpY2Uuc2V0SWQgPSBzZWxmLnNldElkO1xuXG4gICAgc2VsZi5nZXRQcm9kdWN0SWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLnByb2R1Y3QuaWQ7XG4gICAgfTtcblxuICAgIHNlbGYuc2V0UHJvZHVjdElkID0gZnVuY3Rpb24gKHByb2R1Y3RJZCkge1xuICAgICAgICBzZWxmLnByb2R1Y3QuaWQgPSBwcm9kdWN0SWQ7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBzZWxmLnByZXBhcmVUb3NEYXRhID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5wcmVwYXJlVG9zRGF0YTtcbiAgICBzZWxmLnByZXBhcmVBZGRyZXNzZXMgPSBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLnByZXBhcmVBZGRyZXNzZXM7XG4gICAgc2VsZi5wcmVwYXJlQmFua0RldGFpbHMgPSBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLnByZXBhcmVCYW5rRGV0YWlscztcbiAgICBzZWxmLnByZXBhcmVTZWN1cml0eURhdGEgPSBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLnByZXBhcmVTZWN1cml0eURhdGE7XG4gICAgc2VsZi5wcmVwYXJlUGVyc29uYWxEYXRhID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5wcmVwYXJlUGVyc29uYWxEYXRhO1xuICAgIHNlbGYucHJlcGFyZU9kZE1hbmRhdG9yeUZpZWxkcyA9IGJhc2VBcHBsaWNhdGlvblNlcnZpY2UucHJlcGFyZU9kZE1hbmRhdG9yeUZpZWxkcztcblxuICAgIHNlbGYucHJlcGFyZUZvckFwaSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgIGN1SWQ6IHNlbGYuZ2V0Q3VJZCgpLFxuICAgICAgICAgICAgc3RhdGU6IHNlbGYuZ2V0U3RhdGUoKSxcbiAgICAgICAgICAgIHNhdmluZ3NBcHBsaWNhdGlvbklkOiBzZWxmLmdldElkKCksXG4gICAgICAgICAgICBTYXZpbmdzQXBwbGljYXRpb25JRDogc2VsZi5nZXRJZCgpLFxuICAgICAgICAgICAgc2F2aW5nc1Byb2R1Y3RJRDogc2VsZi5nZXRQcm9kdWN0SWQoKSxcbiAgICAgICAgICAgIHNhdmluZ3NQcm9kdWN0SWQ6IHNlbGYuZ2V0UHJvZHVjdElkKClcbiAgICAgICAgfTtcblxuICAgICAgICBhbmd1bGFyLmV4dGVuZChcbiAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICBzZWxmLnByZXBhcmVUb3NEYXRhKCksXG4gICAgICAgICAgICBzZWxmLnByZXBhcmVBZGRyZXNzZXMoKSxcbiAgICAgICAgICAgIHNlbGYucHJlcGFyZUJhbmtEZXRhaWxzKCksXG4gICAgICAgICAgICBzZWxmLnByZXBhcmVQZXJzb25hbERhdGEoKSxcbiAgICAgICAgICAgIHNlbGYucHJlcGFyZVNlY3VyaXR5RGF0YSgpXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBkYXRhLmluY29tZSA9IFwiOTk5OTlcIjtcblxuICAgICAgICAvLyBzdHJpcCBlbXB0eSB2YWx1ZXMgYXMgYXBpIGNhbnQgaGFuZGxlXG4gICAgICAgIF8uZWFjaChkYXRhLCBmdW5jdGlvbiByZW1vdmVFbXB0eSh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICBpZiAoIXZhbHVlICYmIHZhbHVlICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGRhdGFba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgYW5ndWxhci5leHRlbmQoZGF0YSwgc2VsZi5wcmVwYXJlT2RkTWFuZGF0b3J5RmllbGRzKCkpO1xuXG4gICAgICAgIHNhdmVCYWNrdXAoKTtcblxuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9O1xuXG4gICAgc2VsZi5jYWNoZWRZZWFycyA9IG51bGw7XG4gICAgc2VsZi5tZXRhID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5tZXRhO1xuXG4gICAgc2VsZi5mb3JtID0gYmFzZUFwcGxpY2F0aW9uU2VydmljZS5mb3JtO1xuICAgIHNlbGYucHJvZHVjdCA9IGJhc2VBcHBsaWNhdGlvblNlcnZpY2UucHJvZHVjdDtcblxuICAgIHNlbGYudmFsaWRhdG9yID0ge1xuICAgICAgICBlcnJvcnM6IFtdLFxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZ28oKSB7XG5cbiAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycyA9IFtdO1xuXG4gICAgICAgICAgICBsZXQgZGF0YSA9IHNlbGYucHJlcGFyZUZvckFwaSgpO1xuXG4gICAgICAgICAgIFxuXG4gICAgICAgICAgICAvLyBCYW5rIEFjY291bnQgTnVtYmVyXG4gICAgICAgICAgICBpZiAoIWRhdGEuYmFua0FjY291bnROdW1iZXIpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBiYW5rIGFjY291bnQgbnVtYmVyIGNvcnJlY3RseS5cIik7XG4gICAgICAgICAgICB9IGVsc2UgaWYoKGRhdGEuYmFua0FjY291bnROdW1iZXIgKyAnJykubGVuZ3RoICE9PSA4KSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgY2hlY2sgeW91ciBiYW5rIGFjY291bnQgbnVtYmVyIGxlbmd0aCBhcyBpdCBsb29rcyBpbmNvcnJlY3QuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBCYW5rIFNvcnQgQ29kZVxuICAgICAgICAgICAgaWYgKCFkYXRhLmJhbmtTb3J0Q29kZSkge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIGJhbmsgc29ydCBjb2RlLlwiKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoKGRhdGEuYmFua1NvcnRDb2RlICsgJycpLmxlbmd0aCAhPSA2ICYmIChkYXRhLmJhbmtTb3J0Q29kZSArICcnKS5sZW5ndGggIT0gOCkge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIGJhbmsgc29ydCBjb2RlIGNvcnJlY3RseVwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQmFuayBhY2NvdW50IHR5cGVcbiAgICAgICAgICAgIGlmICghZGF0YS5iYW5rQWNjb3VudFR5cGUpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIHBpY2tlZCB5b3VyIGJhbmsgYWNjb3VudCB0eXBlLiAoYSlcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLmJhbmtBY2NvdW50VHlwZSAhPT0gJ0NVUlJFTlQnICYmIGRhdGEuYmFua0FjY291bnRUeXBlICE9PSAnU0FWSU5HUycpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBwaWNrZWQgYSB2YWxpZCBiYW5rIGFjY291bnQgdHlwZSAoYilcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBCYW5rIGFjY291bnQgdXNhZ2VcbiAgICAgICAgICAgIGlmICghZGF0YS5iYW5rQWNjb3VudFVzYWdlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBwaWNrZWQgeW91ciBiYW5rIGFjY291bnQgdHlwZS4gKGMpXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5iYW5rQWNjb3VudFVzYWdlICE9PSAnUEVSU09OQUwnICYmIGRhdGEuYmFua0FjY291bnRVc2FnZSAhPT0gJ0JVU0lORVNTJykge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIHBpY2tlZCBhIHZhbGlkIGJhbmsgYWNjb3VudCB0eXBlLiAoZClcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBZGRyZXNzIGRldGFpbHNcbiAgICAgICAgICAgIGlmKCFkYXRhLmFkZHJlc3MpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBhZGRyZXNzLlwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAvKiBpZiAoIWRhdGEuYnVpbGRpbmdOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgYSBidWlsZGluZyBuYW1lIG9yIG51bWJlci5cIik7XG4gICAgICAgICAgICB9Ki9cblxuICAgICAgICAgICAgaWYgKCFkYXRhLmNpdHkpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgYSB0b3duIG9yIGNpdHkuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWRhdGEuc3RyZWV0KSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIGEgc3RyZWV0IG9yIHJvYWQuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBQb3N0Y29kZSBkZXRhaWxzXG4gICAgICAgICAgICBpZiAoIWRhdGEucG9zdGNvZGUpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgYSBwb3N0Y29kZS5cIik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEucG9zdGNvZGUubGVuZ3RoID4gOCB8fCBkYXRhLnBvc3Rjb2RlLmxlbmd0aCA8IDUpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBwb3N0Y29kZSBjb3JyZWN0bHkuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBQZXJzb25hbCBkZXRhaWxzXG4gICAgICAgICAgICBpZiAoIWRhdGEudGl0bGUpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciB0aXRsZS5cIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghZGF0YS5maXJzdE5hbWUpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBmaXJzdCBuYW1lLlwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFkYXRhLmxhc3ROYW1lKSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIHlvdXIgbGFzdCBuYW1lLlwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFkYXRhLmJpcnRoRGF0ZSkge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIGRhdGUgb2YgYmlydGguXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBFbWFpbCBhZGRyZXNzXG4gICAgICAgICAgICBpZiAoIWRhdGEuZU1haWwpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBlbWFpbCBhZGRyZXNzLlwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IHJlID0gL14oKFtePD4oKVxcW1xcXVxcLiw7Olxcc0BcXFwiXSsoXFwuW148PigpXFxbXFxdXFwuLDs6XFxzQFxcXCJdKykqKXwoXFxcIi4rXFxcIikpQCgoW148PigpW1xcXVxcLiw7Olxcc0BcXFwiXStcXC4pK1tePD4oKVtcXF1cXC4sOzpcXHNAXFxcIl17Mix9KSQvaTtcbiAgICAgICAgICAgICAgICBpZiAoIXJlLnRlc3QoZGF0YS5lTWFpbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIGEgdmFsaWQgZW1haWwuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUGhvbmUgbnVtYmVyXG4gICAgICAgICAgICBpZiAoIWRhdGEucGhvbmVOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBwaG9uZSBudW1iZXIuXCIpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpc05hTihkYXRhLnBob25lTnVtYmVyKSkge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCBhIHZhbGlkIHBob25lIG51bWJlci5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBFbXBsb3llciBTdGF0dXNcbiAgICAgICAgICAgIGlmKGJhc2VBcHBsaWNhdGlvblNlcnZpY2UuZ2V0Q3VJZCgpID09ICdCUy0wMDAxJykge1xuICAgICAgICAgICAgICAgIGlmICghZGF0YS5lbXBsb3ltZW50U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIGVtcGxveWVyIHN0YXR1cy5cIik7XG4gICAgICAgICAgICAgICAgICAgIH0gXG4gICAgXG4gICAgICAgICAgICAgICAgLy8gRW1wbG95ZXJcbiAgICAgICAgICAgICAgICB2YXIgYWxsb3dlZEVtcCA9IFsnZW0nLCAnc2UnLCdjZScsJ3RlJywndW4nLCdvdCddO1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnJlbGF0aXZlaW5teWNiKXtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIHlvdXIgcmVsYXRpdmUgaW5mb3JtYXRpb24uXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoZGF0YS5yZWxhdGl2ZWlubXljYiA9PSAneWVzJyl7XG4gICAgICAgICAgICAgICAgICAgIGlmKCFkYXRhLnJlbGF0aXZlTWVtYmVyc2hpcElkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIHJlbGF0aXZlIG1lbWJlcnNoaXAgSWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oXCJZZXMgXCIsIGRhdGEucmVsYXRpdmVpbm15Y2IpO1xuICAgICAgICAgICAgICAgICAgICBpZihhbGxvd2VkRW1wLmluZGV4T2YoZGF0YS5lbXBsb3ltZW50U3RhdHVzKT4tMSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZighZGF0YS5lbXBsb3ltZW50U2VjdG9yKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBidXNpbmVzcy9zZWN0b3IuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gXG4gICAgICAgICAgICAgICAgICAgICAgICBpZighZGF0YS5lbXBsb3ltZW50UG9zaXRpb24pe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIG9jY3VwYXRpb24vam9iIHRpdGxlLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZighZGF0YS5lbXBsb3llck5hbWUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIEVtcGxveWVyIG5hbWUuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoIShhbGxvd2VkRW1wLmluZGV4T2YoZGF0YS5lbXBsb3ltZW50U3RhdHVzKT4tMSkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWRhdGEuYXNzb2NpYXRpb24pe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIGFzc29jaWF0aW9uLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFByaXZhY3kgUG9saWN5XG4gICAgICAgICAgICBpZiAoIWRhdGEucHJpdmFjeUFncmVlbWVudEFncmVlZCAmJiBiYXNlQXBwbGljYXRpb25TZXJ2aWNlLmdldEN1SWQoKSA9PSAnQlMtMDAwMScpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlRvIGNvbnRpbnVlIHlvdSBtdXN0IGFncmVlIHRvIG91ciBwcml2YWN5IHBvbGljeS5cIik7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgLy8gQXBpIGxvYW4gaWRcbiAgICAgICAgICAgIGlmKCFkYXRhLlNhdmluZ3NBcHBsaWNhdGlvbklEKSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJTb3JyeSBzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHJlZnJlc2ggYW5kIHRyeSBhZ2Fpbi4gKGEpXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4oZGF0YS5TYXZpbmdzQXBwbGljYXRpb25JRCkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJTb3JyeSBzb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHJlZnJlc2ggYW5kIHRyeSBhZ2Fpbi4gKGIpXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoIWRhdGEuc2F2aW5nc0FwcGxpY2F0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlNvcnJ5IHNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgcmVmcmVzaCBhbmQgdHJ5IGFnYWluLiAoYylcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChpc05hTihkYXRhLnNhdmluZ3NBcHBsaWNhdGlvbklkKSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlNvcnJ5IHNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgcmVmcmVzaCBhbmQgdHJ5IGFnYWluLiAoZClcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUaGV5IGhhdmUgYSBjdSBpZD9cbiAgICAgICAgICAgIGlmKCFkYXRhLmN1SWQpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlNvcnJ5IHNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgcmVmcmVzaCBhbmQgdHJ5IGFnYWluLiAoZClcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFRoZXkgaGF2ZSBhIHByb2R1Y3QgaWRcbiAgICAgICAgICAgIGlmKCFkYXRhLmN1SWQpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlNvcnJ5IHNvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgcmVmcmVzaCBhbmQgdHJ5IGFnYWluLiAoZSlcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGV5IGhhdmUgYSBuYXRpb25hbGl0eVxuICAgICAgICAgICAgaWYgKCFkYXRhLm5hdGlvbmFsaXR5KSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBwaWNrZWQgeW91ciBuYXRpb25hbGl0eS5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgLy8gSWYgdGhleSdyZSBub3QgYnJpdGlzaCwgd2UgbmVlZCBhbGwgdGhlaXIgZGV0YWlsc1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLm5hdGlvbmFsaXR5ICE9PSAnQnJpdGlzaCcpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEucGFzc3BvcnRJZE51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdSd2ZSBlbnRlcmVkIHlvdXIgcGFzc3BvcnQgbnVtYmVyLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIGFsc28gbWFrZSBzdXJlIHRoZWlyIHBhc3Nwb3J0IGhhcyBub3QgZXhwaXJlZFxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEucGFzc3BvcnRWYWxpZFVudGlsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBwYXNzcG9ydCBleHBpcnkuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBhcnRzID0gZGF0YS5wYXNzcG9ydFZhbGlkVW50aWwuc3BsaXQoJy8nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCAhPT0gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIHBhc3Nwb3J0IGV4cGlyeSBjb3JyZWN0bHkuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZXhwaXJlcyA9IERhdGUucGFyc2UoYCR7cGFydHNbMl19LSR7cGFydHNbMV19LSR7cGFydHNbMF19YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vdyA+IGV4cGlyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJTb3JyeSB5b3VyIHBhc3Nwb3J0IGhhcyBleHBpcmVkLCB3ZSBjYW4gb25seSBhY2NjZXB0IG5vbi1Ccml0aXNoIGFwcGxpY2FudHMgd2l0aCB2YWxpZCBwYXNzcG9ydHMuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIEFuZCB0aGV5IHN0YXRlZCB0aGVpciBpc3N1aW5nIGF1dGhvcml0eVxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEucGFzc3BvcnRJc3N1aW5nQXV0aG9yaXR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBtYWtlIHN1cmUgeW91J3ZlIGVudGVyZWQgeW91ciBwYXNzcG9ydHMgaXNzdWluZyBhdXRob3JpdHkuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWRhdGEuc2VjdXJpdHlRdWVzdGlvbikge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgcGlja2VkIGEgc2VjdXJpdHkgcXVlc3Rpb24uXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWRhdGEuc2VjdXJpdHlRdWVzdGlvbkFuc3dlcikge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLmVycm9ycy5wdXNoKFwiUGxlYXNlIG1ha2Ugc3VyZSB5b3UndmUgZW50ZXJlZCB5b3VyIHNlY3VyaXR5IGFuc3dlci5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLnNlY3VyaXR5UXVlc3Rpb25BbnN3ZXIubGVuZ3RoID4gNTApIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgbWFrZSBzdXJlIHlvdXIgc2VjdXJpdHkgYW5zd2VyIGlzIGxlc3MgdGhhbiA1MCBjaGFyYWN0ZXJzLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkYXRhLnN0YXRlICE9PSAnSU5fUFJPR1JFU1MnKSB7XG4gICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJTb3JyeSB3ZSd2ZSBhbHJlYWR5IHByb2Nlc3NlZCB5b3VyIGFwcGxpY2F0aW9uLiBJZiB5b3UgaGF2ZSBub3QgcmVjZWl2ZWQgeW91ciByZXN1bHQgcGxlYXNlIHBob25lIHVzLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICBpZighZGF0YS5jdUVsaWdpYmlsaXR5KXtcbiAgICAgICAgICAgICAgICBpZihzZWxmLmdldEN1SWQoKSAhPSAnQlMtMDAwMScpe1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvci5lcnJvcnMucHVzaChcIlBsZWFzZSBjb25maXJtIHlvdXIgRWxpZ2liaWxpdHkgZm9yIG1lbWJlcnNoaXAgdG8gdGhlIENyZWRpdCBVbmlvbi5cIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi52YWxpZGF0b3IuZXJyb3JzLnB1c2goXCJQbGVhc2UgY29uZmlybSB5b3VyIGNvbnNlbnQgdG8gYWxsb3cgdXMgdG8gdmVyaWZ5IHlvdXIgSUQgYW5kIEVsaWdpYmlsaXR5LlwiKTtcbiAgICAgICAgICAgICAgICB9ICAgICBcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNlbGYudmFsaWRhdG9yLmVycm9ycy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgICAgIHNlbGYudmFsaWRhdG9yLnN1Y2Nlc3MgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gc2VsZi52YWxpZGF0b3I7XG4gICAgICAgIH1cbiAgICB9O1xufV0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHRoZW1lLWFzc2V0cy9qcy9fYXBwbGljYXRpb25zL19zYXZpbmdzLXNlcnZpY2UuanMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9');
},function(module,exports,__webpack_require__){eval("__webpack_require__(0);\n__webpack_require__(1);\n\n__webpack_require__(3);\n__webpack_require__(4);\n__webpack_require__(2);\n\n__webpack_require__(6);\n__webpack_require__(7);\n__webpack_require__(5);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy90aGVtZS1hc3NldHMvanMvYXBwbGljYXRpb24tZm9ybS5qcz80NWRhIl0sInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJy4vX2FwcGxpY2F0aW9ucy9fYmFzZS1mYWN0b3J5Jyk7XG5yZXF1aXJlKCcuL19hcHBsaWNhdGlvbnMvX2Jhc2Utc2VydmljZScpO1xuXG5yZXF1aXJlKCcuL19hcHBsaWNhdGlvbnMvX2xvYW4tZmFjdG9yeScpO1xucmVxdWlyZSgnLi9fYXBwbGljYXRpb25zL19sb2FuLXNlcnZpY2UnKTtcbnJlcXVpcmUoJy4vX2FwcGxpY2F0aW9ucy9fbG9hbi1jb250cm9sbGVyJyk7XG5cbnJlcXVpcmUoJy4vX2FwcGxpY2F0aW9ucy9fc2F2aW5ncy1mYWN0b3J5Jyk7XG5yZXF1aXJlKCcuL19hcHBsaWNhdGlvbnMvX3NhdmluZ3Mtc2VydmljZScpO1xucmVxdWlyZSgnLi9fYXBwbGljYXRpb25zL19zYXZpbmdzLWNvbnRyb2xsZXInKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0aGVtZS1hc3NldHMvanMvYXBwbGljYXRpb24tZm9ybS5qcyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9")}]);